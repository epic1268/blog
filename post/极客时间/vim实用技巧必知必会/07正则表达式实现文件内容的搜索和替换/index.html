<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>07｜正则表达式：实现文件内容的搜索和替换 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是吴咏炜。
上面两讲里我们讨论了如何找到你想要查看 / 编辑的文件，及如何处理多个文件。今天我们来看一下如何在一个文件中搜索和替换内容，其核心主题就是正则表达式。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/07%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/07%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="07｜正则表达式：实现文件内容的搜索和替换">
  <meta property="og:description" content="你好，我是吴咏炜。
上面两讲里我们讨论了如何找到你想要查看 / 编辑的文件，及如何处理多个文件。今天我们来看一下如何在一个文件中搜索和替换内容，其核心主题就是正则表达式。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="Vim实用技巧必知必会">

  <meta itemprop="name" content="07｜正则表达式：实现文件内容的搜索和替换">
  <meta itemprop="description" content="你好，我是吴咏炜。
上面两讲里我们讨论了如何找到你想要查看 / 编辑的文件，及如何处理多个文件。今天我们来看一下如何在一个文件中搜索和替换内容，其核心主题就是正则表达式。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="5581">
  <meta itemprop="keywords" content="Vim实用技巧必知必会">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="07｜正则表达式：实现文件内容的搜索和替换">
  <meta name="twitter:description" content="你好，我是吴咏炜。
上面两讲里我们讨论了如何找到你想要查看 / 编辑的文件，及如何处理多个文件。今天我们来看一下如何在一个文件中搜索和替换内容，其核心主题就是正则表达式。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">07｜正则表达式：实现文件内容的搜索和替换</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 5581 字 </span>
          <span class="more-meta"> 预计阅读 12 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#正则表达式搜索">正则表达式搜索</a>
          <ul>
            <li><a href="#搜索实例">搜索实例</a></li>
            <li><a href="#最长匹配和最短匹配">最长匹配和最短匹配</a></li>
            <li><a href="#搜索加亮和取消">搜索加亮和取消</a></li>
          </ul>
        </li>
        <li><a href="#正则表达式替换">正则表达式替换</a>
          <ul>
            <li><a href="#替换实例">替换实例</a></li>
          </ul>
        </li>
        <li><a href="#内容小结">内容小结</a></li>
        <li><a href="#课后练习">课后练习</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是吴咏炜。</p>
<p>上面两讲里我们讨论了如何找到你想要查看 / 编辑的文件，及如何处理多个文件。今天我们来看一下如何在一个文件中搜索和替换内容，其核心主题就是正则表达式。</p>
<h2 id="正则表达式搜索">正则表达式搜索</h2>
<p>通过 Vim 教程，你已经学到了搜索命令 <code>/</code> 和替换命令 <code>:s</code> 的基本用法。教程里没有提到的是，你输入的待查找的内容是被 Vim 当成正则表达式来看待的。正则表达式的学习资料很多（极客时间上就有专门的课程），完整学习也相当复杂，我们就不从头学习了。下面我们会简单讨论的，是 Vim 里的正则表达式，重点是它和其他常用正则表达式（正则表达式还是有很多种不同的风格的）的区别之处。如果你之前对正则表达式完全没有了解，建议你这儿暂停一下，先在网上搜索一下关于正则表达式的资料，了解它的基本概念和用法，然后继续阅读。</p>
<p>在一个搜索表达式里，或者称为模式（pattern；注意不要和 Vim 的 mode 混淆）里，<code>.</code>、<code>*</code>、<code>^</code>、<code>$</code>、<code>~</code>、<code>[]</code>、<code>\</code> 是有特殊含义的字符：</p>
<ol>
<li><code>.</code> 可以匹配除换行符外的任何字符：如 <code>a.</code> 可以匹配“aa”、“ab”、“ac”等，但不能匹配“a”、“b”或“ba”。如果需要匹配换行符（跨行匹配）的话，则需要使用 <code>\_.</code>。</li>
<li><code>*</code> 表示之前的匹配原（最普通的情况为单个字符）重复零次或多次：如 <code>aa*</code> 可以匹配“a”、“aa”或“aaa”，<code>a.*</code> 可以匹配“a”、“aa”、“abc”等等，但两者均不能匹配“b”。</li>
<li><code>^</code> 匹配一行的开头，如果出现在模式的开头的话；在其他位置代表字符本身。</li>
<li><code>$</code> 匹配一行的结尾，如果出现在模式的结尾的话；在其他位置代表字符本身。</li>
<li><code>~</code> 匹配上一次替换的字符串，即如果上一次你把“foo”替换成了“bar”，那 <code>~</code> 就匹配“bar”。</li>
<li><code>[…]</code> 匹配方括号内的任一字符；方括号内如果第一个字符是 <code>^</code>，表示对结果取反；除开头之外的 <code>-</code> 表示范围：如 <code>[A-Za-z]</code> 表示任意一个拉丁字母，<code>[^-+*/]</code> 表示除了“+”、“-”、“*”、“/”外的任意字符。</li>
<li><code>\</code> 的含义取决于下一个字符，在大部分的情况下，包括上面的这几个（<code>.</code>、<code>*</code>、<code>\</code>、<code>^</code>、<code>$</code>、<code>~</code>、<code>[</code> 和 <code>]</code>），代表后面这个字符本身；在跟某些字符时则有特殊含义（后面我们会讨论最重要的那些）。</li>
</ol>
<p>除此之外的字符都是普通字符，没有特殊含义。不过，需要注意的是，如果使用 <code>/</code> 开始一个搜索命令，或者在替换命令（<code>:s</code>）中使用 <code>/</code> 作为模式的分隔符，那模式中的 <code>/</code> 必须写作 <code>\/</code> 才行，否则 Vim 看到 <code>/</code> 就会以为模式结束了，导致错误发生。</p>
<p>为了避免写模式的困扰，如果模式中使用“/”作为路径的分隔符，在替换命令中可以使用其他模式中没有的符号作为分隔符。比如，想把“/image/”全部替换成“/images/”的话，不要用 <code>:%s/\/image\//\/images\//g</code>，而应该用类似于 <code>:%s!/image/!/images/!g</code> 的写法。这只能适用于替换命令，而在使用 <code>/</code> 命令搜索时我们就没什么好办法了，只能把模式里的 <code>/</code> 写作 <code>\/</code>。不过我们也可以取巧一下，用 <code>?</code> 向上、也就是反向搜索，只要记得 <code>n</code>、<code>N</code> 反过来用找下一个就行。</p>
<p>通过 <code>\</code> 开始的特殊表达式有不少，如果你需要完整了解的话，可以去看看参考文档（<code>:help pattern-overview</code>）。我们下面先学习一下最基本的 6 个特殊模式项：</p>
<ol>
<li><code>\?</code> 表示之前的匹配原重复零次或一次：如 <code>aa\?</code> 可以匹配“a”、“aa”，但不能完整匹配“aaa”（可以匹配其前两个字符、后两个或最后一个字符）。</li>
<li><code>\+</code> 表示之前的匹配原重复一次或多次：如 <code>aa\+</code> 可以匹配“aa”、“aaa”，但不能匹配“a”或“b”。</li>
<li><code>\{n,m}</code> 表示之前的匹配原重复 n 到 m 遍之间，两个数字可以省略部分或全部：如 <code>a\{3}</code>（可读作：3 个“a”）可以匹配“aaa” ，<code>a\{,3}</code>（可读作：最多 3 个“a”）可以匹配“”、“a”、“aa”和“aaa”；两个数字都省略时等价于 <code>*</code>，也就是之前的匹配原可以重复零次或多次。</li>
<li><code>\(</code> 和 <code>\)</code> 括起一个模式，将其组成为单个匹配原：如 <code>\(foo\)\?</code> 可以表示单词“foo”出现零次或一次。<code>\(</code> 和 <code>\)</code> 还有一个附加作用，是捕获匹配的内容，按 <code>\(</code> 出现的先后顺序，可以用 <code>\1</code>、<code>\2</code> 到 <code>\9</code> 来引用。如果你不需要捕获匹配内容的话，用 <code>\%(</code> 和 <code>\)</code> 的性能更高。</li>
<li><code>\&amp;</code> 是分支内多个邻接（concat）的分隔符，概念上可以和<strong>与</strong>操作相比，表示每一项都需要匹配成功，然后取最后一项的结果返回：如 <code>.*foo.*\&amp;.*bar.*</code> 匹配同时出现了“foo”和“bar”的完整行。相对来讲，<code>\&amp;</code> 没那么常用。</li>
<li><code>\|</code> 是多个分支的分隔符，概念上可以和<strong>或</strong>操作相比，表示任意一项匹配成功即可：如 <code>foo\|bar</code> 可匹配“foo”或“bar”两单词之一。</li>
</ol>
<p>接下来，我再和你分享 13 个特殊模式项。虽然它们相对来说不那么必需，但掌握它们可以大大地提高程序员的编辑效率。</p>
<ol>
<li><code>\&lt;</code> 匹配单词的开头</li>
<li><code>\&gt;</code> 匹配单词的结尾</li>
<li><code>\s</code> 匹配空白字符 <code>&lt;Space&gt;</code> 和 <code>&lt;Tab&gt;</code></li>
<li><code>\S</code> 匹配非空白字符</li>
<li><code>\d</code> 匹配数字，相当于 <code>[0-9]</code></li>
<li><code>\D</code> 匹配非数字，相当于 <code>[^0-9]</code></li>
<li><code>\x</code> 匹配十六进制数字，相当于 <code>[0-9A-Fa-f]</code></li>
<li><code>\X</code> 匹配非十六进制数字，相当于 <code>[^0-9A-Fa-f]</code></li>
<li><code>\w</code> 匹配单词字符，相当于 <code>[0-9A-Za-z_]</code></li>
<li><code>\W</code> 匹配非单词字符，相当于 <code>[^0-9A-Za-z_]</code></li>
<li><code>\h</code> 匹配单词首字符，相当于 <code>[A-Za-z_]</code></li>
<li><code>\H</code> 匹配非单词首字符，相当于 <code>^[A-Za-z_]</code></li>
<li><code>\c</code> 忽略大小写进行匹配</li>
</ol>
<p>以上我们讨论的实际上是 Vim 缺省设置下的正则表达式。通过选项（<code>:help /magic</code>），我们可以对哪些字符有特殊意义进行一定程度的调整。不过一般情况下，我认为修改这个选项只会造成混乱、增加心智负担，因此我也就不在这儿展开了。</p>
<h3 id="搜索实例">搜索实例</h3>
<p>抽象地讨论正则表达式恐怕你也不容易记住，我们还是拿一些具体的例子来看一下吧。</p>
<p>首先，如果**我们要查找某个函数，该怎么做呢？**简单，按下 <code>/</code>，然后输入函数名，回车，不就行了？</p>
<p>错。这种方式对函数名是部分匹配，你搜 <code>begin</code> 还会得到 <code>begin1</code>、<code>_begin</code> 之类的结果。正确的方法是，要在前后加上匹配单词头尾的标记，如，<code>\&lt;begin\&gt;</code>。</p>
<p>顺便说一句，被誉为最有用的 Vim 提示，是把光标移到希望搜索的关键字上，然后按下 <code>*</code> 键。Vim 会提取光标下的关键字，并自动添加 <code>\&lt;</code> 和 <code>\&gt;</code> 进行搜索。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/bfdebe3e61d1b3f4daf1b265e4cfdcd6.png" alt=""></p>
<p>使用 * 搜索的示例；注意“unexpected”并没有被高亮</p>
<p>如果我要搜索 <code>begin</code> 或 <code>end</code> 呢？我想，你应该已经知道了，是：<code>/\&lt;\(begin\|end\)\&gt;</code>。注意，写成 <code>/\&lt;begin\|end\&gt;</code> 可是不对的。（为什么？你想明白了吗？）</p>
<p>对于 HTML，你应该多多少少有些了解。<strong>如果我们想匹配一下 HTML 标签的话，该怎么做呢？</strong></p>
<p>一个标签以 <code>&lt;</code> 开始，以 <code>&gt;</code> 结束。所以，最简单的模式应该是 <code>&lt;.\+&gt;</code>，对吗？</p>
<p>不对，这个写法忽略了一行里可能有多个标签的事实：对于“<h1>title</h1>”这样一个字符串，上面这个简单的模式会匹配整个字符串，而不是“<h1>”和“</h1>”……</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/c518266998458340d4b025058d1479df.png" alt=""></p>
<p>HTML 标签的错误匹配</p>
<p>有一种解决方案是，排除不应该匹配的字符，把模式写成 <code>&lt;[^&gt;]\+&gt;</code>：一对尖括号里有一个或多个不是“&gt;”的字符。不过，这样的写法会让像 <code>&gt;</code> 这样的结尾字符在模式中重复出现，因此这并不是最理想的写法。更好的方式是，使用最短匹配。</p>
<h3 id="最长匹配和最短匹配">最长匹配和最短匹配</h3>
<p>我们上面学到的 <code>*</code>、<code>\?</code>、<code>\+</code> 和 <code>\{}</code> 都属于最长匹配（也叫贪婪匹配），也就是说，当模式既可以匹配一个较长的字符串，也可以匹配一个较短的字符串时，结果会是那个较长的字符串。</p>
<p>相应地，还有一种匹配叫做最短匹配，也就是在同时可以匹配较长的字符串和较短的字符串时，产生较短的匹配。在 Vim 里，最短匹配只有一种形式，<code>{-n,m}</code>，其意义和之前说的 <code>{n,m}</code> 基本相同，但结果是较短而非较长的字符串。</p>
<p>以上面的 HTML 标签匹配为例，使用最短匹配的话，我们可以把模式写成 <code>&lt;.\{-1,}&gt;</code>，要求在一对尖括号里至少有一个字符，但越短越好。</p>
<h3 id="搜索加亮和取消">搜索加亮和取消</h3>
<p>如果你一边学一边在试验的话，就会发现，Vim 缺省在你输入搜索模式时就会高亮跟你输入的模式匹配的文本。这对验证你输入的模式是否正确，以及进行进一步的编辑，都是非常方便和重要的。用惯了 Vim，就会把它当成是一件理所当然的事——直到你被迫使用其他编辑器时才发现，一边输入正则表达式一边就能看到匹配的结果，原来不是谁都这样做的啊……</p>
<p>但也有些时候，我们已经做完了搜索或替换，和模式匹配的文本内容仍然还高亮着，非常碍眼。有些人就会随便搜索一个不存在的字符串来取消加亮，但这显然不是一种高效的处理方式。事实上，Vim 有一个专门命令来取消搜索加亮，这个命令就是 <code>:nohlsearch</code>，不要高亮搜索。</p>
<p>鉴于这个命令使用的频度实在是太高了，我们需要给它专门分配一个快捷键。请在 vimrc 中加入：</p>
<p>&quot; 停止搜索高亮的键映射<br>
nnoremap <silent> <F2>      :nohlsearch<CR><br>
inoremap <silent> <F2> <C-O>:nohlsearch<CR></p>
<p>这样一来，在搜索或替换工作完成之后，只要按下 <code>&lt;F2&gt;</code> 就可以取消搜索加亮了。</p>
<p>好，关于正则表达式的搜索部分，我们暂时就先学到这里。下面我们来看一下替换。</p>
<h2 id="正则表达式替换">正则表达式替换</h2>
<p>你可能要说了：替换不就是找到跟模式匹配的字符串，然后把它换成另外一个字符串么，有什么复杂的？</p>
<p>事实上，还真是有些复杂情况的。你在看下面这些复杂的替换情况时，也可以同时考虑下自己有没有解决方案：</p>
<ol>
<li>你可能要保留匹配中的某些字符，而替换另外一些字符</li>
<li>你可能要对匹配出的内容做大小写转换</li>
<li>你可能需要“计算”出替换结果</li>
<li>你可能需要决定一行里要替换单次还是多次，是自动替换还是要一一确认，等等</li>
</ol>
<p>接下来，我们就分别看看这些复杂情况。</p>
<p>在这些情况里，最常用的显然就是<strong>在替换结果中保留匹配出的字符串</strong>了。前面说到 <code>\(\)</code> 除了将一个模式转变成匹配原外，还有一个作用是捕捉匹配的内容，按 <code>\(</code> 的出现顺序依次编号为 1 到 9，并可以在模式和替换字符串中用 <code>\1</code> 到 <code>\9</code> 来访问。如果要在替换字符串中完整使用匹配内容的话，则可以使用 <code>\0</code> 或 <code>&amp;</code>（字符“&amp;”也因此要在替换字符串中写成 <code>\&amp;</code>）。</p>
<p>从搜索的角度，我们一般只关心匹配与否，而不关心匹配的大小。举个例子，如果我想找出作为函数调用的 <code>begin</code>，那我可以写成 <code>\&lt;begin(</code>，虽然 <code>(</code> 不是我想匹配的内容（函数名称）的一部分。但从替换的角度，我需要在替换时再处理一下多匹配的内容，也是件麻烦事；在非匹配的内容比较复杂或者会变化的时候，尤其会是这样。所以 Vim 里还有专门标识匹配开始和结束的匹配原，分别是 <code>\zs</code> 和 <code>\ze</code>。对于这个例子，搜索模式就应该是 <code>\&lt;begin\ze(</code>。为了巩固前面学到的知识，你应该知道，这个模式也可以啰嗦地写成 <code>\&lt;begin(\&amp;begin</code> 或 <code>\&lt;begin(\&amp;.....</code>。</p>
<p>Vim 里还有一些<strong>大小写转换的特殊替换字符串</strong>。它们是：</p>
<ol>
<li><code>\U</code> 把下面的字符变成大写，直到 <code>\E</code> 出现</li>
<li><code>\u</code> 把下一个字符变成大写</li>
<li><code>\L</code> 把下面的字符变成小写，直到 <code>\E</code> 出现</li>
<li><code>\l</code> 把下一个字符变成小写</li>
<li><code>\E</code> 结束大小写转换</li>
</ol>
<p>Vim 还能用 <code>\=</code> 开始一个返回字符串的表达式，用来<strong>计算出一个替换结果</strong>。鉴于我们目前还没有讨论 Vim 脚本，这个我们就留到后面第 14 讲再说了。</p>
<p>跟常用的编程语言一样，Vim 的正则表达式中支持 <code>\t</code>、<code>\r</code>、<code>\n</code> 等特殊转义字符，但在替换表达式中，由于一些技术原因（<code>:help NL-used-for-Nul</code>），<code>\n</code> 插入的是空字符（NUL 或“\0”），而非在模式中出现时代表的 LF。如果要插入正常的行尾符 LF 的话，我们得使用 <code>\r</code>。这意味着如果想把一个回车变成两个的话，我们得别扭地写 <code>:s/\n/\r\r/</code>，略遗憾。如果有特殊需要得插入 CR 的话，就要更别扭地输入 <code>\&lt;C-V&gt;&lt;CR&gt;</code> 才行。还好，我们基本不会在替换时遇到要插入 CR 的情况……</p>
<p><strong>Vim 有很多用来控制替换的标志</strong>，你可以通过 <code>:help s_flags</code> 查看详细的介绍，我就不一一列举了。今天这一讲中，我们只会用到最常用的一个标志，<code>g</code>，代表可以在一行内进行多次替换；没有这个标志的话，Vim 在一行里只会对第一个成功的匹配进行替换。</p>
<h3 id="替换实例">替换实例</h3>
<p>同样，我们还是通过例子来巩固一下对正则表达式替换的理解。</p>
<p>先来看一个简单的，删除行尾的“//”注释。我们可以用这个命令</p>
<p>:%s!\s*//.*$!!</p>
<p>把零到多个空白字符后面出现的“//”直到行尾全部删除。</p>
<p>如果要删除“/* */”注释，那就复杂多了。首先，匹配内容可以跨行；其次，有跟 HTML 标签类似的问题，需要使用最短匹配。我们需要使用的命令是：</p>
<p>:%s!/*_.{-}*/!!g</p>
<p>由于一行里可以有多个“/* */”注释，我们在替换命令的尾部还加上了 <code>g</code> 标志，允许一行里进行多次替换。</p>
<p>假设我们目前的编码规范规定，所有的函数名应该首字母大写（简单起见，我们假设所有的类名已经是首字母大写了，因而构造函数自动符合该要求，不会发生冲突；但其他很多函数名称仍然是小写字母开头），我们能不能用 Vim 的替换命令做到呢？答案也是肯定的。所有需要的知识点我们都已经讲过了，我就直接公布答案了：</p>
<p>:%s/&lt;(_<em>)([a-z]\w</em>)\ze(/\1\u\2/g</p>
<p>这个命令比较长，请你慢慢体会一下，尝试去理解每一部分的意图。如果你有哪个点卡住了，可以留言给我，我再帮你详细分析一下。</p>
<h2 id="内容小结">内容小结</h2>
<p>好了，今天的内容就讲到这里了。内容有点密集，我把要点再总结一下：</p>
<p>Vim 支持用 <code>/</code> 进行搜索和用 <code>:s</code> 进行替换，它们都用到了正则表达式。</p>
<p>在搜索的模式里，<code>.</code>、<code>*</code>、<code>^</code>、<code>$</code>、<code>~</code>、<code>[]</code>、<code>\</code> 是有特殊含义的字符，你一定要记住它们的含义。在 <code>\</code> 开始的特殊表达式中，最重要的是 <code>\?</code>、<code>\+</code>、<code>\(\)</code>、<code>\|</code> 和 <code>\{n,m}</code>。对于程序员来说，<code>\&lt;</code>、<code>\&gt;</code> 等匹配原对于提高编辑效率也非常重要。Vim 中的常用搜索命令 <code>*</code> 则会自动在搜索的关键字前后加上 <code>\&lt;</code> 和 <code>\&gt;</code>。</p>
<p>在替换时，我们需要特别记住 <code>\1</code>、<code>\2</code> 到 <code>\9</code> 可以用来引用前面用 <code>\(</code> 和 <code>\)</code> 括起来的内容，字符“&amp;”出现在替换内容中需要使用反斜杠转义成 <code>\&amp;</code>，否则代表完整的被匹配字符串。</p>
<p>正则表达式就可以算是一种独立的语言了，靠死记硬背是不行的。最后我还要建议你再把这一讲中的例子仔细看一下、尝试一下，多多练习是掌握正则表达式搜索和替换的必经之路。如果你日后遇到了这一讲没有覆盖的问题，可以再去查阅 Vim 的帮助文档 <code>:help regexp</code>。</p>
<p>本讲我们在配置文件中只更改了一处，对应的标签是 <code>l7-unix</code> 和 <code>l7-windows</code>。</p>
<h2 id="课后练习">课后练习</h2>
<p>有两道练习题，请你在课后尝试一下。练习对于掌握正则表达式是非常重要的。</p>
<ol>
<li>如果我要搜索“/* */”注释的话，搜索命令应该是什么样的？</li>
<li>例子里只说了首字母大写，但实际的编码规范是要求把 begin_search_nocase 这样的函数名称转变成 BeginSearchNocase。请用 Vim 的替换命令完成这一任务。**提示：**可能需要一条以上的替换命令。</li>
</ol>
<p>我是吴咏炜，我们下一讲再见。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">Vim实用技巧必知必会</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E7%8E%A9%E8%BD%ACserverless%E6%9E%B6%E6%9E%84/07%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%90%E8%A1%8C%E6%97%B6%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">07｜运行时：使用自定义运行时支持自定义编程语言</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%95%86%E4%B8%9A%E6%A1%88%E4%BE%8B%E8%A7%A3%E8%AF%BB/070__%E7%AE%A1%E4%B8%AD%E7%AA%A5%E8%B1%B9%E4%B9%8B%E4%BB%8E%E9%9D%A2%E8%AF%95%E7%9C%8B%E4%BC%81%E4%B8%9A%E6%96%87%E5%8C%96facebook/">
            <span class="next-text nav-default">070__管中窥豹之从面试看企业文化：Facebook</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
