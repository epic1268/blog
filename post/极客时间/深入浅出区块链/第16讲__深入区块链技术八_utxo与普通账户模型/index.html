<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>第16讲__深入区块链技术（八）：_UTXO与普通账户模型 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="我们在第 2 讲“区块链到底是怎么运行”一文中，提到了村长给张三转账的例子，那里村长的例子就是 UTXO 模型的一个简化版本。
评论区里有不少留言在问：“为什么不直接记余额呢？”看来很多人都对这个问题很感兴趣，今天我们就来聊一聊这个话题。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/%E7%AC%AC16%E8%AE%B2__%E6%B7%B1%E5%85%A5%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%85%AB_utxo%E4%B8%8E%E6%99%AE%E9%80%9A%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9E%8B/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/%E7%AC%AC16%E8%AE%B2__%E6%B7%B1%E5%85%A5%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%85%AB_utxo%E4%B8%8E%E6%99%AE%E9%80%9A%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9E%8B/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="第16讲__深入区块链技术（八）：_UTXO与普通账户模型">
  <meta property="og:description" content="我们在第 2 讲“区块链到底是怎么运行”一文中，提到了村长给张三转账的例子，那里村长的例子就是 UTXO 模型的一个简化版本。
评论区里有不少留言在问：“为什么不直接记余额呢？”看来很多人都对这个问题很感兴趣，今天我们就来聊一聊这个话题。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="深入浅出区块链">

  <meta itemprop="name" content="第16讲__深入区块链技术（八）：_UTXO与普通账户模型">
  <meta itemprop="description" content="我们在第 2 讲“区块链到底是怎么运行”一文中，提到了村长给张三转账的例子，那里村长的例子就是 UTXO 模型的一个简化版本。
评论区里有不少留言在问：“为什么不直接记余额呢？”看来很多人都对这个问题很感兴趣，今天我们就来聊一聊这个话题。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3549">
  <meta itemprop="keywords" content="深入浅出区块链">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="第16讲__深入区块链技术（八）：_UTXO与普通账户模型">
  <meta name="twitter:description" content="我们在第 2 讲“区块链到底是怎么运行”一文中，提到了村长给张三转账的例子，那里村长的例子就是 UTXO 模型的一个简化版本。
评论区里有不少留言在问：“为什么不直接记余额呢？”看来很多人都对这个问题很感兴趣，今天我们就来聊一聊这个话题。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">第16讲__深入区块链技术（八）：_UTXO与普通账户模型</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3549 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#普通账户模型">普通账户模型</a></li>
        <li><a href="#utxo-模型">UTXO 模型</a></li>
        <li><a href="#账户余额模型与-utxo-的比较">账户余额模型与 UTXO 的比较</a></li>
        <li><a href="#区块链中的-utxo-模型">区块链中的 UTXO 模型</a></li>
        <li><a href="#utxo-的特性及缺点">UTXO 的特性及缺点</a>
          <ul>
            <li><a href="#1-可表达的状态少">1. 可表达的状态少。</a></li>
            <li><a href="#2-区块链盲点blockchain-blindness">2. 区块链盲点（Blockchain-blindness）。</a></li>
            <li><a href="#3-价值盲点value-blindness">3. 价值盲点（Value-blindness）。</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>我们在第 2 讲“区块链到底是怎么运行”一文中，提到了村长给张三转账的例子，那里村长的例子就是 UTXO 模型的一个简化版本。</p>
<p>评论区里有不少留言在问：“为什么不直接记余额呢？”看来很多人都对这个问题很感兴趣，今天我们就来聊一聊这个话题。</p>
<p>区块链网络中有两种记账模式，除了 UTXO 模型还有 Account Based 结构，也就是普通账户模型，也叫账户余额模型，前者在比特币系的数字货币中被广泛使用，后者更多是用在智能合约型的区块链上。</p>
<h2 id="普通账户模型">普通账户模型</h2>
<p>我们先从传统的账户模型出发来聊聊是如何记账的，假设我们现在有一个支付系统，在这个支付系统中有村长和张三两个账户，村长账户里有 100 万，现在要转账给张三 10 万，这其中涉及的操作是这样的：</p>
<ol>
<li>检查村长的账户余额是否大于 10 万；</li>
<li>把村长的账户扣除 10 万变成 90 万，然后发送一笔转账消息给张三的账户；</li>
<li>张三的账户接受到转账消息，将张三的账户余额加 10 万。</li>
</ol>
<p>我们可以发现，无论是村长还是张三，都具有一个余额作为状态，即当前余额是记录在某个地方的，只需要读出来即可，这种设计我们叫做账户余额模型。</p>
<p>如果以上三个步骤是在一个中心化系统中，甚至在同一个数据库中，那将非常简单，会直接退化成一个事务，我们见到的银行账户、信用卡系统、证券交易系统、各种电商类应用，理财类应用基本都是一个中心化系统中的，最多也就是跨表跨数据库。</p>
<p>想必这类场景下的设计，各位工程师对此应该是了如指掌的。</p>
<p>如果以上的步骤中，村长和张三的账户分属两个不同的系统，例如从 A 银行到 B 银行，就需要经过人民银行支付系统，即可信任的中心化第三方来做中介。</p>
<p>你可能发现了，在跨行转账的这种情况下，是没有办法做事务的，所以 1 和 3 是不同步的，如果 3 操作失败，还需要从 2 倒退到 1 的状态，这个情况叫做冲正交易。</p>
<p>普通账户模型具有自定义数据类型的优点，但是却需要自己设计事务机制，就是上述所说的冲正交易。而接下来所讲的 UTXO 模型则恰恰相反。</p>
<h2 id="utxo-模型">UTXO 模型</h2>
<p>UTXO 全称是：“Unspent Transaction Output”，这指的是：未花费的交易输出。这里面三个单词分别表示“未花费的”“交易”“输出”，接下来我来详细讲解一下 UTXO 的含义。</p>
<p>UTXO 的核心设计思路是无状态，它记录的是交易事件，而不记录最终状态，也就是说只记录变更事件，用户需要根据历史记录自行计算余额。</p>
<p>有点像 MySQL 中的 Binlog，主从模式的情况下，按照 Binlog 来更新数据，Redis 的 AOF 模式备份模式也是如此，UTXO 也是类似的思路。</p>
<p>下面我们按照按照普通账户中的例子来重新讲解一遍。</p>
<p>如果要记录交易本身，那么我们可以构造一笔交易，这笔交易中村长转账 10 万给张三的同时，90 万转给自己。</p>
<p>如下所示：</p>
<p>村长 100 万 &ndash;&gt; 张三 10 万<br>
--&gt; 村长 90 万</p>
<p>这里其实有三条子记录，左边一条，右边两条，左边叫做输入，右边叫做输出。</p>
<p>输入和输出组成了交易，输入和输入需要满足一些约束条件：</p>
<ol>
<li>任意一个交易必须至少一个输入、一个输出；</li>
<li>输入必须全部移动，不能只使用部分，所以才产生了第二个输出指向村长自己；</li>
<li>输入金额 = 输出金额之和 + 交易手续费，这里必须是等式。</li>
</ol>
<p>对于村长来说，首先构造交易的输入输出，满足上述条件，然后广播到全网，接收方自行判断交易是否属于自己。这里满足约束条件构成的交易模型，也就是村长记录的三条转账事件就是 UTXO 模型。</p>
<h2 id="账户余额模型与-utxo-的比较">账户余额模型与 UTXO 的比较</h2>
<p>我们可以归纳出 UTXO 与普通账户模型的一些区别。</p>
<ol>
<li>存储空间，UTXO 占用空间比账户模型高，因为账户模型只记录最终状态。</li>
<li>易用性，UTXO 比较难处理，账户模型简单容易理解。例如 UTXO 在使用上，还需要配合高效的 UTXO 组装算法，这个算法要求尽可能降低输入输出的个数，还要让“零钱“归整，算法的复杂度相比账户余额无疑要高。</li>
<li>安全性，UTXO 比账户模型要高，UTXO 本身具备 ACID 的记账机制，而账户模型需要自行处理，例如重放攻击。</li>
</ol>
<p>普通账户模型具有较高的自由度，可以让智能合约有更好的发挥空间，并且它避免了 UTXO 的复杂组装逻辑，精度控制上也更为得心应手。</p>
<p>UTXO 似乎天然是为数字货币设计的，具有较高频次跨账户转移场景都使用 UTXO 会比较好，考虑到智能合约的普适性，UTXO 与智能合约并不能很好地兼容，但是这也对开发者的自身水平提出了更高的要求。</p>
<h2 id="区块链中的-utxo-模型">区块链中的 UTXO 模型</h2>
<p>我们借用比特币开发者文档中 UTXO 模型的图示，来看看 UTXO 实际的构造形式。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/96107221b8402a6f4868953e91ec3405.png" alt=""></p>
<p>上图中，所有的交易都可以找到前向交易，例如 TX5 的前向交易是 TX2，TX2 中的 Output1 作为 TX5 中的 Input0。</p>
<p>意思就是 TX2 中的付款人使用了 Output1 中指向的比特币转移给 TX5 中的收款人，接着 TX5 中的人又把收到的比特币转移给了 TX6 中的收款人，成为了 TX6 中 Output0。</p>
<p>我们也可以发现，TX6 中的收款人还没有产生 TX7 交易，也就是说 Output0 还没有被花费，</p>
<p>这时候我们终于得到了 UTXO 的真正语义：Unspent Transaction Output，未花费的交易输出。</p>
<p>我们这时候可以发现 UTXO 也同样能表示余额，不过是重演计算的方式，它用不同的方式表达了余额，我们把一个地址上所有的 UTXO 全部找出来，就是这个地址总的余额了。</p>
<p>我们还可以发现，无论是 TX5 还是 TX2，都已经成为历史交易，它们都忠实客观地记录了两笔交易，这两笔交易代表的是事件，而不是余额状态转移，这是我们看到的最直观的区别。</p>
<p>我们再来看看一个真实的交易例子。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/7cf39ac9edf71e14a8b44b528ea854a6.png" alt=""></p>
<p>这是区块链上一笔真实交易的例子，它记录了一笔 450ETP 的转账记录。</p>
<p>左边是输入，右边是两笔输出，其中第二个输出是给自己的账户，这和我们村长转账给张三的例子是一样的。</p>
<p>下图是交易解码为 JSON 格式的样子，可以看到 Previous_output 是放到 Inputs 数组里的，意思就是前向输出作为本次的输入。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;hash&#34; : &#34;89e80e14db07c4904a57e2c1efb689bccbbf43942103c1a92166d5c0f27ea3d2&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;height&#34; : 1093399,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;inputs&#34; :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;address&#34; : &#34;MLWtmjwCtmK44FMwJMSfAkHaEvnnb2N6HX&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;previous_output&#34; :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            &#34;hash&#34; : &#34;770a72f35d3e3a78bd468949bad649f03b241cf7e2a84cc2d6fdabacdcc47f06&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            &#34;index&#34; : 0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;script&#34; : &#34;[ 304402202b21d7a79276985dc99777b70fd5095796dad58f35e29a019d2cb6cca5df481802205ffab088a6047f5b6382ba02a0eed4e78ab7950fe264d3774e8b0b357a7593d101 ] [ 03ea3462dc01e7b5569e89737211887035f8f1e99e1fe4332181d83daccaa6d917 ]&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;sequence&#34; : 4294967295
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">],
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;lock_time&#34; : &#34;0&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;outputs&#34; :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;address&#34; : &#34;MGz9yjLLn4AqyraRjSpiP2GmTWKnT3yfiL&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;attachment&#34; :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            &#34;type&#34; : &#34;etp&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;index&#34; : 0,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;locked_height_range&#34; : 0,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;script&#34; : &#34;dup hash160 [ 63ab0013d183f2592e4b46a358df01e88a09c0b8 ] equalverify checksig&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;value&#34; : 45000000000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;address&#34; : &#34;MLWtmjwCtmK44FMwJMSfAkHaEvnnb2N6HX&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;attachment&#34; :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            &#34;type&#34; : &#34;etp&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;index&#34; : 1,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;locked_height_range&#34; : 0,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;script&#34; : &#34;dup hash160 [ 8a63941b392771c40f1c15e4374808f6bb464cba ] equalverify checksig&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &#34;value&#34; : 118082150283
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">],
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;version&#34; : &#34;2&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们再看看比特币上的例子：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/8ae375d8e67ebc5656e34236c367e3b3.png" alt=""></p>
<p>这一笔比特币交易包含 6 个输入，几十个输出，交易一共 3.5kb，交易的输入输出会影响交易大小，比特币的交易费是根据字节收费的，交易尺寸越大越贵，而交易尺寸主要和输入输出的个数有关，也就是说，算法上并不规定输入输出的个数，而只有区块尺寸限制。</p>
<p>在比特币中将小于 100kb 的交易称为标准交易，超过 100kb 的称为非标准交易。它的前向 input 以及生成一个 out 约占用 161~250 bytes。所以在比特币中，大约的 inputs/ouputs 的最大数目限制为 100KB/161B ~= 600 个。</p>
<h2 id="utxo-的特性及缺点">UTXO 的特性及缺点</h2>
<p>从计算的角度来说，UTXO 具有非常好的并行支付能力，也就是我们上文中所说的如果没有尺寸限制，一笔交易可以包含任意笔输入输出，同时也没有次序要求，在一笔交易中哪一个 UTXO 在前，哪个在后面不影响最终结果。</p>
<p>从存储的角度来说，UTXO 具有较好的可裁剪特性，可裁剪性指的是 UTXO 类型的交易，如果从最老的那一笔 UTXO 开始截断数据库，那么之前的数据可以删除掉了。</p>
<p>如果想进一步压缩数据尺寸，可以在任意位置截断，记录 UTXO 对应的交易哈希即可，然后从其他节点获取并校验 UTXO，这也是 SPV 轻钱包工作的基础之一。</p>
<p>以太坊中并没有使用比特币的这种 UTXO 设计，这与以太坊的宗旨有关，以太坊的目标是构建通用计算，而比特币是数字货币，需求不同导致设计的不同。</p>
<p>V 神指出了 UTXO 的缺陷，一共有三类。</p>
<h3 id="1-可表达的状态少">1. 可表达的状态少。</h3>
<p>UTXO 只能是已花费或者未花费状态，这就没有给需要任何其它内部状态的多阶段合约或者脚本留出生存空间，这也意味着 UTXO 只能用于建立简单的、一次性的合约，UTXO 更像是一种二进制控制位。</p>
<h3 id="2-区块链盲点blockchain-blindness">2. 区块链盲点（Blockchain-blindness）。</h3>
<p>UTXO 的脚本只能看到自己这条历史轨迹，无法看到区块链的数据的全貌，这导致了功能性扩展受到了限制，我们在花费比特币的过程中需要小心翼翼的组合 UTXO，这也导致了系统状态逻辑复杂，不适合设计成智能合约的基础结构。</p>
<h3 id="3-价值盲点value-blindness">3. 价值盲点（Value-blindness）。</h3>
<p>UTXO 脚本不能提供非常精细的金额控制，基于账户模型的余额在花费过程中，可以任意的按值存取，它仅取决于程序能表示的最小精度。</p>
<p>而 UTXO 要求必须全部移动，如果要满足一个目标值金额，对组合 UTXO 算法的要求会比较高，采用许多有不同面值的 UTXO，一方面要求尽可能地精确，另一方面又要求输入输出的数量尽可能的小。</p>
<p>UTXO 是比特币上的原生设计，在区块链以前是没有这种逻辑数据结构，UTXO 的出现给了人们看待数据转移的不同视角，但 UTXO 不是所有区块链所必需的，公链开发过程中的是否选用 UTXO 模型可以根据业务场景进行判断。</p>
<h2 id="总结">总结</h2>
<p>好了，今天我们分别介绍了普通账户模型和 UTXO 模型，并从不同角度比较了二者的优劣。</p>
<p>从技术选择上来看，比特币选择 UTXO 是为了满足支付的安全性，以太坊选择普通账户模型是为了智能合约的自由度。</p>
<p>最后留给你一个问题，历史上 UTXO 或账户模型是否引发过比较严重的使用缺陷呢？你可以给我留言，我们一起讨论，感谢你的收听，我们下期再见。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/6651fea80872baf69676c1873cd7b2d4.png" alt=""></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/">深入浅出区块链</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%8A%80%E6%9C%AF%E9%A2%86%E5%AF%BC%E5%8A%9B300%E8%AE%B2/%E7%AC%AC16%E8%AE%B2__%E5%9F%B9%E5%85%BB%E4%B8%AD%E5%B1%82%E5%9B%A2%E9%98%9F%E7%9A%84%E7%AE%A1%E7%90%86%E8%AE%A4%E7%9F%A5/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">第16讲__培养中层团队的管理认知</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%AC%AC16%E8%AE%B2_%E7%83%AD%E7%82%B9%E5%89%96%E6%9E%90%E4%B8%89%E8%AF%95%E8%AF%95%E7%9C%8B%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%BC%96%E5%86%99%E4%B8%80%E6%AC%BEhtml5%E5%B0%8F%E6%B8%B8%E6%88%8F/">
            <span class="next-text nav-default">第16讲_热点剖析（三）：试试看，你也可以编写一款HTML5小游戏！</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
