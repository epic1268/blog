<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>第19讲__上手搭建一条自己的智能合约 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="上一篇我们聊到了区块链智能合约，我主要介绍了智能合约的概念，但是并没有给你提供智能合约的实际运行案例，那么今天，我们就自己动手写一个智能合约，并且介绍一下智能合约标准模板，供你参考学习，并搭建起自己的智能合约。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/%E7%AC%AC19%E8%AE%B2__%E4%B8%8A%E6%89%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E6%9D%A1%E8%87%AA%E5%B7%B1%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/%E7%AC%AC19%E8%AE%B2__%E4%B8%8A%E6%89%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E6%9D%A1%E8%87%AA%E5%B7%B1%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="第19讲__上手搭建一条自己的智能合约">
  <meta property="og:description" content="上一篇我们聊到了区块链智能合约，我主要介绍了智能合约的概念，但是并没有给你提供智能合约的实际运行案例，那么今天，我们就自己动手写一个智能合约，并且介绍一下智能合约标准模板，供你参考学习，并搭建起自己的智能合约。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="深入浅出区块链">

  <meta itemprop="name" content="第19讲__上手搭建一条自己的智能合约">
  <meta itemprop="description" content="上一篇我们聊到了区块链智能合约，我主要介绍了智能合约的概念，但是并没有给你提供智能合约的实际运行案例，那么今天，我们就自己动手写一个智能合约，并且介绍一下智能合约标准模板，供你参考学习，并搭建起自己的智能合约。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3615">
  <meta itemprop="keywords" content="深入浅出区块链">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="第19讲__上手搭建一条自己的智能合约">
  <meta name="twitter:description" content="上一篇我们聊到了区块链智能合约，我主要介绍了智能合约的概念，但是并没有给你提供智能合约的实际运行案例，那么今天，我们就自己动手写一个智能合约，并且介绍一下智能合约标准模板，供你参考学习，并搭建起自己的智能合约。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">第19讲__上手搭建一条自己的智能合约</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3615 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#搭建一条智能合约">搭建一条智能合约</a>
          <ul>
            <li><a href="#1-下载与安装-geth">1. 下载与安装 Geth</a></li>
            <li><a href="#2-搭建以太坊私链">2. 搭建以太坊私链</a></li>
            <li><a href="#3-编写并部署属于自己的智能合约">3. 编写并部署属于自己的智能合约</a></li>
          </ul>
        </li>
        <li><a href="#智能合约标准模板">智能合约标准模板</a>
          <ul>
            <li><a href="#1erc20">1.ERC20</a></li>
            <li><a href="#2erc223">2.ERC223</a></li>
            <li><a href="#3erc721">3.ERC721</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>上一篇我们聊到了区块链智能合约，我主要介绍了智能合约的概念，但是并没有给你提供智能合约的实际运行案例，那么今天，我们就自己动手写一个智能合约，并且介绍一下智能合约标准模板，供你参考学习，并搭建起自己的智能合约。</p>
<p>本篇将以以太坊作为基础知识进行讲解，本篇面向没有任何智能合约基础的人群，所以配备了较多的插图和操作命令，如果你正在收听音频，可以点击文稿查看，希望读完这篇文章可以帮助你快速入门智能合约。</p>
<h2 id="搭建一条智能合约">搭建一条智能合约</h2>
<p>在实际操作智能合约之前，我们首先回顾一下以太坊，以太坊又称以太坊钱包。以太坊钱包提供了包括账户管理，以太坊转账、Dapp 部署与使用在内的一些常规功能。</p>
<p>以太坊社区提供了多种语言实现的客户端和开发库，多数客户端支持 JSON-RPC2.0 标准，目前支持的客户版本有 Go-ethereum（Go 语言）、Parity（Rust 语言）、Cpp-ethereum（C++ 语言）、Ethereum-lib（Javascript)、EthererumJ(Java 语言)、Pyethapp（Python 语言)，基本涵盖了主流编程语言。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/68338a92ba19697fa016826f380e00fd.png" alt=""></p>
<p>图片来自以太坊官方文档</p>
<p>官方推荐使用的版本是 Go-ethererum，这是 Go 语言实现的版本，又称 Geth 客户端。</p>
<p>需要提醒你的是，这里客户端的实现语言并不是要求用户熟悉相应的编程语言，这里的用户是指 Dapp 开发者，比如在操作 Geth 客户端的时候，用户其实并不需要了解 Go 语言。</p>
<h3 id="1-下载与安装-geth">1. 下载与安装 Geth</h3>
<p>本文使用 Geth 来进行测试，首先我们要获取 Geth 客户端，如果用户使用的是 Ubuntu 环境的话，可以直接从 PPA 安装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> # apt-get install software-properties-common
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> # add-apt-repository -y ppa:ethereum/ethereum
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> # apt-get update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> # apt-get install ethereum
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装成功后，我们可以查看 Geth 的版本。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/ec57b623c638c8028bbef2337eb586ca.png" alt=""></p>
<p>表示我们已经安装成功，当然你可以也可以编译安装，由于篇幅有限，你可以另寻资料进行尝试。</p>
<h3 id="2-搭建以太坊私链">2. 搭建以太坊私链</h3>
<p>如果在以太坊的主网上运行和开发测试智能合约，这是不明智的，因为会消耗真实的以太币，不过我们可以使用 Geth 搭建一条属于自己的以太坊区块链，也就是以太坊私链。</p>
<p>怎么搭建呢？其实很简单，只需要修改配置文件和一些运行参数即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;config&#34;: {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;chainId&#34;: 98,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;homesteadBlock&#34;: 0,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;eip155Block&#34;: 0,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;eip158Block&#34;: 0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">},
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;difficulty&#34;: &#34;200000000&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;gasLimit&#34;: &#34;2100000&#34;,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&#34;alloc&#34;: {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;7df9a875a174b3bc565e6424a0050ebc1b2d1d82&#34;: { &#34;balance&#34;: &#34;300000&#34; },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#34;f41c74c9ae680c1aa78f42e5647a62f353b7bdde&#34;: { &#34;balance&#34;: &#34;400000&#34; }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $ geth --datadir /root/geth-test/ init genesis.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样，我们就初始化了属于自己的创世区块信息。</p>
<p>接下来我们创建一个账户，由于是用户私链挖矿，只有你一个人挖矿，所以使用 CPU 挖矿完全没有问题。</p>
<p>我们通过如下命令进入 Geth 命令行交互页面：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> $ geth --datadir /root/geth-test/ --networkid 98 console
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/4756594a72f9575213a336430a64f335.png" alt=""></p>
<p>如上图所示的那样，运行通过。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">personal.newAccount()
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们创建了一个新账户，这个账户就是 EOA 账户，并通过 eth.getBalance 获取了当前地址的余额，显示为 0。</p>
<p>输入 Exit 退出后，我们开始以挖矿模式启动，这里我们最好记录一下我们的地址：</p>
<blockquote>
<p>【0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab】</p>
</blockquote>
<p>我们使用如下命令启动挖矿，注意在 Etherbase 的地方填上述地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ geth --datadir /root/geth-test/ --networkid 98 --mine --minerthreads=1 --etherbase=0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab
</span></span></code></pre></td></tr></table>
</div>
</div><p>以太坊的 PoW 挖矿算法是内存困难型的，首先需要生成 DAG，这个视你设备的性能而定，需要耗费一定时间，请耐心等待，如下图所示，我们可以看到 DAG 生成非常耗费时间。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/d4039ec9cedce324a64454bc0652596e.png" alt=""></p>
<p>在我的远程开发机上一共耗费了 6 分半，又经过了 4 分钟，我挖到了第一个块，如下图所示。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/433bf3ca7c74071b79af7e15f68d4a39.png" alt=""></p>
<p>这期间机器的负载如下。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/fd52b8d57d6fb403f6a1c80492c10f23.png" alt=""></p>
<p>可以看到 CPU 和内存占用很高，我这里使用测试的机器是 2Core 4GB Ubuntu16.04。</p>
<p>现在我们再去检查一下 Etherbase 所指向地址的余额。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/de301f0e7e66d1e04547343c286a41de.png" alt=""></p>
<p>可以看到已经有 5 个以太币了，以太币的最小单位 wei，所以 5 后面 18 个零表示 5 个以太币。</p>
<h3 id="3-编写并部署属于自己的智能合约">3. 编写并部署属于自己的智能合约</h3>
<p>智能合约的开发与钱包是独立的，用户可以使用 IDE 进行调试等操作，目前 Dapp 的 IDE 并不多，常见有 Truffle、Embark、Remix 几种；</p>
<p>这篇文章中，我并不使用 IDE，这里仅仅会给出一些示例代码，即经典的 Hello Word，你如果想尝试编写自己的智能合约，可以使用在线 IDE。</p>
<blockquote>
<p><a href="https://ethereum.github.io/browser-solidity/%E3%80%82">https://ethereum.github.io/browser-solidity/。</a></p>
</blockquote>
<p>首先我们要获取 Solidity 编译器，通过 apt-get install solc 来安装。</p>
<p>安装成功后，我们新建一个 Solidity 源码文件，命名为 helloword.sol，并且写入代码如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pragma solidity ^0.4.11;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">contract helloWorld {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">function renderHelloWorld () returns (string) {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> return &#39;helloWorld&#39;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行 solc &ndash;bin helloword.sol 获得 EVM 二进制码。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/6d49305c51024d969ee2d733723ceb11.png" alt=""></p>
<p>编译器警告我们暂时不必理会，接下来我们还需要生成 ABI 部署参数，使用命令 solc &ndash;abi helloword.sol。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/3973f4d5c8120e6929fa02137a3a87e1.png" alt=""></p>
<p>开始部署，我们进入 console，</p>
<p>定义 code 和 abi 两个变量如下，注意 code 的值最前面有 0x，二进制数据是用十六进制表示的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&gt;</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;0x6060604052341561000f57600080fd5b6101578061001e6000396000f300606060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063942ae0a714610046575b600080fd5b341561005157600080fd5b6100596100d4565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561009957808201518184015260208101905061007e565b50505050905090810190601f1680156100c65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100dc610117565b6040805190810160405280600a81526020017f68656c6c6f576f726c6400000000000000000000000000000000000000000000815250905090565b6020604051908101604052806000815250905600a165627a7a72305820fcce0b6910e479539e4796b7d56620a6f90e03ba47449c843bec54958f68bf700029&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&gt;</span><span class="n">abi</span><span class="o">=</span><span class="p">[{</span><span class="s2">&#34;constant&#34;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&#34;inputs&#34;</span><span class="p">:[],</span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;renderHelloWorld&#34;</span><span class="p">,</span><span class="s2">&#34;outputs&#34;</span><span class="p">:[{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;string&#34;</span><span class="p">}],</span><span class="s2">&#34;payable&#34;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&#34;stateMutability&#34;</span><span class="p">:</span><span class="s2">&#34;nonpayable&#34;</span><span class="p">,</span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;function&#34;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可以在控制台分别执行，由于结果比较长，这里就不放出来了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  // 这一步解锁账户，用于方便部署合约 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  &gt;personal.unlockAccount(&#34;0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   // 使用上述定义的 abi 变量生成合约信息
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  &gt;myHelloWorld=eth.contract(abi)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  // 注入 code 信息，激活合约
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;contract=myHelloWorld.new({from:&#34;0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab&#34;,data:code,gas:1000000})   
</span></span></code></pre></td></tr></table>
</div>
</div><p>最终执行结果如下。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/69fb72e89655fc7e7c4e9d155de4cf98.png" alt=""></p>
<p>我们可以通过 txpool 来查看未确认的交易。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/e961c11aa9d93fe694306f7e8a779bd7.png" alt=""></p>
<p>接下来只要等待出块即可，你的合约就会成为正常运行的合约了，否则合约还不可以调用。</p>
<p>由于我本地挖矿出块异常缓慢，所以我尝试了 Remix IDE，运行后我们可以得到如下结果。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/81abb747906d08e5faf40f1ed1912845.png" alt=""></p>
<p>至此一个简单的 HelloWord 智能合约就生成啦，不过它的运行成本非常高昂，所以我们极力建议使用在一些方便的虚拟环境中。</p>
<h2 id="智能合约标准模板">智能合约标准模板</h2>
<p>当任何人都可以写代码自定义业务逻辑的时候，也就意味着需要一套标准让人们降低开发门槛，标准化的接口让产品之间可以协作。那么我们接下来就来讨论一下以太坊上的三种智能合约标准模板。</p>
<p>这三种模板都与 Token 有关。那么首先我们就来区分一下数字货币与 Token 的概念，数字货币一般指一个区块链项目的平台代币，比如以太坊上的以太币，元界上的 ETP 都是基础代币。</p>
<p>而 Token 往往代表了一种资产，这些资产在已经存在的其他区块链之上运行，资产还可以像商品一样交易，例如消费积分、游戏虚拟资产。Token 离具体的区块链应用也会更近，因为区块链应用的项目方通常也是 Token 的发行方。</p>
<p>目前最广泛使用的三种 Token 标准都是基于以太坊的，它们分别是 ERC20、ERC223、ERC721。这里的 ERC 表示 Ethereum Request for Comments，翻译过来就是以太坊意见征求稿。</p>
<h3 id="1erc20">1.ERC20</h3>
<p>2015 年 11 月，V 神在 Github 上提交了 ERC20 代币的技术标准，随后 2016 年到 2017 年，大量的区块链项目都使用 ERC20 作为工具进行 ICO。这使得 ERC20 成为了区块链整个行业内的 Token 标准，可见这种标准的影响之大。</p>
<p>实际上 ERC20 代币是一类运行在以太坊区块链上的智能合约，只不过这些合约代码遵循一定的规范，这个规范就是 ERC20 标准，它规定了跨 Dapp 转移 Token、Token 交易以及一些使用接口。</p>
<p>ERC20 一共定义了 6 个函数和两个触发事件，他们都是使用 Solidity 语言编写的。</p>
<p>6 个函数描述了如何转移以及 Token 的相关数据如何被访问，市面上 99% 的 ERC20 Token 都可以找到这 6 个函数。2 个事件提供了 Approve 和 Transfer 的格式化输出。</p>
<p>下面我们重点看一看 ERC20 的接口。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="o">---------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="n">ERC</span> <span class="n">Token</span> <span class="n">Standard</span> <span class="c1">#20 Interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ethereum</span><span class="o">/</span><span class="n">EIPs</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">EIPS</span><span class="o">/</span><span class="n">eip</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">standard</span><span class="o">.</span><span class="n">md</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="o">-------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">contract</span> <span class="n">ERC20Interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span> <span class="n">tokenOwner</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint</span> <span class="n">balance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">allowance</span><span class="p">(</span><span class="n">address</span> <span class="n">tokenOwner</span><span class="p">,</span> <span class="n">address</span> <span class="n">spender</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint</span> <span class="n">remaining</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">to</span><span class="p">,</span> <span class="n">uint</span> <span class="n">tokens</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="ne">bool</span> <span class="n">success</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">approve</span><span class="p">(</span><span class="n">address</span> <span class="n">spender</span><span class="p">,</span> <span class="n">uint</span> <span class="n">tokens</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="ne">bool</span> <span class="n">success</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">from</span><span class="p">,</span> <span class="n">address</span> <span class="n">to</span><span class="p">,</span> <span class="n">uint</span> <span class="n">tokens</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="ne">bool</span> <span class="n">success</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">from</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">to</span><span class="p">,</span> <span class="n">uint</span> <span class="n">tokens</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">event</span> <span class="n">Approval</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">tokenOwner</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">spender</span><span class="p">,</span> <span class="n">uint</span> <span class="n">tokens</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Allowance：允许多次创建两个不同的地址之间的单向交易，Token 的拥有者可以从此智能合约中提取 Token；</li>
<li>Approve：这个函数需要引用 Allowance，顾名思义，它定义了 Token 的拥有者同意创建属于自己的交易，这个函数要求两个参数作为输入，分别是花费者的地址，以及发送金额；</li>
<li>BalanceOf：定义了查询目标地址账户余额的接口；</li>
<li>Transfer 和 TransferFrom：定义了 Token 如何转移以及执行转移过程；</li>
<li>TotalSupply：定义了这个 Token 最大发行量。</li>
</ol>
<p>上面我们简要介绍了 ERC20 标准合约的接口，下面我们来看看升级版的 ERC20。</p>
<h3 id="2erc223">2.ERC223</h3>
<p>在某些情况下，ERC20 也有些缺陷。例如某人使用 ERC20 发送 100 个 Token 到另外一个账户，如果目标账户是一个合约账户，目标账户的合约代码如果不兼容 ERC20 标准怎么办呢？</p>
<p>这一点非常有可能，由于合约代码无法识别交易，所以这笔交易就会被拒绝。</p>
<p>我们知道以太坊使用的并不是 UTXO，这意味着合约之间不满足 ACID，那么很遗憾，发送方的这 100 个 Token 就永久地丢失了。</p>
<p>为了解决这个问题，非官方的社区开发者提交了 ERC223 模板，可以解决这个问题，使用者需要把既存的 ERC20 合约升级到 ERC223 合约。</p>
<h3 id="3erc721">3.ERC721</h3>
<p>2018 年初，有一个区块链游戏火了，叫做以太坊养猫游戏，这个游戏也是一个智能合约。它基于 ERC721 标准，实际上它也是一种 Token 标准。</p>
<p>ERC721 与 ERC20 最大的区别是：ERC721 定义了每一份 Token 都是唯一的，它们有唯一的标识。例如芒果和米饭是两种不同属性的资产，从物理世界来看，他们是不能直接混在一起使用的，我们不能把芒果加到大米中。</p>
<p>这样一来，ERC721 中 Token 的含义也转变成了一种物权所有权凭证，不再是 ERC20 中的同质资产。</p>
<h2 id="总结">总结</h2>
<p>今天我们介绍了以太坊钱包，手把手教你搭建了一条以太坊私链，并告诉你如何编译和部署智能合约，最后我还介绍了三种流行的智能合约模板，希望能帮助你上手并能深入地理解智能合约。</p>
<p>今天的问题是，除了以太坊之外，还有哪些主打智能合约的区块链项目呢？你可以给我留言，我们一起讨论。感谢你的收听，我们下次再见。</p>
<p>参考链接：</p>
<ol>
<li><a href="http://www.ethdocs.org/en/latest/ethereum-clients/go-ethereum/index.html">http://www.ethdocs.org/en/latest/ethereum-clients/go-ethereum/index.html</a></li>
<li><a href="https://github.com/ethereum/wiki/wiki/JSON-RPC">https://github.com/ethereum/wiki/wiki/JSON-RPC</a></li>
<li><a href="http://remix.ethereum.org">http://remix.ethereum.org</a></li>
<li><a href="https://github.com/ethereum/go-ethereum/wiki/Private-network">https://github.com/ethereum/go-ethereum/wiki/Private-network</a></li>
<li><a href="https://theethereum.wiki/w/index.php/ERC20%5FToken%5FStandard">https://theethereum.wiki/w/index.php/ERC20%5FToken%5FStandard</a></li>
</ol>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/6651fea80872baf69676c1873cd7b2d4.png" alt=""></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%8C%BA%E5%9D%97%E9%93%BE/">深入浅出区块链</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%8A%80%E6%9C%AF%E9%A2%86%E5%AF%BC%E5%8A%9B300%E8%AE%B2/%E7%AC%AC19%E8%AE%B2__%E5%B0%86%E4%BC%81%E4%B8%9A%E6%89%93%E9%80%A0%E6%88%90%E4%B8%80%E6%89%80%E7%BB%88%E8%BA%AB%E5%A4%A7%E5%AD%A6/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">第19讲__将企业打造成一所终身大学</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%AC%AC19%E8%AE%B2_%E7%83%AD%E7%82%B9%E5%89%96%E6%9E%90%E5%9B%9B%E5%AE%89%E5%8D%93%E7%AB%AF%E5%92%8C%E8%8B%B9%E6%9E%9C%E7%AB%AF%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB/">
            <span class="next-text nav-default">第19讲_热点剖析（四）：安卓端和苹果端游戏开发有什么区别？</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
