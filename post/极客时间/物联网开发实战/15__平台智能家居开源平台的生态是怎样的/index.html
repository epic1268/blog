<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>15__平台：智能家居开源平台的生态是怎样的？ - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是郭朝斌。
在学完了这门课程的前十几讲之后，你已经对物联网有了一个从整体到细节的全面了解。我想，你现在应该迫不及待地想要动手实践了吧？
在正式进入实战篇之前，我想以智能家居领域为例，带你了解一下开源平台。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/15__%E5%B9%B3%E5%8F%B0%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E5%BC%80%E6%BA%90%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%94%9F%E6%80%81%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/15__%E5%B9%B3%E5%8F%B0%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E5%BC%80%E6%BA%90%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%94%9F%E6%80%81%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="15__平台：智能家居开源平台的生态是怎样的？">
  <meta property="og:description" content="你好，我是郭朝斌。
在学完了这门课程的前十几讲之后，你已经对物联网有了一个从整体到细节的全面了解。我想，你现在应该迫不及待地想要动手实践了吧？
在正式进入实战篇之前，我想以智能家居领域为例，带你了解一下开源平台。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="物联网开发实战">

  <meta itemprop="name" content="15__平台：智能家居开源平台的生态是怎样的？">
  <meta itemprop="description" content="你好，我是郭朝斌。
在学完了这门课程的前十几讲之后，你已经对物联网有了一个从整体到细节的全面了解。我想，你现在应该迫不及待地想要动手实践了吧？
在正式进入实战篇之前，我想以智能家居领域为例，带你了解一下开源平台。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="5738">
  <meta itemprop="keywords" content="物联网开发实战">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="15__平台：智能家居开源平台的生态是怎样的？">
  <meta name="twitter:description" content="你好，我是郭朝斌。
在学完了这门课程的前十几讲之后，你已经对物联网有了一个从整体到细节的全面了解。我想，你现在应该迫不及待地想要动手实践了吧？
在正式进入实战篇之前，我想以智能家居领域为例，带你了解一下开源平台。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">15__平台：智能家居开源平台的生态是怎样的？</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 5738 字 </span>
          <span class="more-meta"> 预计阅读 12 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#智能家居生态开放">智能家居：生态开放</a></li>
        <li><a href="#开源平台方便定制">开源平台：方便定制</a></li>
        <li><a href="#热度比较高的开源平台">热度比较高的开源平台</a></li>
        <li><a href="#gladys-assistant-具体使用动手实践">Gladys Assistant 具体使用：动手实践</a>
          <ul>
            <li><a href="#第一步准备器材">第一步：准备器材</a></li>
            <li><a href="#第二步烧录系统镜像">第二步：烧录系统镜像</a></li>
            <li><a href="#第三步启动系统">第三步：启动系统</a></li>
            <li><a href="#第四步在-gladys-assistant-上添加设备">第四步：在 Gladys Assistant 上添加设备</a></li>
            <li><a href="#第五步模拟-mqtt-设备">第五步：模拟 MQTT 设备</a></li>
          </ul>
        </li>
        <li><a href="#小结">小结</a></li>
        <li><a href="#思考题">思考题</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是郭朝斌。</p>
<p>在学完了这门课程的前十几讲之后，你已经对物联网有了一个从整体到细节的全面了解。我想，你现在应该迫不及待地想要动手实践了吧？</p>
<p>在正式进入实战篇之前，我想以智能家居领域为例，带你了解一下开源平台。</p>
<h2 id="智能家居生态开放">智能家居：生态开放</h2>
<p>为什么选择智能家居这个领域呢？最重要的原因当然是因为实战篇的动手项目是智能家居领域的。而另一个原因是，智能家居的生态环境比较开放，很有活力，而且也更贴近我们的日常生活。</p>
<p>在第 9 讲，我提到过和工业物联网相关的一些开源项目。相比之下，工业物联网领域更加封闭，如果不是行业从业人员，你很难理解它的功能需求。</p>
<p>那么，什么是平台，平台有什么用呢？就拿智能家居平台来说好了，它给各种智能家居产品提供了一个<strong>统一的接入系统</strong>，让用户可以<strong>管理</strong>和<strong>控制</strong>产品，同时也为各种智能家居产品之间的<strong>联动</strong>提供了条件。</p>
<p>如果没有智能家居平台，那么各种智能家居产品就是一个个孤立的单品，既不能远程控制，也不能实现联动功能。</p>
<p>如果你买过小米的智能产品，应该接触过小米的米家平台，它就是一个典型的智能家居平台。国内类似的还有阿里巴巴的天猫精灵、京东微联和海尔 U+ 等。国外知名的智能家居平台有苹果的 Apple HomeKit、亚马逊的 Amazon Echo 和谷歌的 Google Home 等。</p>
<h2 id="开源平台方便定制">开源平台：方便定制</h2>
<p>不过，刚才提到的这些都是商业公司运营的平台，它们使用的技术和通信协议都是公司制定的，能够选择的产品也只能是已经接入平台的产品。作为开发实践者，我们可以定制的部分非常少。</p>
<p>所以在这一讲，我想介绍一下智能家居的开源平台生态。</p>
<p>一方面，开源平台能为你提供一个现成的基础，你可以在这个基础上快速地搭建出自己的智能家居系统。而且这些平台不但可以提供丰富的特性，一般也会提供各种定制能力，方便你基于自己的需求灵活地调整。</p>
<p>另一方面，就算你在工作中不直接使用这些开源平台，你也可以从它们的架构设计和实现逻辑中汲取灵感。</p>
<p>在介绍完智能家居的开源生态之后，我还会选择其中一个开源平台，带你在树莓派开发板上运行起来，这样你也可以初步体验一下智能家居软件。</p>
<h2 id="热度比较高的开源平台">热度比较高的开源平台</h2>
<p>那么你觉得智能家居的开源平台多吗？我告诉你，其实非常多。这也从侧面反映出智能家居是一个非常被看好的领域。</p>
<p>在这一讲中，把所有的开源项目都讲一遍是不现实的，所以我精心挑选了 5 个热度比较高的项目介绍，供你参考。</p>
<ol>
<li>Home Assistant</li>
</ol>
<p>首先要说的就是Home Assistant。由于支持丰富的硬件和软件组件，能够实现自由灵活的配置和定制开发，所以它是现在热度最高的开源平台。大量极客用户组成了庞大而活跃的社群，他们贡献了很多基于 Home Assistant 的开源组件和丰富的使用资料。</p>
<p>这些组件要怎么配置呢？在 Home Assistant 中，你需要通过 configuration.yaml 配置文件来定义你需要使用的组件以及组件之间的联动方式等。</p>
<p>从文件的扩展名你应该可以看出，它的配置文件使用的是YAML 语言。这种语言是专门为配置文件设计的，写起来比 JSON 要简单得多。</p>
<p>另外，Home Assistant 是基于 Python 3 语言实现的，理论上支持在任何有 Python 3 的系统环境中运行，当然也包括树莓派。它对于树莓派的支持非常好。</p>
<p>虽然是开源软件，但是我们也需要注意开源许可协议。Home Assistant 的代码采用的是Apache License 2.0协议。</p>
<ol>
<li>Domoticz</li>
</ol>
<p>第 2 个要讲的是Domoticz，它是一个开源的家居自动化平台，可以帮你实现对智能家居设备和传感器的控制和监测等目的。除了它原生支持的设备，你还可以使用很多开源插件。当然，你也可以选择用 Python 语言开发自己的插件，从而支持自己特有的设备。</p>
<p>Domoticz 主要是通过 Web 界面来进行自定义和配置。它还同时提供了 iOS 和 Android 两大系统的 App 供你查看和控制设备。</p>
<p>Domoticz 是基于 C++ 语言开发的。跟 Python 语言开发的软件不同，它还需要编译不同的安装包，这显然不够方便。不过，Domoticz 官方已经为 Windows 和 Linux 系统准备了二进制安装包，包括使用 ARM 架构芯片的树莓派，也已经有了编译好的可执行文件。</p>
<p>Domoticz 代码采用的是GNU General Public License v3.0（GPLv3）开源协议。</p>
<ol>
<li>openHAB</li>
</ol>
<p>第 3 个要讲的是 openHAB。它的出发点是提供一个家庭自动化的总线，所以在设计上尽量抽象而模糊设备本身，便于你根据需求添加设备和插件。在 openHAB 中，插件是通过 Bindings 来实现设备和 openHAB 内核的交换信息的。</p>
<p>交互界面方面，openHAB 也提供了丰富的选择，包括原生的 iOS 和 Android 平台的 App 以及 Web 页面和 Windows 10 应用程序等。</p>
<p>openHAB 是基于 Java 语言开发的。除了常见的电脑平台，它还支持用 Docker 镜像的方式安装使用。另外，它还专门提供了 openHABian 系统的镜像文件，所以在树莓派上使用 openHAB 软件是非常方便的。</p>
<p>openHAB 代码采用的是Eclipse Public License 2.0开源协议。</p>
<ol>
<li>Gladys Assistant</li>
</ol>
<p>第 4 个要讲的是Gladys Assistant。它是一个刚刚重新设计和开发的智能家居平台。它原生支持 Z-Wave、MQTT 和小米等设备接口，并且在平台中嵌入了自己的 NLP（自然语言处理）对话引擎。你可以在平台上定义复杂的场景模式。</p>
<p>Gladys Assistant 的主要交互界面是 Web 页面。不过这些 Web 界面在手机上的体验也非常好，因为它是基于 PWA（Progressive Web App）实现的。PWA 技术使 Web 应用在手机的体验基本和原生 App 一致。</p>
<p>Gladys Assistant 使用 JavaScript 语言实现的。它对于树莓派的支持非常不错，提供了基于 Raspbian 的系统镜像。另外，通过 Docker 的方式对 MacOS 和 Windows 系统也提供了支持。</p>
<p>Gladys Assistant 代码采用的是 Apache License 2.0开源协议。</p>
<ol>
<li>WebThingsIO</li>
</ol>
<p>不知道你是否还记得，我在加餐的书单推荐中提到过WoT标准。这里我要介绍的WebThingsIO项目正是 Mozilla 在领导开发的一个基于 WoT 理念的开源实现。</p>
<p>其中，WebThings Gateway 是一个智能家居网关软件（也就是控制中心）实现，你可以使用它提供的 Web 界面来实现对设备的查看和控制。它也支持定义联动的规则，还提供了用插件方式来扩展对其他设备的支持。</p>
<p>WebThings Gateway 主要是使用 JavaScript 语言实现的。它为树莓派专门制作了系统镜像文件，你可以直接烧录使用。对于常用的 Linux 系统，也可以直接通过软件包管理器安装使用。</p>
<p>WebThings Framework 是一个软件组件集合，你可以基于这些组件来开发支持Web Thing API的硬件设备。它有不同的编程语言实现，包括 Node.js、Python（包括 MicroPython）、Java、Rust、C++（Arduino 实现）。</p>
<p>WebThingsIO 的代码采用的是Mozilla Public License 2.0开源协议。</p>
<p>这里，我把这 5 个开源的智能家居平台的特性总结为一个表格，方便你随时参考。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/552ead514716002919531bf2be5bc31c.png" alt=""></p>
<h2 id="gladys-assistant-具体使用动手实践">Gladys Assistant 具体使用：动手实践</h2>
<p>这 5 个比较有代表性的智能家居开源平台，对于树莓派的支持都不错的。现在，我们就开始动手，在树莓派上安装一个开源平台，体验一下通过智能家居系统监测设备数值的过程。</p>
<p>使用哪个平台呢？我们就选择 Gladys Assistant 吧。它的优势是 Web 页面在手机上体验不错，不需要你去搜索或者编译手机上的 App 了。</p>
<p>其他几个开源平台的安装和使用方法都差不多。你掌握了一个，那么利用镜像文件安装其他几个也不成问题。</p>
<h3 id="第一步准备器材">第一步：准备器材</h3>
<p>首先我介绍一下需要准备的器材有哪些：</p>
<ol>
<li><strong>树莓派 Raspberry Pi 4B</strong>，要求内存 2GB 以上，但是 8GB 内存版本要谨慎选择，因为有些开源平台软件对 Arm 64bit 芯片支持不够好。</li>
<li><strong>供电电源</strong>，要求支持 3A 以上电流。</li>
<li><strong>Micro SD 卡</strong>，也叫 TF 卡，存储容量最好在 16GB 以上。在选择的时候，你要关注读写速度等级，比如 U3 表示最低写入速度是 30MB/s。同时你也要关注应用性能等级，它定义了 Micro SD 卡进行随机读写的性能，最好是选择 Application Performance Class 2（卡面上标识 A2 图标）。在卡上存储应用程序和应用程序数据时，这个性能指标非常重要。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/b75e67040be76bd996b62b139cc64211.png" alt=""></p>
<ol>
<li><strong>Micro SD 卡读卡器</strong>。有些电脑自带这个接口，如果没有的话，你可以买一个便宜的使用。</li>
<li><strong>普通网线</strong>。如果你希望以有线的方式使用树莓派，可以准备一根。同时，我也会介绍树莓派接入 Wi-Fi 的方式。</li>
</ol>
<h3 id="第二步烧录系统镜像">第二步：烧录系统镜像</h3>
<p>树莓派板子在启动的时候，会从 SD 卡读取操作系统镜像文件，完成操作系统的引导启动工作。所以我们接下来要在 SD 卡上烧录系统镜像。</p>
<p>具体怎么烧录呢？我们可以使用一个免费的烧录工具，<strong>Etcher</strong>。它支持 MacOS、Windows 和 Linux 三种主流的电脑系统，你可以从官方网站上下载和安装。也可以点击这个链接下载最新版。</p>
<p>然后，下载树莓派的系统镜像文件。树莓派有官方的操作系统镜像 Raspbian 可以选择，但是为了避免手动在 Raspbian 系统中安装 Gladys Assistant 软件的麻烦，我们直接选择官方提供的已经配置好 Gladys Assistant 的 Raspbian 镜像文件。</p>
<p>从这个链接中下载好镜像文件，并且解压缩得到&quot;img&quot;扩展名的文件。然后把 Micro SD 卡插入读卡器，或者直接插入你的电脑接口中。运行 Etcher 软件，按照步骤把镜像文件烧录到存储卡中。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/74f717d6dd6e1ec9cb249551676c3033.png" alt=""></p>
<p>树莓派支持网线接口，不过，如果你希望树莓派接入家里的 Wi-Fi 热点，而不是使用网线访问网络，那么就需要在 Micro SD 卡中增加一个配置文件。</p>
<p>这个配置文件的文件名必须是 wpa_supplicant.conf。你可以在电脑上使用自己熟悉的文本编辑器创建这个文件，并且在文件中输入下面的内容：</p>
<p>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev<br>
update_config=1<br>
country=CN</p>
<p>network={<br>
ssid=&ldquo;你的 Wi-Fi 热点 SSID 名称&rdquo;<br>
psk=&ldquo;你的 Wi-Fi 热点密码&rdquo;<br>
key_mgmt=WPA-PSK<br>
}</p>
<p>注意，将 Wi-Fi 热点的 SSID 和密码替换为你家里的 Wi-Fi 路由器的真实情况。</p>
<p>然后将这个文件拷贝到 Micro SD 卡的根目录。这时，你就可以把 Micro SD 卡插入树莓派开发板了。</p>
<h3 id="第三步启动系统">第三步：启动系统</h3>
<p>烧录好镜像文件，准备好 Micro SD 卡后，你可以把 Micro SD 卡从读卡器取出，插入树莓派的对应接口中。</p>
<p>接着，接上电源线（如果你使用网线方式，记得也将网线接入树莓派板的网口上）。这时树莓派将自动启动运行，需要等待一段时间。</p>
<p>过一会儿之后，在你的电脑上，打开浏览器，输入 &ldquo;<a href="http://gladys.local">http://gladys.local</a>&rdquo; 来访问树莓派上的 Gladys Assistant 系统，如下图所示。</p>
<p>如果你使用的电脑系统是比较老的 Windows 版本，可能无法通过这种方式访问树莓派，而是需要将“gladys.local”替换为树莓派的 IP 地址。</p>
<p>怎么获取到树莓派的 IP 地址呢？你可以使用一些网络分析软件，比如 Android 手机上安装 Network Scanner，iOS 手机上安装 iNet 来扫描网络。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/b1971907d141823d970f9b99b4d4763b.png" alt=""></p>
<p>那么，为什么不给树莓派接一个显示器，而要通过你的电脑上的浏览器来访问呢？这是因为 Gladys Assistant 为了简化镜像，没有提供可视化的桌面环境。其实你只要熟悉了操作方法，就会发现这样的设计是非常方便的，因为你不需要为树莓派再准备个显示器了。</p>
<h3 id="第四步在-gladys-assistant-上添加设备">第四步：在 Gladys Assistant 上添加设备</h3>
<p>因为我们是第一次配置 Gladys Assistant，所以要在上面的页面中选择“Create local account with your Email”，来创建一个本地账号。</p>
<p>创建完账号后，其他的步骤不是必填项，你根据喜好填写就行了。房屋配置部分，你可以创建一个名称为 bedroom 的房间，后面会用到。最后，你应该可以看到这个 Dashboard 页面。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/5d4f75452ddd25f2552d8db4d90d5ca2.png" alt=""></p>
<p>接下来，我们来添加一个设备，来体验一下 Gladys Assistant 的功能。</p>
<p>那么，添加什么设备呢？我们还没有讲到实战篇的具体项目呢。不过，我们可以用电脑来模拟一个设备。你还记得第 8 讲介绍的 MQTT 协议吗？Gladys Assistant 系统支持 MQTT 通信协议的设备。所以，我们可以通过电脑终端的命令行来模拟一个设备，发送 MQTT 消息给 Gladys Assistant，让 Gladys Assistant 来展示这个设备。</p>
<p>首先，我们在 Gladys Assistant 上准备 MQTT Broker。选择 Dashboard 上部的标签页“Integrations”，点击 MQTT 标签。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/5367dec67c8a1131b0a0a353d09327f6.png" alt=""></p>
<p>进入 MQTT 设置界面后，你现在需要点击左边的 Setup，开始安装 MQTT Broker。我们通过默认选项，即使用 Docker 的方式来完成。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/986e433b0e6e19aba62ac6a3f10443ef.png" alt=""></p>
<p>这个过程需要几分钟时间。完成后，你就可以看到 MQTT Broker 的用户名和密码。我将密码改成了 geektimetest，为了便于记忆，你也可以选择一个自己的密码。同时，你需要将用户名和密码记录下来，因为后面模拟设备发送 MQTT 消息时会用到。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/c2ae981a35ac0264c062116047148d7d.png" alt=""></p>
<p>接着，我们点击左边的 Device，切换到 MQTT 设备页面。点击右上角的 New 打开创建页面。设备名称我们可以选择 Temperature Sensor，External ID 填写 mqtt:bedroom:temperature-sensor。字符串中 bedroom 是和下一项房间填写的信息一致的。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/cfdc56b02db277cc4d474382bdb69718.png" alt=""></p>
<p>然后，我们为设备添加特性（Features）。这里，我们选择 Temperature 类型。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/f23b73f12d26c16bd293bda12875a08b.png" alt=""></p>
<p>选择完类型后，我们点击 Add feature，开始设置具体的特性参数。你可以按照下图的内容来设置自己的参数。其中，external ID 填写 mqtt:bedroom:temperature-sensor:temperature 字符串。最下面的 MQTT Topic，你需要记录下来，后面发送消息时需要用到。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/91280a6df2271729979fd74f323997ff.png" alt=""></p>
<p>点击下部的保存（Save）和返回（Back），然后我们可以看到创建完成的 MQTT 设备。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/f4330c712a07825afb7d311a092b7e44.png" alt=""></p>
<p>在模拟发送 MQTT 消息之前，我们还需要编辑一下 Dashboard 界面。你需要点击左上角切换回 Home 标签页，然后点击右上角的 Edit 按键。在编辑界面的 Column 1 选择 Devices in room 类别。然后依次选择 bedroom 和我们刚创建的设备 Temperature Sensor 传感器。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/a0b31a0c4b49ceb26daf9c0d1c376bc3.png" alt=""></p>
<p>点击页面右下角的 Save，保存 Dashboard 的编辑界面。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/fc5f6a6bf134eb47b2de558a65ec2dcb.png" alt=""></p>
<p>当然，现在传感器没有数值显示。</p>
<h3 id="第五步模拟-mqtt-设备">第五步：模拟 MQTT 设备</h3>
<p>接下来，我们打开一个终端命令窗口，输入下面的命令：</p>
<p>hbmqtt_pub -d &ndash;url mqtt://gladys:geektimetest@gladys.local:1883 -t gladys/master/device/mqtt:bedroom:temperature-sensor/feature/mqtt:bedroom:temperature-sensor:temperature/state -m 25.2</p>
<p>其中，gladys:geektimetest 是用户名和密码，它们以分号相连。gladys.local 是树莓派的域名。-t 后面的消息主题就是你刚才记录的 MQTT Topic 字符串。-m 后面是温度数值。</p>
<p>执行这个命令后，你再打开 Gladys Assistant 的 Dashboard 界面，这时你就可以看到设备卡片显示出来了刚才发送的温度数值。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/329d71f01b7bcbc88b43eb30b729f050.png" alt=""></p>
<h2 id="小结">小结</h2>
<p>总结一下，在这一讲中，我介绍了智能家居开源平台的生态，并且带你动手在树莓派上安装了 Gladys Assistant，然后体验了一下使用过程。</p>
<ol>
<li>智能家居平台为各种智能家居产品提供了一个统一的接入系统，让用户可以管理和控制产品，同时也为各种智能家居产品之间的联动提供了条件。</li>
<li>了解开源的智能家居平台有两大好处，一是你可以基于它们快速地搭建智能家居系统，另一个是你可以在工作中借鉴它们的设计思想和架构。</li>
<li>开源的智能家居平台有很多，热度比较高的平台有 5 个，分别是 Home Assistant、Domoticz、openHAB、Gladys Assistant 和 WebThingsIO。</li>
<li>利用开源平台，在树莓派开发板上搭建智能家居系统的一般步骤包括：准备器材，烧录系统镜像，启动系统，添加设备，接收和显示设备信息等。</li>
</ol>
<p>在实战篇，等你掌握了开发智能硬件的基本方法，可以将这一讲中的模拟设备替换为真实的温度传感器设备。期待你的动手实践。</p>
<p>而且之后，等你熟悉树莓派开发板的使用方法，你也可以在树莓派上尝试一下其它几个开源平台。它们的基本功能都比较接近，你可以根据自己喜好，或者熟悉的编程语言选择。</p>
<h2 id="思考题">思考题</h2>
<p>最后，我给你留一个思考题吧。</p>
<p>在这一讲的动手实验环节，我们是通过访问http://gladys.local 来查看 Gladys Assistant 的 Dashboard 等 Web 应用界面的。为什么我们可以通过 gladys.local 域名来访问树莓派开发板呢？为什么有的老版本电脑系统不支持呢？这是使用了什么网络协议？</p>
<p>欢迎你在留言区写一写自己的答案，也欢迎你将这一讲分享给对智能家居 DIY 感兴趣的朋友，大家一起交流学习。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/">物联网开发实战</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/15__%E5%86%85%E5%AD%98%E8%A7%86%E8%A7%92%E4%B8%80%E5%A6%82%E4%BD%95%E6%9C%80%E5%A4%A7%E5%8C%96%E5%86%85%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8%E6%95%88%E7%8E%87/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">15__内存视角（一）：如何最大化内存的使用效率？</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E8%AF%B4%E9%80%8F%E5%8C%BA%E5%9D%97%E9%93%BE/15__%E5%8C%BA%E5%9D%97%E9%93%BE&#43;%E7%A4%BE%E4%BC%9A%E6%B2%BB%E7%90%86%E5%8C%BA%E5%9D%97%E9%93%BE%E5%A6%82%E4%BD%95%E4%B8%BA%E6%B2%BB%E7%90%86%E6%8F%90%E4%BE%9B%E6%96%B0%E6%96%B9%E6%A1%88/">
            <span class="next-text nav-default">15__区块链&#43;社会治理：区块链如何为治理提供新方案？</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
