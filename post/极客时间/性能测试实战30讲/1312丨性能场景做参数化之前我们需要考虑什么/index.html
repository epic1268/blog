<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>1312丨性能场景做参数化之前我们需要考虑什么 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="12丨性能场景：做参数化之前，我们需要考虑什么？
在性能测试中，我们要关注的数据主要有以下几类，分别是参数化数据、监控数据和基础铺底数据。
我们今天先描述第一种参数化数据，在后面的文章中再描述其他数据。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%9830%E8%AE%B2/1312%E4%B8%A8%E6%80%A7%E8%83%BD%E5%9C%BA%E6%99%AF%E5%81%9A%E5%8F%82%E6%95%B0%E5%8C%96%E4%B9%8B%E5%89%8D%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E4%BB%80%E4%B9%88/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%9830%E8%AE%B2/1312%E4%B8%A8%E6%80%A7%E8%83%BD%E5%9C%BA%E6%99%AF%E5%81%9A%E5%8F%82%E6%95%B0%E5%8C%96%E4%B9%8B%E5%89%8D%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E4%BB%80%E4%B9%88/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="1312丨性能场景做参数化之前我们需要考虑什么">
  <meta property="og:description" content="12丨性能场景：做参数化之前，我们需要考虑什么？
在性能测试中，我们要关注的数据主要有以下几类，分别是参数化数据、监控数据和基础铺底数据。
我们今天先描述第一种参数化数据，在后面的文章中再描述其他数据。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="性能测试实战30讲">

  <meta itemprop="name" content="1312丨性能场景做参数化之前我们需要考虑什么">
  <meta itemprop="description" content="12丨性能场景：做参数化之前，我们需要考虑什么？
在性能测试中，我们要关注的数据主要有以下几类，分别是参数化数据、监控数据和基础铺底数据。
我们今天先描述第一种参数化数据，在后面的文章中再描述其他数据。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3921">
  <meta itemprop="keywords" content="性能测试实战30讲">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="1312丨性能场景做参数化之前我们需要考虑什么">
  <meta name="twitter:description" content="12丨性能场景：做参数化之前，我们需要考虑什么？
在性能测试中，我们要关注的数据主要有以下几类，分别是参数化数据、监控数据和基础铺底数据。
我们今天先描述第一种参数化数据，在后面的文章中再描述其他数据。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">1312丨性能场景做参数化之前我们需要考虑什么</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3921 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>12丨性能场景：做参数化之前，我们需要考虑什么？</p>
<p>在性能测试中，我们要关注的数据主要有以下几类，分别是参数化数据、监控数据和基础铺底数据。</p>
<p>我们今天先描述第一种参数化数据，在后面的文章中再描述其他数据。</p>
<p>首先我们需要了解，为什么要关注性能场景中的参数化数据呢？我以下面的两个例子说明一下。</p>
<p>在我的工作经历中，见过很多初级性能测试工程师不知道如何设置合理的参数化数据，以至于数据会出现这两种情况。</p>
<p>1. 数据不均衡</p>
<p>有些人直接用同一个数据执行混合场景测试，在这种情况下对服务器的压力和真实环境下的完全不一样。有时我们不得不造很多参数化数据，也有很多工程师不考虑数据库表中的数据直方图，就直接在少量的参数化数据中创建了大量的相关记录。比如说，在电商系统中造出大量的购买记录；在银行系统中造出大量的个人流水记录。</p>
<p>这些都不能满足真实用户场景的需要，导致的结果就是整个测试结果都毫无意义。</p>
<p>2. 参数化数据量不足</p>
<p>有时候，如果我们选择用非常少量的数据运行大量业务操作的场景，就会导致压力和真实生产环境完全不一致。比如说，用 100 个数据运行出上万甚至上亿的业务操作。</p>
<p>那么到底该怎样才能合理地设置参数化数据呢？</p>
<p>参数化数据的疑问</p>
<p>根据我的经验，在参数化测试数据的获取和考虑上，我们一般会有以下四个常见的疑问。</p>
<p>参数化数据应该用多少数据量？</p>
<p>参数化数据从哪里来？</p>
<p>参数多与少的选择对系统压力有什么影响？</p>
<p>参数化数据在数据库中的直方图是否均衡？</p>
<p>接下来，我们对这些问题一一做出解答。</p>
<p>参数化数据应该用多少数据量？</p>
<p>首先，参数化数据要用到多少取决于场景，举例来说，对一个压力工具线程数为 100，TPS 有 1000 的系统，如果要运行 30 分钟，则应该取得的参数化数据是下面这样的。</p>
<p>数据类型、限制条件和数据量计算的方式如下表所示：</p>
<p>从技术角度看，根据数据类型就可以确定应该用多少条参数化数据了。但是这样考虑就够了吗？当然是不够的。因为除了技术的限制之外，还有业务场景的需求。</p>
<p>根据业务场景计算参数化数据量</p>
<p>在性能场景中，我们需要根据实际的业务场景来分析需要用到什么样的数据，以便计算数据量。这里的数据类型包括可循环使用的数据和不可循环使用的数据。用户登录是一个在各行业中几乎都会遇到的事务，我们拿它来举例说明，下面这张图是一个用户登录的界面。</p>
<p>这里需要用到两种数据，一个是帐号，一个是密码。帐号和密码一定是可以真实登录到系统的，不然无法完成后续的业务。很显然对于登录来说，不同的人一定是用不同的用户登录的。</p>
<p>场景一</p>
<p>首先我们来看下场景一。有时候我们做脚本时考虑的是，有多少线程（Thread）就配置多少用户，让每个线程在同一个用户上循环执行。</p>
<p>如下图所示：</p>
<p>需要注意的是，在本文中，每一个“—user1→”代表一次脚本完全的迭代。</p>
<p>这样的用户参数化配置，只能满足一些比较特定的场景。比如说，用户在早上登录系统之后，一直在系统中带着登录 session 做业务操作，并且不会退出，只有在下班时才退出系统。</p>
<p>当我们要模拟一天中的业务峰值时，可以像上面这样配置。登录一次，循环使用同一用户的 Session 信息。这就是前面提到的部分可循环数据。</p>
<p>在这样的场景中，有多少线程就需要准备多少用户数据。即：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">场景二
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">但在有些场景中，这是完全错误的配置方式。比如说电商系统，用同一个用户账号不停循环购买商品，就是不符合真实场景的。```
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这时侯怎么办？我们可以用在压力测试工具中模拟出来的线程的每一次迭代来代表一个用户，如下所示：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这就是不可循环使用的数据。在这样的场景中，就需要考虑场景的 TPS 和持续时间了。用户数据的计算方法是：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```Javatpsx 持续时间（秒级）```
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我们举个例子，假如有一个 100TPS 的场景，持续 30 分钟。那么计算方式如下：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```Java100x30\*60=180000（条用户数据）```
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这里再多说一句，压力工具的线程数量也并不是常说的并发数的概念。这个我们在前面已经说得很清楚了。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">场景三
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">但是还有一种情况，就是在一个线程之中，可以循环使用固定条目的数据。如下所示：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在这种情况下，我们就需要根据实际的业务场景判断了。在同样的 100TPS 场景中，如果准备了 1000 条数据，就可以让每个线程用 10 个不同的数据。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这样的场景没有固定的条数限制，只能根据实际的业务判断。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">所以在配置参数之前，我们需要先判断这个参数是什么类型的数据。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果是可循环使用的数据，那么它在真实的性能场景中非常少，也就是说只使用一条或几条测试数据的真实业务场景是非常少的。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数化数据从哪里来？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">计算了参数化数据量之后，还有一个重要的问题需要解决，就是参数化数据从哪里来呢？这一步的目的是要确保参数的有效性。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数化数据从大体上划分，主要有两个来源。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第一类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户输入的数据在后台数据库中已存在，比如我们上面示例中的用户数据。这类数据的特点是什么呢？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">存在后台数据库中；
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">需要用户主动输入；
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户输入的数据会和后台数据库中的数据做比对。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这类数据必须查询数据库之后再参数化到工具中。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">第二类
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用户输入的数据在后台数据库中不存在。在业务流中，这些数据会 Insert 或 Update 到数据库中。这类数据的特点是什么呢？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">数据库中原本不存在这些数据；
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在脚本执行成功后会将这些数据 insert 或 update 到数据库中；
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">每个用户输入的数据可能相同，也可能不同，这取决于业务特点。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这类数据必须通过压力工具做参数化，同时也必须满足业务规则。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我同样用前面的用户参数为例，由于用户登录的时候一定要和数据库中的用户数据做比对，只有用户名密码都完全正确的情况下才可以成功登录，所以这样的用户参数一定要从后台数据库中查询得到。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在本例中，通过后台数据库用户表的查询真实可用的用户数共有 10 万。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果在业务场景中，是不可循环使用的用户数据，那么很显然，在可以支持 100TPS 并发的系统中，这些用户数量只够使用 16.67 分钟。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```Java100000/100/60=16.67（分钟）```
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">总之，参数化时需要确保数据来源以保证数据的有效性，千万不能随便造数据。这类数据应该满足两个条件：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">要满足生产环境中数据的分布；
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">要满足性能场景中数据量的要求。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数取多与少对系统压力有什么影响？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">根据上文中的第二个条件，这里就要说一下数据量的要求了。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">从经验上判断，对一个系统来说，获取的参数化数据是否合理，会直接影响压力测试的结果有没有意义。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我们根据下面这张图来理解一下数据在系统中的流转。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这张图中，绿色部分代表数据在各系统中的正常大小，而黑色部分代表压力工具中使用的数据量大小。如果压力工具使用的数据量少，那么应用服务器、缓存服务器、数据库服务器，都将使用少量的缓存来处理。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">显然图中所示的黑色部分是很少的，完全不能把后端各类服务器的缓存占用到真实场景中应该有的大小，所以在这种状态之下是测试不出来真实场景下的压力的。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">对数据库连接的存储设备来说同样也有影响。如果数据量少，则相应的存储的 I/O 使用就少。对于一个没有被 Cache 的数据来说，首次使用肯定会触发 I/O，也就是会产生寻址、PageFalut 等情况。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数取得过多，对系统的压力就会大；参数取得过少，不符合真实场景中的数据量，则无法测试出系统真实的压力。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数化数据在数据库中的直方图是否均衡？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">对于参数化数据来说，如果数据取自于数据图，我们通常要检查一下数据库中的数据直方图。 对于直接从生产上拿的数据来说，数据的分布更为精准。但是对于一些在测试环境中造的数据，则一定要在造数据之后，检查下数据分布是否与生产一致。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我们以一个案例开始。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在性能场景执行过程中，有一个业务的 TPS 如下图所示：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">很明显，图中 TPS 中间掉下来的情况是非常不合理的。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">为什么会导致这个情况呢？在这个示例中，这种现象是由抽取的数据量不合理导致的，我们来看一下数据分布。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```客户 iD，客户流水记录数&#39;客户 ID1&#39;, &#39;69865&#39;&#39;客户 ID2&#39;, &#39;55075&#39;......&#39;客户 ID5374728, &#39;177&#39;&#39;客户 ID5374729&#39;, &#39;176&#39;&#39;客户 ID5374730&#39;, &#39;175&#39;```
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">显然通过统计之后，我们可以发现客户的流水记录数是完全不均衡的，而这个业务脚本是会返回客户的流水记录的。当用到记录数多的客户 ID 时，就会导致 TPS 严重下降，这是因为这些数据都要从存储设备中获取，一旦数据量多，就会导致一系列的资源开销；而用到记录数少的客户 ID 时，TPS 就很高。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">那么针对这种情况，我们该怎么处理呢？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">首先分析业务逻辑，确认客户流水是否应该这么多。在这个场景中，我们分析过业务，客户的流水通常情况下都会在 100~200 之间，这是合理的情况，而上万的数据量就是完全不合理的。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">然后我们过滤掉不合理的数据即可。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这样得到的参数化数据就符合真实场景了。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">总结
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">在今天的文章中，需要你领悟到的是，参数化数据的合理性对性能场景有着举足轻重的作用。通常，我们在做参数化数据之前，需要先分析实际业务的逻辑。比如说：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">什么数据是唯一的？什么数据是可重复使用的？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">数据是客户主动输入，后端只保存即可，还是客户输入后，后端需要比对？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">这些都是我们在做参数化之前要分析的部分。而参数化的数据量的重要性，不仅和业务需求相关，也和数据存储和查询的方式相关。这个话题我们在后面也会讨论到。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">思考题
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果你吸收了这篇文章的内容，不妨思考一下下面这两道题：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数化数据的分析重点是哪些？在不同的场景中为什么参数化数据有如此大的差异？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参数化数据的来源和获取要符合哪些规则？当不符合获取规则时，会产生什么问题？
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">欢迎你在评论区写下你的思考，也欢迎把这篇文章分享给你的朋友或者同事，一起交流学习一下。
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%9830%E8%AE%B2/">性能测试实战30讲</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/1312%E4%B8%A8%E8%A7%86%E5%9B%BE%E5%9C%A8sql%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%E5%AE%83%E6%98%AF%E6%80%8E%E6%A0%B7%E5%B7%A5%E4%BD%9C%E7%9A%84/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">1312丨视图在SQL中的作用是什么它是怎样工作的</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BB%A3%E7%A0%81%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/1312%E4%B8%A8%E7%BB%84%E7%BB%87%E5%A5%BD%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%E8%A6%81%E6%9C%89%E7%94%A8%E6%88%B7%E6%80%9D%E7%BB%B4/">
            <span class="next-text nav-default">1312丨组织好代码文件要有用户思维</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
