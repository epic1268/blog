<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>11_服务发布和引用的实践 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="在专栏第 4 期，我给你讲解了服务发布和引用常见的三种方式：Restful API、XML 配置以及 IDL 文件。今天我将以 XML 配置方式为例，给你讲解服务发布和引用的具体实践以及可能会遇到的问题。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E5%BE%AE%E6%9C%8D%E5%8A%A1/11_%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%92%8C%E5%BC%95%E7%94%A8%E7%9A%84%E5%AE%9E%E8%B7%B5/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E5%BE%AE%E6%9C%8D%E5%8A%A1/11_%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E5%92%8C%E5%BC%95%E7%94%A8%E7%9A%84%E5%AE%9E%E8%B7%B5/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="11_服务发布和引用的实践">
  <meta property="og:description" content="在专栏第 4 期，我给你讲解了服务发布和引用常见的三种方式：Restful API、XML 配置以及 IDL 文件。今天我将以 XML 配置方式为例，给你讲解服务发布和引用的具体实践以及可能会遇到的问题。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="从0开始学微服务">

  <meta itemprop="name" content="11_服务发布和引用的实践">
  <meta itemprop="description" content="在专栏第 4 期，我给你讲解了服务发布和引用常见的三种方式：Restful API、XML 配置以及 IDL 文件。今天我将以 XML 配置方式为例，给你讲解服务发布和引用的具体实践以及可能会遇到的问题。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3173">
  <meta itemprop="keywords" content="从0开始学微服务">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="11_服务发布和引用的实践">
  <meta name="twitter:description" content="在专栏第 4 期，我给你讲解了服务发布和引用常见的三种方式：Restful API、XML 配置以及 IDL 文件。今天我将以 XML 配置方式为例，给你讲解服务发布和引用的具体实践以及可能会遇到的问题。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">11_服务发布和引用的实践</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3173 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#xml-配置方式的服务发布和引用流程">XML 配置方式的服务发布和引用流程</a></li>
        <li><a href="#服务发布和引用的那些坑">服务发布和引用的那些坑</a></li>
        <li><a href="#总结">总结</a></li>
        <li><a href="#思考题">思考题</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>在<a href="./14425.md">专栏第 4 期</a>，我给你讲解了服务发布和引用常见的三种方式：Restful API、XML 配置以及 IDL 文件。今天我将以 XML 配置方式为例，给你讲解服务发布和引用的具体实践以及可能会遇到的问题。</p>
<p>首先我们一起来看下 XML 配置方式，服务发布和引用的具体流程是什么样的。</p>
<h2 id="xml-配置方式的服务发布和引用流程">XML 配置方式的服务发布和引用流程</h2>
<p><strong>1. 服务提供者定义接口</strong></p>
<p>服务提供者发布服务之前首先要定义接口，声明接口名、传递参数以及返回值类型，然后把接口打包成 JAR 包发布出去。</p>
<p>比如下面这段代码，声明了接口 UserLastStatusService，包含两个方法 getLastStatusId 和 getLastStatusIds，传递参数一个是 long 值、一个是 long 数组，返回值一个是 long 值、一个是 map。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">package com.weibo.api.common.status.service;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> public interface UserLastStatusService {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     * @param uids
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     * @return
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     */
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    public long getLastStatusId(long uid);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     /**
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     * @param uids
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     * @return
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     */
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    public Map&lt;Long, Long&gt; getLastStatusIds(long[] uids);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2. 服务提供者发布接口</strong></p>
<p>服务提供者发布的接口是通过在服务发布配置文件中定义接口来实现的。</p>
<p>下面我以一个具体的服务发布配置文件 user-last-status.xml 来给你讲解，它定义了要发布的接口 userLastStatusLocalService，对外暴露的协议是 Motan 协议，端口是 8882。并且针对两个方法 getLastStatusId 和 getLastStatusIds，通过 requestTimeout=&ldquo;300&rdquo; 单独定义了超时时间是 300ms，通过 retries=&ldquo;0&rdquo; 单独定义了调用失败后重试次数为 0，也就是不重试。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">beans</span> <span class="n">xmlns</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">context</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">aop</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/aop&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/context</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">beans</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">beans</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">beans</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">aop</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">aop</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">aop</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">service</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&#34;userLastStatusLocalService&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;50&#34;</span> <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>    <span class="n">interface</span><span class="o">=</span><span class="s2">&#34;com.weibo.api.common.status.service.UserLastStatusService&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">basicService</span><span class="o">=</span><span class="s2">&#34;serviceBasicConfig&#34;</span> <span class="k">export</span><span class="o">=</span><span class="s2">&#34;motan:8882&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">method</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;getLastStatusId&#34;</span> <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;300&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">method</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;getLastStatusIds&#34;</span> <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;300&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">motan</span><span class="p">:</span><span class="n">service</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&lt;/</span><span class="n">beans</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后服务发布者在进程启动的时候，会加载配置文件 user-last-status.xml，把接口对外暴露出去。</p>
<p><strong>3. 服务消费者引用接口</strong></p>
<p>服务消费者引用接口是通过在服务引用配置文件中定义要引用的接口，并把包含接口定义的 JAR 包引入到代码依赖中。</p>
<p>下面我再以一个具体的服务引用配置文件 user-last-status-client.xml 来给你讲解，它定义服务消费者引用了接口 commonUserLastStatusService，接口通信协议是 Motan。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">beans</span> <span class="n">xmlns</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">context</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="n">xmlns</span><span class="p">:</span><span class="n">aop</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/aop&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s2">&#34;http://www.springframework.org/schema/context</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">beans</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">beans</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">beans</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">aop</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">springframework</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">aop</span><span class="o">/</span><span class="n">spring</span><span class="o">-</span><span class="n">aop</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="n">xsd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">protocol</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;motan&#34;</span> <span class="n">default</span><span class="o">=</span><span class="s2">&#34;true&#34;</span> <span class="n">loadbalance</span><span class="o">=</span><span class="s2">&#34;${service.loadbalance.name}&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">basicReferer</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;userLastStatusServiceClientBasicConfig&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="n">protocol</span><span class="o">=</span><span class="s2">&#34;motan&#34;</span>  <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&lt;!--</span> <span class="err">导出接口</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">referer</span> <span class="n">id</span><span class="o">=</span><span class="s2">&#34;commonUserLastStatusService&#34;</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&#34;com.weibo.api.common.status.service.UserLastStatusService&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">basicReferer</span><span class="o">=</span><span class="s2">&#34;userLastStatusServiceClientBasicConfig&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">&lt;/</span><span class="n">beans</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后服务消费者在进程启动时，会加载配置文件 user-last-status-client.xml 来完成服务引用。</p>
<p>上面所讲的服务发布和引用流程看似比较简单，但在实际使用过程中，还是有很多坑的，比如在实际项目中经常会遇到这个问题：一个服务包含了多个接口，可能有上行接口也可能有下行接口，每个接口都有超时控制以及是否重试等配置，如果有多个服务消费者引用这个服务，是不是每个服务消费者都必须在服务引用配置文件中定义？</p>
<p>你可以先思考一下这个问题，联系自己的实践经验，是否有理想的解决方案呢？</p>
<h2 id="服务发布和引用的那些坑">服务发布和引用的那些坑</h2>
<p>根据我的项目经验，在一个服务被多个服务消费者引用的情况下，由于业务经验的参差不齐，可能不同的服务消费者对服务的认知水平不一，比如某个服务可能调用超时了，最好可以重试来提供调用成功率。但可能有的服务消费者会忽视这一点，并没有在服务引用配置文件中配置接口调用超时重试的次数，<strong>因此最好是可以在服务发布的配置文件中预定义好类似超时重试次数</strong>，即使服务消费者没有在服务引用配置文件中定义，也能继承服务提供者的定义。这就是下面要讲的服务发布预定义配置。</p>
<p><strong>1. 服务发布预定义配置</strong></p>
<p>以下面的服务发布配置文件 server.xml 为例，它提供了一个服务 contentSliceRPCService，并且明确了其中三个方法的调用超时时间为 500ms 以及超时重试次数为 3。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">service</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&#34;contentSliceRPCService&#34;</span>       <span class="n">interface</span><span class="o">=</span><span class="s2">&#34;cn.sina.api.data.service.ContentSliceRPCService&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">basicService</span><span class="o">=</span><span class="s2">&#34;serviceBasicConfig&#34;</span> <span class="k">export</span><span class="o">=</span><span class="s2">&#34;motan:8882&#34;</span> <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">method</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;saveContent&#34;</span> <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;500&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;3&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">method</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;deleteContent&#34;</span> <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;500&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;3&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="o">&lt;</span><span class="n">motan</span><span class="p">:</span><span class="n">method</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;updateContent&#34;</span> <span class="n">requestTimeout</span><span class="o">=</span><span class="s2">&#34;500&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">retries</span><span class="o">=</span><span class="s2">&#34;3&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">motan</span><span class="p">:</span><span class="n">service</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>假设服务引用的配置文件 client.xml 的内容如下，那么服务消费者就会默认继承服务发布配置文件中设置的方法调用的超时时间以及超时重试次数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;motan:referer id=&#34;contentSliceRPCService&#34; interface=&#34;cn.sina.api.data.service.ContentSliceRPCService&#34;     basicReferer=&#34;contentSliceClientBasicConfig&#34; &gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/motan:referer&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过服务发布预定义配置可以解决多个服务消费者引用服务可能带来的配置复杂的问题，这样是不是最优的解决方案呢？</p>
<p>实际上我还遇到过另外一种极端情况，一个服务提供者发布的服务有上百个方法，并且每个方法都有各自的超时时间、重试次数等信息。服务消费者引用服务时，完全继承了服务发布预定义的各项配置。这种情况下，服务提供者所发布服务的详细配置信息都需要存储在注册中心中，这样服务消费者才能在实际引用时从服务发布预定义配置中继承各种配置。</p>
<p>这里就存在一种风险，当服务提供者发生节点变更，尤其是在网络频繁抖动的情况下，所有的服务消费者都会从注册中心拉取最新的服务节点信息，就包括了服务发布配置中预定的各项接口信息，这个信息不加限制的话可能达到 1M 以上，如果同时有上百个服务消费者从注册中心拉取服务节点信息，在注册中心机器部署为百兆带宽的情况下，很有可能会导致网络带宽打满的情况发生。</p>
<p>面对这种情况，<strong>最好的办法是把服务发布端的详细服务配置信息转移到服务引用端</strong>，这样的话注册中心中就不需要存储服务提供者发布的详细服务配置信息了。这就是下面要讲的服务引用定义配置。</p>
<p><strong>2. 服务引用定义配置</strong></p>
<p>以下面的服务发布配置文件为例，它详细定义了服务 userInfoService 的各个方法的配置信息，比如超时时间和重试次数等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;motan:service ref=&#34;userInfoService&#34; requestTimeout=&#34;50&#34; retries=&#34;2&#34;                   interface=&#34;cn.sina.api.user.service.UserInfoService&#34; basicService=&#34;serviceBasicConfig&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;motan:method name=&#34;addUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateUserPortrait&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;modifyUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;addUserTags&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;delUserTags&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;processUserCacheByNewMyTriggerQ&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;modifyObjectUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;addObjectUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateObjectUserPortrait&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateObjectManager&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;add&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;deleteObjectManager&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttr&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttrList&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getAllUserAttr&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttr2&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;/motan:service&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以像下面一样，把服务 userInfoService 的详细配置信息转移到服务引用配置文件中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;motan:referer id=&#34;userInfoService&#34; interface=&#34;cn.sina.api.user.service.UserInfoService&#34; basicReferer=&#34;userClientBasicConfig&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;addUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateUserPortrait&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;modifyUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;addUserTags&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;delUserTags&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;processUserCacheByNewMyTriggerQ&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;modifyObjectUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;addObjectUserInfo&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateObjectUserPortrait&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;updateObjectManager&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;add&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;deleteObjectManager&#34; requestTimeout=&#34;300&#34; retries=&#34;0&#34;/&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttr&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttrList&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getAllUserAttr&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;motan:method name=&#34;getUserAttr2&#34; requestTimeout=&#34;300&#34; retries=&#34;1&#34; /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;/motan:referer&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样的话，服务发布配置文件可以简化为下面这段代码，是不是信息精简了许多。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;motan:service ref=&#34;userInfoService&#34; requestTimeout=&#34;50&#34; retries=&#34;2&#34;                   interface=&#34;cn.sina.api.user.service.UserInfoService&#34; basicService=&#34;serviceBasicConfig&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &lt;/motan:service&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在进行类似的服务详细信息配置，由服务发布配置文件迁移到服务引用配置文件的过程时，尤其要注意迁移步骤问题，这就是接下来我要给你讲的服务配置升级问题。</p>
<p><strong>3. 服务配置升级</strong></p>
<p>实际项目中，我就经历过一次服务配置升级的过程。由于引用服务的服务消费者众多，并且涉及多个部门，升级步骤就显得异常重要，通常可以按照下面步骤操作。</p>
<ul>
<li>各个服务消费者在服务引用配置文件中添加服务详细信息。</li>
<li>服务提供者升级两台服务器，在服务发布配置文件中删除服务详细信息，并观察是否所有的服务消费者引用时都包含服务详细信息。</li>
<li>如果都包含，说明所有服务消费者均完成升级，那么服务提供者就可以删除服务发布配置中的服务详细信息。</li>
<li>如果有不包含服务详细信息的服务消费者，排查出相应的业务方进行升级，直至所有业务方完成升级。</li>
</ul>
<h2 id="总结">总结</h2>
<p>今天我给你介绍了 XML 配置方式的服务发布和引用的具体流程，简单来说就是服务提供者定义好接口，并且在服务发布配置文件中配置要发布的接口名，在进程启动时加载服务发布配置文件就可以对外提供服务了。而服务消费者通过在服务引用配置文件中定义相同的接口名，并且在服务引用配置文件中配置要引用的接口名，在进程启动时加载服务引用配置文件就可以引用服务了。</p>
<p>在业务具体实践过程中可能会遇到引用服务的服务消费者众多，对业务的敏感度参差不齐的问题，所以在服务发布的时候，最好预定义好接口的各种配置。在服务规模不大，业务比较简单的时候，这样做比较合适。但是对于复杂业务，虽然服务发布时预定义好接口的各种配置，但在引用的服务消费者众多且同时访问的时候，可能会引起网络风暴。这种情况下，比较保险的方式是，把接口的各种配置放在服务引用配置文件里。</p>
<p>在进行服务配置升级过程时，要考虑好步骤，在所有服务消费者完成升级之前，服务提供者还不能把服务的详细信息去掉，否则可能会导致没有升级的服务消费者引用异常。</p>
<h2 id="思考题">思考题</h2>
<p>如果你在实际项目中采用过 XML 配置的服务发布和应用方式，是否还遇到过其他问题？你是如何解决的呢？</p>
<p>欢迎你在留言区写下自己的思考，与我一起讨论。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E5%BE%AE%E6%9C%8D%E5%8A%A1/b10ed5e0f291705aa335d48abe58cc5d.png" alt=""></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E5%BE%AE%E6%9C%8D%E5%8A%A1/">从0开始学微服务</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E7%88%B1%E4%B8%8A%E8%B7%91%E6%AD%A5/11_%E9%99%A4%E4%BA%86%E9%A9%AC%E6%8B%89%E6%9D%BE%E8%BF%98%E8%83%BD%E5%8F%82%E5%8A%A0%E5%93%AA%E4%BA%9B%E8%B7%91%E6%AD%A5%E8%B5%9B%E4%BA%8B/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">11_除了马拉松，还能参加哪些跑步赛事？</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%9F%BA%E7%A1%80%E8%AF%BE/11_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0__%E6%AD%A5%E6%AD%A5%E4%B8%BA%E8%90%A5%E6%9C%89%E7%AB%A0%E5%8F%AF%E5%BE%AA%E5%86%B3%E7%AD%96%E6%A0%91/">
            <span class="next-text nav-default">11_机器学习__步步为营，有章可循：决策树</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
