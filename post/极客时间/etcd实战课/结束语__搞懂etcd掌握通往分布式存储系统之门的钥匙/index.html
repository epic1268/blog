<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>结束语__搞懂etcd，掌握通往分布式存储系统之门的钥匙 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是唐聪。
时间过得真快，这就到了我们的定期更新的最后一节课了。从筹备、上线到今天专栏完结，过去了将近 7 个多月的时间。
说句实在话，刚开始筹备专栏的时候，我没想过战线会拉得如此之长。当时就是简单地觉得，我的经验也比较丰富了，输出应该很简单。但是其实做专栏耗费的心力远超我的预期：每一节课的构思写作都会花费我大量的时间，而且写完后还得考虑文章逻辑是否有优化的空间，怎样加配图、加一个什么样的配图可以更加形象，甚至部分文章写完自己不满意我还会重写一遍。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/etcd%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%BB%93%E6%9D%9F%E8%AF%AD__%E6%90%9E%E6%87%82etcd%E6%8E%8C%E6%8F%A1%E9%80%9A%E5%BE%80%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E4%B9%8B%E9%97%A8%E7%9A%84%E9%92%A5%E5%8C%99/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/etcd%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%BB%93%E6%9D%9F%E8%AF%AD__%E6%90%9E%E6%87%82etcd%E6%8E%8C%E6%8F%A1%E9%80%9A%E5%BE%80%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E4%B9%8B%E9%97%A8%E7%9A%84%E9%92%A5%E5%8C%99/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="结束语__搞懂etcd，掌握通往分布式存储系统之门的钥匙">
  <meta property="og:description" content="你好，我是唐聪。
时间过得真快，这就到了我们的定期更新的最后一节课了。从筹备、上线到今天专栏完结，过去了将近 7 个多月的时间。
说句实在话，刚开始筹备专栏的时候，我没想过战线会拉得如此之长。当时就是简单地觉得，我的经验也比较丰富了，输出应该很简单。但是其实做专栏耗费的心力远超我的预期：每一节课的构思写作都会花费我大量的时间，而且写完后还得考虑文章逻辑是否有优化的空间，怎样加配图、加一个什么样的配图可以更加形象，甚至部分文章写完自己不满意我还会重写一遍。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="Etcd实战课">

  <meta itemprop="name" content="结束语__搞懂etcd，掌握通往分布式存储系统之门的钥匙">
  <meta itemprop="description" content="你好，我是唐聪。
时间过得真快，这就到了我们的定期更新的最后一节课了。从筹备、上线到今天专栏完结，过去了将近 7 个多月的时间。
说句实在话，刚开始筹备专栏的时候，我没想过战线会拉得如此之长。当时就是简单地觉得，我的经验也比较丰富了，输出应该很简单。但是其实做专栏耗费的心力远超我的预期：每一节课的构思写作都会花费我大量的时间，而且写完后还得考虑文章逻辑是否有优化的空间，怎样加配图、加一个什么样的配图可以更加形象，甚至部分文章写完自己不满意我还会重写一遍。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="2659">
  <meta itemprop="keywords" content="Etcd实战课">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="结束语__搞懂etcd，掌握通往分布式存储系统之门的钥匙">
  <meta name="twitter:description" content="你好，我是唐聪。
时间过得真快，这就到了我们的定期更新的最后一节课了。从筹备、上线到今天专栏完结，过去了将近 7 个多月的时间。
说句实在话，刚开始筹备专栏的时候，我没想过战线会拉得如此之长。当时就是简单地觉得，我的经验也比较丰富了，输出应该很简单。但是其实做专栏耗费的心力远超我的预期：每一节课的构思写作都会花费我大量的时间，而且写完后还得考虑文章逻辑是否有优化的空间，怎样加配图、加一个什么样的配图可以更加形象，甚至部分文章写完自己不满意我还会重写一遍。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">结束语__搞懂etcd，掌握通往分布式存储系统之门的钥匙</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 2659 字 </span>
          <span class="more-meta"> 预计阅读 6 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是唐聪。</p>
<p>时间过得真快，这就到了我们的定期更新的最后一节课了。从筹备、上线到今天专栏完结，过去了将近 7 个多月的时间。</p>
<p>说句实在话，刚开始筹备专栏的时候，我没想过战线会拉得如此之长。当时就是简单地觉得，我的经验也比较丰富了，输出应该很简单。但是其实做专栏耗费的心力远超我的预期：每一节课的构思写作都会花费我大量的时间，而且写完后还得考虑文章逻辑是否有优化的空间，怎样加配图、加一个什么样的配图可以更加形象，甚至部分文章写完自己不满意我还会重写一遍。</p>
<p>细心的你应该能发现，其实这个专栏每一节课的内容都是比较多的。一开始的筹划是每篇文章 3500 字左右，但最后为了讲清楚、讲明白，每一节课大部分都是到了 6000 字到 7000 字的内容（有的文章字数是破万了）。在此特别感谢我的“好基友”王超凡非常用心地和我一块深度 review 每一篇文章，因为平时工作也很忙，还经常得封闭式开发，所以录音只能放在凌晨。</p>
<p>在这里和你分享一件有意思的小事，专栏上线的前一天凌晨，我们和编辑都激动得睡不着，在群里预览文章，聊上线后会是怎么样的一番景象。我们甚至想，会不会上线后被各位疯狂吐槽，以至于不得不录一个“负荆请罪”视频。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/etcd%E5%AE%9E%E6%88%98%E8%AF%BE/4ffc2df64e060fd0a0125f0840d78220.png" alt=""></p>
<p>现在回想起来，真的是做好了被大家吐槽的准备。但你们给我的是超出预期的热情。不少同学从上线到结束，都在时刻关注、学习每一节课，并留下优质的提问以及鼓励、认可。</p>
<ol>
<li>有的同学是比较资深的 etcd 使用者，会独立分析源码，撰写高质量的技术博客，并给出精彩的回答；</li>
<li>有的同学是刨根问底的 etcd 兴趣用户，会细致思考每一个异常场景，给出精彩的提问；</li>
<li>有的同学刚刚入门 etcd 用户，正因为你们的提问，让我意识到需要在基础篇中多去增加一些特性初体验的案例；</li>
<li>还有的同学着急说面试要用，所以春节期间我们没有筹划春节特别活动，而是正常更新课程正文；</li>
<li>……</li>
</ol>
<p>当然在这过程中，我也收获满满。为了解答你们的疑问，我必须得更加深入地阅读 etcd 源码，也是倒逼着我去进一步成长。</p>
<p>编辑半开玩笑地和我说，我们是以百米冲刺的速度去跑马拉松。这段经历真的很难忘，你们的评论和收藏证明了我们的付出是值得的。</p>
<p>在这最后一节课里，我想最后和你再分享下我个人的 etcd 学习经验，以及这整个专栏设计和写作思路。</p>
<p><strong>如果要用一个核心词来总结这个专栏，那我希望是问题及任务式驱动。</strong></p>
<p>从我的个人经验上来看，我每次进一步学习 etcd 的动力，其实都是源于某个棘手的问题。数据不一致、死锁等一系列棘手问题，它们会倒逼我走出舒适区，实现更进一步成长。</p>
<p>从专栏目录中你也可以看到，每讲都是围绕着一个<strong>问题</strong>深入展开。在具体写作思路上，我会先从整体上给你介绍整体架构、解决方案，让你有个全局的认识。随后围绕每个点，按照由浅入深的思路给你分析各种解决方案。</p>
<p>另外，<strong>任务式驱动</strong>也是激励你不断学习的一个非常好的手段，通过任务实践你可以获得满满的成就感，建立正向反馈。你在学习 etcd 专栏的过程中，可结合自己的实际情况，为自己设立几个进阶任务，下面我给你列举了部分：</p>
<ol>
<li>从 0 到 1 搭建一个 etcd 集群（可以先从单节点再到多节点，并进行节点的增删操作）；</li>
<li>业务应用中使用 etcd 的核心 API；</li>
<li>自己动手实现一个分布式锁的包；</li>
<li>阅读 etcd 的源码，写篇源码分析博客（可从早期的 etcd v2 开始）；</li>
<li>基于 raftexample 实现一个支持多存储引擎的 KV 服务；</li>
<li>基于 Kubernetes 的 Operator 机制，实现一个 etcd operator，创建一个 CRD 资源就可新建一个集群；</li>
<li>……</li>
</ol>
<p>我希望带给你的不仅仅是 etcd 原理与实践案例，更希望你收获的是一系列分布式核心问题解决方案，它们不仅能帮助你搞懂 etcd 背后的设计思想与实现，更像是一把通往分布式存储系统之门的钥匙，让你更轻松地学习、理解其他存储系统。</p>
<p>那你可能会问了，为什么搞懂 etcd 就能更深入理解分布式存储系统呢？</p>
<p>因为 etcd 相比其他分布式系统如 Hbase 等，它足够简洁、轻量级，又涵盖了分布式系统常见的问题和核心概念，如 API、数据模型、共识算法、存储引擎、事务、快照、WAL 等，非常适合新人去学习。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/etcd%E5%AE%9E%E6%88%98%E8%AF%BE/5cd6881306b8cec1ad4bde44f8703036.png" alt=""></p>
<p>上图我为你总结了 etcd 以及其他分布式系统的核心技术点，下面我再和你简要分析一下几个分布式核心问题及解决方案，并以 Redis Cluster 集群模式作为对比案例，希望能够帮助你触类旁通。</p>
<p>首先是服务可用性问题。分布式存储系统的解决方案是共识算法、复制模型。etcd 使用的是 Raft 共识算法，一个写请求至少要一半以上节点确认才能成功，可容忍少数节点故障，具备高可用、强一致的目标。Redis Cluster则使用的是主备异步复制和 Gossip 协议，基于主备异步复制协议，可将数据同步到多个节点，实现高可用。同时，通过 Gossip 协议发现集群中的其他节点、传递集群分片等元数据信息等操作，不依赖于元数据存储组件，实现了去中心化，降低了集群运维的复杂度。</p>
<p>然后是数据如何存取的问题。分布式存储系统的解决方案是存储引擎。除了 etcd 使用的 boltdb，常见的存储引擎还有我们实践篇18中所介绍 bitcask、leveldb、rocksdb（leveldb 优化版）等。不同的分布式存储系统在面对不同业务痛点时（读写频率、是否支持事务等），所选择的解决方案不一样。etcd v2 使用的是内存 tree，etcd v3 则使用的是 boltdb，而 Redis Cluster 则使用的是基于内存实现的各类数据结构。</p>
<p>最后是如何存储大量数据的问题。分布式存储系统的解决方案是一系列的分片算法。etcd 定位是个小型的分布式协调服务、元数据存储服务，因此 etcd v2 和 etcd v3 都不支持分片，每个节点含有全量的 key-value 数据。而 Redis Cluster 定位是个分布式、大容量的分布式缓存解决方案，因此它必须要使用分片机制，将数据打散在各个节点上。目前 Redis Cluster 使用的分片算法是哈希槽，它根据你请求的 key，基于 crc16 哈希算法计算 slot 值，每个 slot 分配给对应的 node 节点处理。</p>
<p>HASH_SLOT = CRC16(key) mod 16384</p>
<p>etcd 作为最热门的云原生存储之一，在腾讯、阿里、Google、AWS、美团、字节跳动、拼多多、Shopee、明源云等公司都有大量的应用，覆盖的业务不仅仅是 Kubernetes 相关的各类容器产品，更有视频、推荐、安全、游戏、存储、集群调度等核心业务。</p>
<p>更快、更稳是 etcd 未来继续追求的方向，etcd 社区将紧密围绕 Kubernetes 社区做一系列的优化工作，提供集群降级、自动将 Non-Voting 的 Learner 节点提升为 Voting Member 等特性，彻底解决饱受开发者诟病的版本管理等问题。</p>
<p>希望这个专栏一方面能帮助你遵循最佳实践，高效解决核心业务中各类痛点问题，另一方面能轻松帮你搞定面试过程中常见 etcd 问题，拿到满意的 offer。</p>
<p>当然，我发现很多同学只是默默地收藏，一直在“潜水”。我希望在这最后一课里，大家一块来“灌灌水”，分享一下你自己的 etcd 学习方法以及你对这门课的感受。我为你准备了一份问卷，希望你花两分钟填一下，说不定你就是我们这门课的“小锦鲤”~</p>
<p>最后，再次感谢，我们留言区和加餐见！</p>
<p><a href="https://jinshuju.net/f/sz6QOc"><img src="./5c899721b3716bd77507556ad49f502a.png.md" alt=""></a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/etcd%E5%AE%9E%E6%88%98%E8%AF%BE/">etcd实战课</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E8%B7%9F%E7%9D%80%E9%AB%98%E6%89%8B%E5%AD%A6%E5%A4%8D%E7%9B%98/%E7%BB%93%E6%9D%9F%E8%AF%AD__%E5%A4%8D%E7%9B%98%E8%A7%81%E5%A4%A9%E5%9C%B0%E8%A7%81%E4%BC%97%E7%94%9F%E8%A7%81%E8%87%AA%E5%B7%B1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">结束语__复盘，见天地见众生见自己</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/%E7%BB%93%E6%9D%9F%E8%AF%AD__%E5%92%8C%E4%BD%A0%E8%81%8A%E8%81%8A%E6%88%91%E7%9A%84%E6%9E%B6%E6%9E%84%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/">
            <span class="next-text nav-default">结束语__和你聊聊我的架构心路历程</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
