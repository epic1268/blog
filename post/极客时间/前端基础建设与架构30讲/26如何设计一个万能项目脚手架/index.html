<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>26如何设计一个“万能”项目脚手架？ - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。
编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%AE%BE%E4%B8%8E%E6%9E%B6%E6%9E%8430%E8%AE%B2/26%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E4%B8%87%E8%83%BD%E9%A1%B9%E7%9B%AE%E8%84%9A%E6%89%8B%E6%9E%B6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%AE%BE%E4%B8%8E%E6%9E%B6%E6%9E%8430%E8%AE%B2/26%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E4%B8%87%E8%83%BD%E9%A1%B9%E7%9B%AE%E8%84%9A%E6%89%8B%E6%9E%B6/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="26如何设计一个“万能”项目脚手架？">
  <meta property="og:description" content="脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。
编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="前端基础建设与架构30讲">

  <meta itemprop="name" content="26如何设计一个“万能”项目脚手架？">
  <meta itemprop="description" content="脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。
编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="4127">
  <meta itemprop="keywords" content="前端基础建设与架构30讲">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="26如何设计一个“万能”项目脚手架？">
  <meta name="twitter:description" content="脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。
编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">26如何设计一个“万能”项目脚手架？</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 4127 字 </span>
          <span class="more-meta"> 预计阅读 9 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。</p>
<p>编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：</p>
<p>Vue/React 框架类脚手架</p>
<p>Webpack 等构建配置类脚手架</p>
<p>混合脚手架，比如大家熟悉的 Vue-cli 或者 create-react-app</p>
<p>这一讲我们就深入这些脚手架的原理进行讲解。</p>
<p>命令行工具原理和实现</p>
<p>现代脚手架离不开命令行工具，命令行工具即 Command-line interfaces（CLIs） ，是编程领域的重要概念，也是我们开发中经常接触到的工具之一。</p>
<p>比如 Webpack、Babel、npm、Yarn 等都是典型的命令行。此外，流畅的命令行能够迅速启动一个脚手架，实现自动化和智能化流程。这一部分，我们就使用 Node.js 来开发一个命令行。</p>
<p>我们先来看几个开发命令行工具的关键依赖。</p>
<p>inquirer
、
enquirer
、
prompts
：可以处理复杂的用户输入，完成命令行输入交互。</p>
<p>chalk
、
kleur
：使终端可以输出彩色信息文案。</p>
<p>ora
：可以让命令行出现好看的 Spinners。</p>
<p>boxen
：可以在命令行中画出 Boxes 区块。</p>
<p>listr
：可以在命令行中画出进度列表。</p>
<p>meow
、
arg
：可以进行基础的命令行参数解析。</p>
<p>commander
、
yargs
：可以进行更加复杂的命令行参数解析。</p>
<p>我们的目标是支持以下面这种启动方式，建立我们的项目，如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm init @lucas/project
</span></span></code></pre></td></tr></table>
</div>
</div><p>npm 6.1 及以上版本，我们都可以使用
npm init
或
yarn create
来启动我们的项目，比如下面两个命令就是等价的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 使用 Node.js
</span></span><span class="line"><span class="cl">npm init @lucas/project
</span></span><span class="line"><span class="cl"># 使用 Yarn
</span></span><span class="line"><span class="cl">yarn create @lucas/project
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动命令行项目</p>
<p>下面开始进入开发，首先我们创建项目：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mkdir create-project &amp;&amp; cd create-project
</span></span><span class="line"><span class="cl">npm init --yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着进入
create-project
文件中，创建
src
目录及
src/cli.js
文件，
cli.js
文件内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">export</span> <span class="n">function</span> <span class="n">cli</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，为了使我们的命令行可以在终端执行，我们新建
bin/
目录，并在其下创建一个
create-project
文件，代码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#!/usr/bin/env node
</span></span><span class="line"><span class="cl">require = require(&#39;esm&#39;)(module /*, options*/);
</span></span><span class="line"><span class="cl">require(&#39;../src/cli&#39;).cli(process.argv);
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码中，我们使用了esm 模块，这样就可以在其他文件中使用
import
关键字，即 ESM 模块规范了。我们在该入口文件中，引入
cli.js
并将命令行参数
process.argv
传给
cli
函数执行。</p>
<p>当然，为了能够正常使用esm 模块，我们需要先安装，执行
npm install esm
。</p>
<p>此时 package.json 内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl"> &#34;name&#34;: &#34;@lucas/create-project&#34;,
</span></span><span class="line"><span class="cl"> &#34;version&#34;: &#34;1.0.0&#34;,
</span></span><span class="line"><span class="cl"> &#34;description&#34;: &#34;A CLI to bootstrap my new projects&#34;,
</span></span><span class="line"><span class="cl"> &#34;main&#34;: &#34;src/index.js&#34;,
</span></span><span class="line"><span class="cl"> &#34;bin&#34;: {
</span></span><span class="line"><span class="cl">   &#34;@lucas/create-project&#34;: &#34;bin/create-project&#34;,
</span></span><span class="line"><span class="cl">   &#34;create-project&#34;: &#34;bin/create-project&#34;
</span></span><span class="line"><span class="cl"> },
</span></span><span class="line"><span class="cl"> &#34;publishConfig&#34;: {
</span></span><span class="line"><span class="cl">   &#34;access&#34;: &#34;public&#34;
</span></span><span class="line"><span class="cl"> },
</span></span><span class="line"><span class="cl"> &#34;scripts&#34;: {
</span></span><span class="line"><span class="cl">   &#34;test&#34;: &#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;
</span></span><span class="line"><span class="cl"> },
</span></span><span class="line"><span class="cl"> &#34;keywords&#34;: [
</span></span><span class="line"><span class="cl">   &#34;cli&#34;,
</span></span><span class="line"><span class="cl">   &#34;create-project&#34;
</span></span><span class="line"><span class="cl"> ],
</span></span><span class="line"><span class="cl"> &#34;author&#34;: &#34;YOUR_AUTHOR&#34;,
</span></span><span class="line"><span class="cl"> &#34;license&#34;: &#34;MIT&#34;,
</span></span><span class="line"><span class="cl"> &#34;dependencies&#34;: {
</span></span><span class="line"><span class="cl">   &#34;esm&#34;: &#34;^3.2.18&#34;
</span></span><span class="line"><span class="cl"> }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里需要注意的是
bin
字段，我们注册了两个可用命令：一个是带有 npm 命名 scope 的，一个是常规的
create-project
命令。</p>
<p>为了调试方便，我们使用
npm link
命令进行调试，在终端中项目目录下执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm link
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述命令可以在全局范围内添加一个软链到当前项目中。我们执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">create-project --yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>就会得到下面这样的输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[ &#39;/usr/local/Cellar/node/11.6.0/bin/node&#39;,
</span></span><span class="line"><span class="cl">  &#39;/Users/dkundel/dev/create-project/bin/create-project&#39;,
</span></span><span class="line"><span class="cl">  &#39;--yes&#39; ]
</span></span></code></pre></td></tr></table>
</div>
</div><p>该输出，就对应了代码中的
process.argv
。</p>
<p>解析处理命令行输入</p>
<p>在解析处理命令行输入之前，我们需要设计命令行支持的几个选项，如下。</p>
<p>[template]
：支持默认的几种模板类型，用户可以通过 select 进行选择。</p>
<p>&ndash;git
：等同于
git init
去创建一个新的 Git 项目。</p>
<p>&ndash;install
：支持自动下载项目依赖。</p>
<p>&ndash;yes
：跳过命令行交互，直接使用默认配置。</p>
<p>我们利用
inquirer
使得命令行支持用户交互，同时使用
arg
来解析命令行参数，安装相关依赖命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm install inquirer arg
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来编写命令行参数解析逻辑，在
cli.js
中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">arg</span> <span class="n">from</span> <span class="s1">&#39;arg&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">解析命令行参数为</span> <span class="n">options</span>
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">rawArgs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">使用</span> <span class="n">arg</span> <span class="err">进行解析</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;--git&#39;</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;--yes&#39;</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;--install&#39;</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;-g&#39;</span><span class="p">:</span> <span class="s1">&#39;--git&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;-y&#39;</span><span class="p">:</span> <span class="s1">&#39;--yes&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;-i&#39;</span><span class="p">:</span> <span class="s1">&#39;--install&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">argv</span><span class="p">:</span> <span class="n">rawArgs</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">skipPrompts</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--yes&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">git</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--git&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">template</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="n">runInstall</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--install&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">function</span> <span class="n">cli</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">获取命令行配置</span>
</span></span><span class="line"><span class="cl"> <span class="n">let</span> <span class="n">options</span> <span class="o">=</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码很好理解，我已经加入了相关注释。接下来，我们实现使用默认配置和交互式配置选择逻辑，如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">arg</span> <span class="n">from</span> <span class="s1">&#39;arg&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">inquirer</span> <span class="n">from</span> <span class="s1">&#39;inquirer&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">rawArgs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">promptForMissingOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">默认使用名为</span> <span class="n">JavaScript</span> <span class="err">的模板</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">defaultTemplate</span> <span class="o">=</span> <span class="s1">&#39;JavaScript&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">使用默认模板则直接返回</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">skipPrompts</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="o">...</span><span class="n">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">template</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">template</span> <span class="o">||</span> <span class="n">defaultTemplate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">};</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">准备交互式问题</span> 
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">questions</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">options</span><span class="o">.</span><span class="n">template</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">questions</span><span class="o">.</span><span class="n">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">     <span class="n">type</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;template&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Please choose which project template to use&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">choices</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;JavaScript&#39;</span><span class="p">,</span> <span class="s1">&#39;TypeScript&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="n">default</span><span class="p">:</span> <span class="n">defaultTemplate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">options</span><span class="o">.</span><span class="n">git</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">questions</span><span class="o">.</span><span class="n">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">     <span class="n">type</span><span class="p">:</span> <span class="s1">&#39;confirm&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;git&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Initialize a git repository?&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">default</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">使用</span> <span class="n">inquirer</span> <span class="err">进行交互式查询，并获取用户答案选项</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">answers</span> <span class="o">=</span> <span class="n">await</span> <span class="n">inquirer</span><span class="o">.</span><span class="n">prompt</span><span class="p">(</span><span class="n">questions</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="n">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">template</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">template</span> <span class="o">||</span> <span class="n">answers</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">git</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">git</span> <span class="o">||</span> <span class="n">answers</span><span class="o">.</span><span class="n">git</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">async</span> <span class="n">function</span> <span class="n">cli</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">let</span> <span class="n">options</span> <span class="o">=</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span> <span class="o">=</span> <span class="n">await</span> <span class="n">promptForMissingOptions</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样一来，我们就可以获取到类似：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{ 
</span></span><span class="line"><span class="cl">	skipPrompts: false,
</span></span><span class="line"><span class="cl">    git: false,
</span></span><span class="line"><span class="cl">    template: &#39;JavaScript&#39;,
</span></span><span class="line"><span class="cl">    runInstall: false 
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>相关的配置了。</p>
<p>下面我们需要完成下载模板到本地的逻辑，我们事先准备好两种名为
typescript
和
javascript
的模板，并将相关的模板存储在项目的根目录中。当然你在实际开发应用中，可以内置更多的模板。</p>
<p>我们使用
ncp
包实现跨平台递归拷贝文件，使用
chalk
做个性化输出。安装相关依赖如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm install ncp chalk
</span></span></code></pre></td></tr></table>
</div>
</div><p>在
src/
目录下，创建新的文件
main.js
，代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">chalk</span> <span class="n">from</span> <span class="s1">&#39;chalk&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">fs</span> <span class="n">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">ncp</span> <span class="n">from</span> <span class="s1">&#39;ncp&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">path</span> <span class="n">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="p">{</span> <span class="n">promisify</span> <span class="p">}</span> <span class="n">from</span> <span class="s1">&#39;util&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">access</span> <span class="o">=</span> <span class="n">promisify</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">access</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">promisify</span><span class="p">(</span><span class="n">ncp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">递归拷贝文件</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">copyTemplateFiles</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">templateDirectory</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">clobber</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">创建项目</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">async</span> <span class="n">function</span> <span class="n">createProject</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="n">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">targetDirectory</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span> <span class="o">||</span> <span class="n">process</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">currentFileUrl</span> <span class="o">=</span> <span class="n">import</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">templateDir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="n">new</span> <span class="n">URL</span><span class="p">(</span><span class="n">currentFileUrl</span><span class="p">)</span><span class="o">.</span><span class="n">pathname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s1">&#39;../../templates&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">options</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span><span class="o">.</span><span class="n">templateDirectory</span> <span class="o">=</span> <span class="n">templateDir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	 <span class="o">//</span> <span class="err">判断模板是否存在</span>
</span></span><span class="line"><span class="cl">   <span class="n">await</span> <span class="n">access</span><span class="p">(</span><span class="n">templateDir</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">R_OK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	 <span class="o">//</span> <span class="err">模板不存在</span> 
</span></span><span class="line"><span class="cl">   <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Invalid template name&#39;</span><span class="p">,</span> <span class="n">chalk</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">   <span class="n">process</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">拷贝模板</span>
</span></span><span class="line"><span class="cl"> <span class="n">await</span> <span class="n">copyTemplateFiles</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Project ready&#39;</span><span class="p">,</span> <span class="n">chalk</span><span class="o">.</span><span class="n">green</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="bp">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码我们通过
import.meta.url
来获取当前模块的 URL 路径，并通过
fs.constants.R_OK
判断对应模板是否存在。此时
cli.js
关键内容为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">arg</span> <span class="n">from</span> <span class="s1">&#39;arg&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">inquirer</span> <span class="n">from</span> <span class="s1">&#39;inquirer&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="p">{</span> <span class="n">createProject</span> <span class="p">}</span> <span class="n">from</span> <span class="s1">&#39;./main&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">rawArgs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">promptForMissingOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">async</span> <span class="n">function</span> <span class="n">cli</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">let</span> <span class="n">options</span> <span class="o">=</span> <span class="n">parseArgumentsIntoOptions</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span> <span class="o">=</span> <span class="n">await</span> <span class="n">promptForMissingOptions</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">await</span> <span class="n">createProject</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，我们需要完成
git
的初始化以及依赖安装工作，这时候需要用到以下内容。</p>
<p>execa
：允许开发中使用类似
git
的外部命令。</p>
<p>pkg-install
：使用
yarn install
或
npm install
安装依赖。</p>
<p>listr
：给出当前进度 progress。</p>
<p>执行安装依赖：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm install execa pkg-install listr
</span></span></code></pre></td></tr></table>
</div>
</div><p>更新
main.js
为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">chalk</span> <span class="n">from</span> <span class="s1">&#39;chalk&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">fs</span> <span class="n">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">ncp</span> <span class="n">from</span> <span class="s1">&#39;ncp&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">path</span> <span class="n">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="p">{</span> <span class="n">promisify</span> <span class="p">}</span> <span class="n">from</span> <span class="s1">&#39;util&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">execa</span> <span class="n">from</span> <span class="s1">&#39;execa&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">Listr</span> <span class="n">from</span> <span class="s1">&#39;listr&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="p">{</span> <span class="n">projectInstall</span> <span class="p">}</span> <span class="n">from</span> <span class="s1">&#39;pkg-install&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">access</span> <span class="o">=</span> <span class="n">promisify</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">access</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">promisify</span><span class="p">(</span><span class="n">ncp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">拷贝模板</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">copyTemplateFiles</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">templateDirectory</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">clobber</span><span class="p">:</span> <span class="bp">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">初始化</span> <span class="n">git</span>
</span></span><span class="line"><span class="cl"><span class="n">async</span> <span class="n">function</span> <span class="n">initGit</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">执行</span> <span class="n">git</span> <span class="n">init</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">await</span> <span class="n">execa</span><span class="p">(</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">],</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">cwd</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">});</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">Promise</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">&#39;Failed to initialize git&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">创建项目</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">async</span> <span class="n">function</span> <span class="n">createProject</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="n">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">targetDirectory</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span> <span class="o">||</span> <span class="n">process</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">templateDir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="n">new</span> <span class="n">URL</span><span class="p">(</span><span class="n">import</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">pathname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s1">&#39;../../templates&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">options</span><span class="o">.</span><span class="n">template</span>
</span></span><span class="line"><span class="cl"> <span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">options</span><span class="o">.</span><span class="n">templateDirectory</span> <span class="o">=</span> <span class="n">templateDir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	 <span class="o">//</span> <span class="err">判断模板是否存在</span>
</span></span><span class="line"><span class="cl">   <span class="n">await</span> <span class="n">access</span><span class="p">(</span><span class="n">templateDir</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">R_OK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Invalid template name&#39;</span><span class="p">,</span> <span class="n">chalk</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">   <span class="n">process</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">声明</span> <span class="n">tasks</span>
</span></span><span class="line"><span class="cl"> <span class="k">const</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Listr</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;Copy project files&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">task</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">copyTemplateFiles</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;Initialize git&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">task</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">initGit</span><span class="p">(</span><span class="n">options</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="n">enabled</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="o">.</span><span class="n">git</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;Install dependencies&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="n">task</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="n">projectInstall</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">         <span class="n">cwd</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">targetDirectory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="p">}),</span>
</span></span><span class="line"><span class="cl">     <span class="n">skip</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="o">!</span><span class="n">options</span><span class="o">.</span><span class="n">runInstall</span>
</span></span><span class="line"><span class="cl">         <span class="err">?</span> <span class="s1">&#39;Pass --install to automatically install dependencies&#39;</span>
</span></span><span class="line"><span class="cl">         <span class="p">:</span> <span class="n">undefined</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">]);</span>
</span></span><span class="line"><span class="cl"> <span class="o">//</span> <span class="err">并行执行</span> <span class="n">tasks</span>
</span></span><span class="line"><span class="cl"> <span class="n">await</span> <span class="n">tasks</span><span class="o">.</span><span class="n">run</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Project ready&#39;</span><span class="p">,</span> <span class="n">chalk</span><span class="o">.</span><span class="n">green</span><span class="o">.</span><span class="n">bold</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="bp">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样一来，我们的命令行就大功告成了。</p>
<p>接下来我们主要谈谈模板维护问题，上述实现中，模板维护在了本地。为了更大范围的合作，模板可以共享到 GitHub 中。我们可以在 package.json 文件中声明 files 字段，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">},
</span></span><span class="line"><span class="cl"> &#34;files&#34;: [
</span></span><span class="line"><span class="cl">   &#34;bin/&#34;,
</span></span><span class="line"><span class="cl">   &#34;src/&#34;,
</span></span><span class="line"><span class="cl">   &#34;templates/&#34;
</span></span><span class="line"><span class="cl"> ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>以此来声明哪些文件可以被
npm publish
出去。</p>
<p>另外一种做法是将模板单独维护到一个 GitHub 仓库当中。在创建一个项目时，我们使用 download-git-repo来下载模板。</p>
<p>从命令行到万能脚手架</p>
<p>前面我们分析了一个命令行的实现和开发原理，这些内容并不复杂。但如何从一个命令行升级到一个万能脚手架呢？我们继续探讨。</p>
<p>使用命令行启动并创建一个基于模板的项目只能说是一个脚手架的雏形。对比大家熟悉的
vue-cli
、
create-react-app
、
@tarojs/cli
、
umi
等，我们还需要从可伸缩性、用户友好性方面考虑：</p>
<p>如何使模板支持版本管理</p>
<p>模板如何进行扩展</p>
<p>如何进行版本检查和更新</p>
<p>如何自定义构建</p>
<p>下面我们分别来讨论。</p>
<p>模板支持版本管理可以使用 npm 维护模板，这样借助 npm 的版本管理，我们可以天然地支持不同版本的模板。当然在脚手架的设计中，要加入对版本的选择和处理。</p>
<p>如前文所说，模板扩展可以借助中心化手段，集成开发者力量，提供模板市场。这里需要注意的是，针对不同模板或功能区块的可插拔性是非常重要的。下面我们会具体展开。</p>
<p>版本检查可以使用 npm view @lucas/create-project version\ 来进行版本检查，并根据环境版本，提示用户更新。</p>
<p>构建是一个老大难问题，不同项目的构建需求是不同的。参照第 23 讲“npm scripts：打造一体化的构建和部署流程”所讲，不同构建脚本可以考虑单独抽象，提供可插拔式封装。比如jslib-base这个库的设计，这也是一个“万能脚手架”。</p>
<p>我们具体来看，使用脚手架初始化一个项目的过程，本质是根据输入信息进行模板填充。比如，如果开发者选择使用 TypeScript 以及英语环境构建项目，并使用 rollup 进行构建。那么核心流程中在初始化 rollup.config.js 文件时，我们读取 rollup.js.tmpl，并将相关信息（比如对 TypeScript 的编译）填写到模板中。</p>
<p>类似的情况还有初始化 .eslintrc.ts.json、package.json、CHANGELOG.en.md、README.en.md，以及 doc.en.md 等。</p>
<p>所有这些文件的生成过程都需要可插拔，更理想的是，这些插件是一个独立的运行时。因此我们可以将每一个脚手架文件（即模板文件）的初始化视作一个独立的应用，由命令行统一指挥调度。</p>
<p>比如 jslib-base 这个库对于 rollup 构建的处理，支持开发者传入 option，由命令行处理函数，结合不同的配置版本进行自定义分配。具体代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">path</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">util</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;@js-lib/util&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">init</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">type</span> <span class="err">为</span> <span class="n">js</span> <span class="err">和</span> <span class="n">ts</span> <span class="err">两种</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">type</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">//</span> <span class="n">module</span> <span class="err">分为：</span><span class="n">umd</span><span class="o">/</span><span class="n">esm</span><span class="o">/</span><span class="n">commonjs</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">module</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">prev</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">prev</span><span class="p">),</span> <span class="p">({}));</span>
</span></span><span class="line"><span class="cl">		<span class="o">//</span> <span class="n">rollup</span> <span class="err">基本配置</span>
</span></span><span class="line"><span class="cl">    <span class="n">util</span><span class="o">.</span><span class="n">copyTmpl</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/$</span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="o">/</span><span class="n">rollup</span><span class="o">.</span><span class="n">js</span><span class="o">.</span><span class="n">tmpl</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;config/rollup.js&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">option</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">//</span> <span class="n">umd</span> <span class="err">模式</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">umd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">util</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/$</span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="o">/</span><span class="n">rollup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">aio</span><span class="o">.</span><span class="n">js</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;config/rollup.config.aio.js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">esm</span> <span class="err">模式</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">esm</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">util</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/$</span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="o">/</span><span class="n">rollup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">esm</span><span class="o">.</span><span class="n">js</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;config/rollup.config.esm.js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">commonjs</span> <span class="err">模式</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">commonjs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">util</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/$</span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="o">/</span><span class="n">rollup</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">js</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;config/rollup.config.js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">util</span><span class="o">.</span><span class="n">mergeTmpl2JSON</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/$</span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">tmpl</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;package.json&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">option</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;js&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">util</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/</span><span class="n">js</span><span class="o">/.</span><span class="n">babelrc</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;.babelrc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;ts&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">util</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="err">`</span><span class="o">./</span><span class="n">template</span><span class="o">/</span><span class="n">ts</span><span class="o">/</span><span class="n">tsconfig</span><span class="o">.</span><span class="n">json</span><span class="err">`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">cmdPath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;tsconfig.json&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">init</span><span class="p">:</span> <span class="n">init</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如上代码，根据用户输入，使用了不同版本的 rollup 构建内容。</p>
<p>相信你了解了这些内容，对于实现一个自己的 create-react-app、vue-cli 会更有心得和启发。</p>
<p>总结</p>
<p>这一讲我们从开发一个命令行入手，分析了实现一个脚手架的方方面面。实现一个企业级脚手架需要不断打磨和优化，不断增强用户体验和可操作性，比如处理边界情况、终端提示等。更重要的是，对构建逻辑的抽象和封装，根据业务需求，不断扩展命令和模板。</p>
<p>本讲内容总结如下：</p>
<p>从 0 到 1 简单，但是从 1 开始出发，就需要开发者不断思考和总结。下一讲我们将开启 Node.js 的学习，来实现一个 SSR 应用。我们会直入正题，不再过多学习 Node.js 的基础内容，也请你提前做好准备。</p>
<p>-&ndash; ### 精选评论 ##### *哲： &gt; 执行 npm link 时出错：npm ERR! path /usr/local/lib/node_modules/create-project/bin/create-projectnpm ERR! errno -2npm ERR! enoent ENOENT: no such file or directory, chmod &lsquo;/usr/local/lib/node_modules/create-project/bin/create-project&rsquo; ######     讲师回复： &gt;     从报错来看，是找不到该路径对应的文件，先确认一下改路径下是否有文件，再看一下是否有创建文件的权限 ##### *斌： &gt; 有 github repo 吗？ ######     编辑回复： &gt;     注意看超链接的地方，相关地址都在哈~</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E5%BB%BA%E8%AE%BE%E4%B8%8E%E6%9E%B6%E6%9E%8430%E8%AE%B2/">前端基础建设与架构30讲</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/26%E7%BB%93%E6%9D%9F%E8%AF%AD-%E7%AE%97%E6%B3%95%E7%9A%84%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">26结束语 算法的精进之路</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/kubernetes%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/26%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6kubernete%E6%90%9E%E5%AE%9A%E7%BD%91%E7%BB%9C%E5%8E%9F%E6%9D%A5%E5%8F%AF%E4%BB%A5%E5%A6%82%E6%AD%A4%E7%AE%80%E5%8D%95/">
            <span class="next-text nav-default">26网络插件：Kubernete搞定网络原来可以如此简单？</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
