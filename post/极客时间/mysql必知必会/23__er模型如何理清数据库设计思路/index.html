<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>23__ER模型：如何理清数据库设计思路？ - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是朱晓峰。
在超市项目的数据库设计阶段，超市经营者交给我们一大堆 Excel 表格。我们需要把这些表格的数据都整理清楚，并且按照一定的规则存储起来，从而进行高效的管理。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/23__er%E6%A8%A1%E5%9E%8B%E5%A6%82%E4%BD%95%E7%90%86%E6%B8%85%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/23__er%E6%A8%A1%E5%9E%8B%E5%A6%82%E4%BD%95%E7%90%86%E6%B8%85%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="23__ER模型：如何理清数据库设计思路？">
  <meta property="og:description" content="你好，我是朱晓峰。
在超市项目的数据库设计阶段，超市经营者交给我们一大堆 Excel 表格。我们需要把这些表格的数据都整理清楚，并且按照一定的规则存储起来，从而进行高效的管理。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="MySQL必知必会">

  <meta itemprop="name" content="23__ER模型：如何理清数据库设计思路？">
  <meta itemprop="description" content="你好，我是朱晓峰。
在超市项目的数据库设计阶段，超市经营者交给我们一大堆 Excel 表格。我们需要把这些表格的数据都整理清楚，并且按照一定的规则存储起来，从而进行高效的管理。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="5708">
  <meta itemprop="keywords" content="MySQL必知必会">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="23__ER模型：如何理清数据库设计思路？">
  <meta name="twitter:description" content="你好，我是朱晓峰。
在超市项目的数据库设计阶段，超市经营者交给我们一大堆 Excel 表格。我们需要把这些表格的数据都整理清楚，并且按照一定的规则存储起来，从而进行高效的管理。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">23__ER模型：如何理清数据库设计思路？</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 5708 字 </span>
          <span class="more-meta"> 预计阅读 12 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#er-模型包括哪些要素">ER 模型包括哪些要素？</a></li>
    <li><a href="#er-模型的细化">ER 模型的细化</a></li>
    <li><a href="#如何把-er-模型图转换成数据表">如何把 ER 模型图转换成数据表？</a>
      <ul>
        <li><a href="#一个实体转换成一个数据表">一个实体转换成一个数据表</a></li>
        <li><a href="#一个多对多的关系转换成一个数据表">一个多对多的关系转换成一个数据表</a></li>
        <li><a href="#通过外键来表达-1-对多的关系">通过外键来表达 1 对多的关系</a></li>
        <li><a href="#把属性转换成表的字段">把属性转换成表的字段</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#思考题">思考题</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是朱晓峰。</p>
<p>在超市项目的数据库设计阶段，超市经营者交给我们一大堆 Excel 表格。我们需要把这些表格的数据都整理清楚，并且按照一定的规则存储起来，从而进行高效的管理。</p>
<p>比如，当时我们有这样一张进货表：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/83586d846281f27f5f05b29c3f7438cb.png" alt=""></p>
<p>为了提高数据存储的效率，我们按照第三范式的原则进行拆分，这样就得到了 4 个表，分别是供货商表、进货单头表、进货单明细表和商品信息表。</p>
<p>供货商表：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/868be485dbb6cae101b1da1c02e3daa6.png" alt=""></p>
<p>进货单头表：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/7355567663df90d87e462130e6cdd1a5.png" alt=""></p>
<p>进货单明细表：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/5e1ca539721377e2734def6ecfb5d8f4.png" alt=""></p>
<p>商品信息表：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/0936151ae64dccd02d5d87c5a3a667c5.png" alt=""></p>
<p>其中，商品信息表、供货商表和进货单头表都满足第三范式的原则，进货单明细表虽然不满足第三范式的原则，但是满足第二范式的要求，而且保留的冗余字段也是基于业务优先的原则保留的。因此，超市经营者给我们提供的进货单表，经过我们的拆解，已经是存取效率最佳的方案了。在进货管理这个局部模块中，是最优的数据库设计方案。</p>
<p>但是，当我们按照这样的方式拆分一连串数据表时，却发现越拆越多，而且支离破碎。事实上，<strong>局部最优的表，不仅有可能存在进一步拆分的情况，还有可能会出现数据缺失</strong>。</p>
<p>毕竟，数据库设计是牵一发而动全身的。那有没有什么办法提前看到数据库的全貌呢？比如需要哪些数据表、数据表中应该有哪些字段，数据表与数据表之间有什么关系、通过什么字段进行连接，等等。这样我们才能进行整体的梳理和设计。</p>
<p>其实，ER 模型就是一个这样的工具。ER 模型也叫作实体关系模型，是用来描述现实生活中客观存在的事物、事物的属性，以及事物之间关系的一种数据模型。<strong>在开发基于数据库的信息系统的设计阶段，通常使用 ER 模型来描述信息需求和信息特性，帮助我们理清业务逻辑，从而设计出优秀的数据库</strong>。</p>
<p>今天，我还是借助实际案例，带你使用 ER 模型分析一下超市的业务流程，具体给你讲一讲怎么通过 ER 模型来理清数据库设计的思路，从而设计出优秀的数据库。</p>
<p>在使用之前，咱们得先知道 ER 模型里都包括啥。</p>
<h1 id="er-模型包括哪些要素">ER 模型包括哪些要素？</h1>
<p><strong>在 ER 模型里面，有三个要素，分别是实体、属性和关系</strong>。</p>
<ol>
<li>实体，可以看做是数据对象，往往对应于现实生活中的真实存在的个体。比如，这个连锁超市就可以看做一个实体。在 ER 模型中，用矩形来表示。实体分为两类，分别是**强实体和弱实体。**强实体是指不依赖于其他实体的实体；弱实体是指对另一个实体有很强的依赖关系的实体。</li>
<li>属性，则是指实体的特性。比如超市的地址、联系电话、员工数等。在 ER 模型中用椭圆形来表示。</li>
<li>关系，则是指实体之间的联系。比如超市把商品卖给顾客，就是一种超市与顾客之间的联系。在 ER 模型中用菱形来表示。</li>
</ol>
<p>需要注意的是，有的时候，实体和属性不容易区分。比如刚刚商品信息表中的商品的单位，到底是实体还是属性呢？如果从进货的角度出发，单位是商品的属性，但是从超市信息系统的整体出发，单位可以看做一个实体。</p>
<p><strong>那么，该如何区分实体和属性呢？</strong></p>
<p>我给你提供一个原则：我们要从系统整体的角度出发去看，<strong>可以独立存在的是实体，不可再分的是属性</strong>。也就是说，属性不需要进一步描述，不能包含其他属性。</p>
<p>在 ER 模型的 3 个要素中，关系又可以分为 3 种类型，分别是 <strong>1 对 1、1 对多和多对多</strong>。</p>
<ol>
<li>1 对 1：指实体之间的关系是一一对应的，比如个人与身份证信息之间的关系就是 1 对 1 的关系。一个人只能有一个身份证信息，一个身份证信息也只属于一个人。</li>
<li>1 对多：指一边的实体通过关系，可以对应多个另外一边的实体。相反，另外一边的实体通过这个关系，则只能对应唯一的一边的实体。比如超市与超市里的收款机之间的从属关系，超市可以拥有多台收款机，但是每一条收款机只能从属于一个超市。</li>
<li>多对多：指关系两边的实体都可以通过关系对应多个对方的实体。比如在进货模块中，供货商与超市之间的关系就是多对多的关系，一个供货商可以给多个超市供货，一个超市也可以从多个供货商那里采购商品。</li>
</ol>
<p>知道了这些要素，我们就可以给超市业务创建 ER 模型了，如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/ed70c811b41604cfc1693272f65ec47d.png" alt=""></p>
<p>我来简单解释一下这个图。</p>
<p>在这个图中，供货商和超市之间的供货关系，两边的数字都不是 1，表示多对多的关系。同样，超市和顾客之间的零售关系，也是多对多的关系。</p>
<p>这个 ER 模型，包括了 3 个实体之间的 2 种关系：</p>
<ol>
<li>超市从供货商那里采购商品；</li>
<li>超市把商品卖给顾客。</li>
</ol>
<p>有了这个 ER 模型，我们就可以从整体上理解超市的业务了。但是，这里没有包含属性，这样就无法体现实体和关系的具体特征。现在，我们需要把属性加上，用椭圆来表示，这样我们得到的 ER 模型就更加完整了。</p>
<h1 id="er-模型的细化">ER 模型的细化</h1>
<p>刚刚的 ER 模型展示了超市业务的框架，但是只包括了供货商、超市和顾客这三个实体，以及它们之间的关系，还不能对应到具体的表，以及表与表之间的关联。</p>
<p>因此，我们需要进一步去设计一下这个 ER 模型的各个局部，也就是细化下超市的具体业务流程，然后把它们综合到一起，形成一个完整的 ER 模型。这样可以帮助我们理清数据库的设计思路。</p>
<p>我们刚才的超市业务模型，包括了两个模块，分别是进货模块和销售模块。下面我们分别对这 2 个模块进行细化。</p>
<p>首先，我们来看一下超市业务中的进货模块的 ER 模型，整理一下其中包含哪些实体、哪些关系和哪些属性。</p>
<p>在我们的进货模块里，有 5 个实体：</p>
<ol>
<li>供货商</li>
<li>商品</li>
<li>门店</li>
<li>仓库</li>
<li>员工</li>
</ol>
<p>其中，供货商、商品和门店是强实体，因为它们不需要依赖其他任何实体。而仓库和员工是弱实体，因为它们虽然都可以独立存在，但是它们都依赖门店这个实体，因此都是弱实体。</p>
<p>接下来，我们再分析一下各个实体都有哪些属性。</p>
<ol>
<li>供货商：名称、地址、电话、联系人。</li>
<li>商品：条码、名称、规格、单位、价格。</li>
<li>门店：编号、地址、电话、联系人。</li>
<li>仓库：编号、名称。</li>
<li>员工：工号、姓名、住址、电话、身份证号、职位。</li>
</ol>
<p>这样细分之后，我们就可以重新设计进货模块了，ER 模型如下：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/e02457e58e287973a9c354e24e6e9ba8.png" alt=""></p>
<p>需要注意的是，这里我是用粗框矩形表示弱实体，用粗框菱形，表示弱实体与它依赖的强实体之间的关系。</p>
<p>第二步，我们再分析一下零售模块。</p>
<p>经过分析，我们发现，在超市的业务流程中，零售业务包括普通零售和会员零售两种模式。普通零售包含的实体，包括门店、商品和收银款台；会员零售包含的实体，包括门店、商品、会员和收银款台。</p>
<p>这样我们就可以提炼出零售业务模块中的实体：</p>
<ol>
<li>商品</li>
<li>门店</li>
<li>会员</li>
<li>收银款台。</li>
</ol>
<p>其中，商品和门店不依赖于任何其他实体，所以是强实体；会员和收银款台都依赖于门店，所以是弱实体。</p>
<p>有了实体之后，我们就可以确定实体的属性了。</p>
<ol>
<li>商品：条码、名称、规格、单位、价格。</li>
<li>会员：卡号、发卡门店、名称、电话、身份证、地址、积分、储值。</li>
<li>门店：编号、地址、电话、联系人。</li>
<li>收银款台：编号、名称。</li>
</ol>
<p>现在，我们就可以重新设计零售模块的 ER 模型了：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/4c2be2fc0954129b79022bdfbdecd053.png" alt=""></p>
<p>现在，我们把这两个图整合到一起，形成一个完整的 ER 模型：</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/3aa06fc203ccbe2c2a399dae6eb923d4.png" alt=""></p>
<h1 id="如何把-er-模型图转换成数据表">如何把 ER 模型图转换成数据表？</h1>
<p>通过绘制 ER 模型，我们已经理清了业务逻辑，现在，我们就要进行非常重要的一步了：<strong>把绘制好的 ER 模型，转换成具体的数据表。</strong></p>
<p><strong>我来介绍下转换的原则</strong>。</p>
<ol>
<li>一个实体通常转换成一个数据表；</li>
<li>一个多对多的关系，通常也转换成一个数据表；</li>
<li>一个 1 对 1，或者 1 对多的关系，往往通过表的外键来表达，而不是设计一个新的数据表；</li>
<li>属性转换成表的字段。</li>
</ol>
<p>好了，下面我就结合前面的表格，给你具体讲解一下怎么运用这些转换的原则，把 ER 模型转换成具体的数据表，从而把抽象出来的数据模型，落实到具体的数据库设计当中。</p>
<h2 id="一个实体转换成一个数据表">一个实体转换成一个数据表</h2>
<p>先来看一下强实体转换成数据表。</p>
<p>供货商实体转换成供货商表（demo.supplier）的代码如下所示：</p>
<p>mysql&gt; CREATE TABLE demo.supplier<br>
-&gt; (<br>
-&gt; &ndash; 我们给它添加一个与业务无关的字段“supplierid”为主键，并且设置自增约束。<br>
-&gt; supplierid INT PRIMARY KEY AUTO_INCREMENT,<br>
-&gt; suppliername TEXT,<br>
-&gt; address TEXT,<br>
-&gt; phone TEXT<br>
-&gt; );<br>
Query OK, 0 rows affected (0.06 sec)</p>
<p>商品实体转换成商品表（demo.goodsmaster）：</p>
<p>mysql&gt; CREATE TABLE demo.goodsmaster<br>
-&gt; (<br>
-&gt; &ndash;我们给商品信息表添加一个与业务无关的字段“itemnumber”为主键，采用手动赋值的方式，原因是可能存在多个门店录入新品，导致冲突的情况<br>
-&gt; itemnumber INT PRIMARY KEY,<br>
-&gt; barcode TEXT,<br>
-&gt; goodsname TEXT,<br>
-&gt; specification TEXT,<br>
-&gt; unit TEXT,<br>
-&gt; salesprice DECIMAL(10,2)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>门店实体转换成门店表（demo.branch）：</p>
<p>mysql&gt; CREATE TABLE demo.branch<br>
-&gt; (<br>
-&gt; &ndash; 增加一个与业务无关的字段为主键，并且设置自增约束<br>
-&gt; branchid INT PRIMARY KEY AUTO_INCREMENT,<br>
-&gt; branchno TEXT,<br>
-&gt; branchname TEXT,<br>
-&gt; address TEXT,<br>
-&gt; phone TEXT,<br>
-&gt; contacter TEXT<br>
-&gt; );<br>
Query OK, 0 rows affected (0.06 sec)</p>
<p>下面我们再把弱实体转换成数据表。</p>
<p>仓库转换成仓库表（demo.stock）：</p>
<p>mysql&gt; CREATE TABLE demo.stock<br>
-&gt; (<br>
-&gt; &ndash;添加与业务无关的自增约束字段为主键<br>
-&gt; stockid INT PRIMARY KEY AUTO_INCREMENT,<br>
-&gt; &ndash; 仓库是弱实体，依赖于强实体门店表，所以要把门店表的主键字段包括进来，作为与门店表关联的外键<br>
-&gt; branchid INT NOT NULL,<br>
-&gt; stockno TEXT NOT NULL,<br>
-&gt; stockname TEXT NOT NULL,<br>
-&gt; &ndash; 设置外键约束，与门店表关联<br>
-&gt; CONSTRAINT fk_stock_branch FOREIGN KEY (branchid) REFERENCES branch (branchid)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>收银款台实体转换成收银款台表（demo.cashier）：</p>
<p>mysql&gt; CREATE TABLE demo.cashier<br>
-&gt; (<br>
-&gt; &ndash; 添加与业务无关的自增字段为主键<br>
-&gt; cashierid INT PRIMARY KEY AUTO_INCREMENT,<br>
-&gt; &ndash; 收银款台是弱实体，依赖于强实体门店表，所以要把门店表的主键字段包括进来，所为与门店表关联的外键<br>
-&gt; branchid INT NOT NULL,<br>
-&gt; cashierno TEXT NOT NULL,<br>
-&gt; cashiername TEXT NOT NULL,<br>
-&gt; &ndash; 设置外键约束，与门店表关联<br>
-&gt; CONSTRAINT fk_cashier_branch FOREIGN KEY (branchid) REFERENCES branch (branchid)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>员工实体转换成员工表（demo.operator）：</p>
<p>mysql&gt; CREATE TABLE demo.operator<br>
-&gt; (<br>
-&gt; &ndash; 添加与业务无关的自增字段为主键<br>
-&gt; operatorid INT PRIMARY KEY AUTO_INCREMENT,<br>
-&gt; &ndash; 员工是弱实体，依赖于强实体门店表，所以要把门店表的主键字段包括进来，所为与门店表关联的外键<br>
-&gt; branchid INT NOT NULL,<br>
-&gt; workno TEXT NOT NULL,<br>
-&gt; operatorname TEXT NOT NULL,<br>
-&gt; phone TEXT,<br>
-&gt; address TEXT,<br>
-&gt; pid TEXT,<br>
-&gt; duty TEXT,<br>
-&gt; &ndash; 设置外键约束，与门店表关联<br>
-&gt; CONSTRAINT fk_operator_branch FOREIGN KEY (branchid) REFERENCES branch (branchid)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.11 sec)</p>
<p>会员实体转换成会员表（demo.membermaster）：</p>
<p>mysql&gt; CREATE TABLE demo.membermaster<br>
-&gt; (<br>
-&gt; &ndash; 添加与业务无关的自增字段为主键<br>
-&gt; memberid INT PRIMARY KEY,<br>
-&gt; &ndash; 会员是弱实体，依赖于强实体门店表，所以要把门店表的主键字段包括进来，所为与门店表关联的外键<br>
-&gt; branchid INT NOT NULL,<br>
-&gt; cardno TEXT NOT NULL,<br>
-&gt; membername TEXT,<br>
-&gt; address TEXT,<br>
-&gt; phone TEXT,<br>
-&gt; pid TEXT,<br>
-&gt; &ndash; 设置默认约束，积分默认为 0<br>
-&gt; memberpoints DECIMAL(10,1) NOT NULL DEFAULT 0,<br>
-&gt; &ndash; 设置默认约束，储值默认为 0<br>
-&gt; memberdeposit DECIMAL(10,2) NOT NULL DEFAULT 0,<br>
-&gt; &ndash; 设置外键约束，与门店表关联<br>
-&gt; CONSTRAINT fk_member_branch FOREIGN KEY (branchid) REFERENCES branch (branchid)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<h2 id="一个多对多的关系转换成一个数据表">一个多对多的关系转换成一个数据表</h2>
<p>这个 ER 模型中的多对多的关系有 2 个，分别是零售和进货。我们分别设计一个独立的表来表示，这种表一般称为中间表。</p>
<p>我们可以设计一个独立的进货单表，来代表进货关系。这个表关联到 4 个实体，分别是供货商、商品、仓库、员工，所以，表中必须要包括这 4 个实体转换成的表的主键。除此之外，我们还要包括进货关系自有的属性：进货时间、供货数量和进货价格。</p>
<p>按照数据表设计的第三范式的要求和业务优先的原则，我们把这个进货单表拆分成 2 个表，分别是进货单头表和进货单明细表：</p>
<p>CREATE TABLE demo.importhead<br>
(<br>
importid INT PRIMARY KEY,   &ndash; 添加与业务无关的字段为主键<br>
listnumber TEXT NOT NULL,<br>
supplierid INT NOT NULL,    &ndash; 供货商表的主键，反映了参与进货关系的供货商信息<br>
stockid INT NOT NULL,       &ndash; 仓库表的主键，反映了参与进货关系的参考信息<br>
operatorid INT NOT NULL,    &ndash; 员工表的主键，反映了参与进货关系的员工信息<br>
recordingdate DATETIME NOT NULL,<br>
totalquantity DECIMAL(10,3) NOT NULL DEFAULT 0,<br>
totalvalue DECIMAL(10,3) NOT NULL DEFAULT 0,<br>
CONSTRAINT fk_importhead_supplier FOREIGN KEY (supplierid) REFERENCES supplier (supplierid),<br>
CONSTRAINT fk_importhead_stock FOREIGN KEY (stockid) REFERENCES stock (stockid),<br>
CONSTRAINT fk_importhead_operator FOREIGN KEY (operatorid) REFERENCES operator (operatorid)<br>
);<br>
CREATE TABLE demo.importdetails<br>
(<br>
importid INT,<br>
itemnumber INT,              &ndash; 商品表的主键，反映了参与进货关系的商品信息<br>
importquantity DECIMAL(10,3) NOT NULL DEFAULT 0,<br>
importprice DECIMAL(10,2) NOT NULL DEFAULT 0,<br>
importvalue DECIMAL(10,2) NOT NULL DEFAULT 0,<br>
PRIMARY KEY (importid,itemnumber),<br>
CONSTRAINT fk_importdetails_goodsmaster FOREIGN KEY (itemnumber) REFERENCES goodsmaster (itemnumber)<br>
);</p>
<p>对于零售关系，我们可以设计一张流水单来表示。</p>
<p>这个表关联 4 个实体，分别是收银款台、商品、会员和员工。所以，表中也必须要包括这 4 个实体转换成的表的主键。除此之外，表中还要包括进货关系自有的属性：交易时间、数量、价格等。</p>
<p>按照数据表设计的第三范式的要求，我们把这个流水单表拆分成 2 个表，分别是流水单头表和流水单明细表：</p>
<p>CREATE TABLE demo.transactionhead<br>
(<br>
transactionid INT PRIMARY KEY,   &ndash; 添加与业务无关的字段为主键<br>
transactionno TEXT NOT NULL,<br>
cashierid INT NOT NULL,          &ndash; 收款机表的主键，反映了参与零售关系的收款机信息<br>
memberid INT,                    &ndash; 会员表的主键，反映了参与零售关系的会员的信息<br>
operatorid INT NOT NULL,         &ndash; 员工表的主键，反映了参与零售关系的员工信息<br>
transdate DATETIME NOT NULL,<br>
CONSTRAINT fk_transactionhead_cashier FOREIGN KEY (cashierid) REFERENCES cashier (cashierid),<br>
CONSTRAINT fk_transactionhead_member FOREIGN KEY (memberid) REFERENCES member (memberid),<br>
CONSTRAINT fk_transactionhead_operator FOREIGN KEY (operatorid) REFERENCES operator (operatorid)<br>
);<br>
CREATE TABLE demo.transactiondetails<br>
(<br>
transactionid INT,<br>
itemnumber INT,                 &ndash; 商品表的主键，反映了参与零售关系的商品信息<br>
quantity DECIMAL(10,3) NOT NULL DEFAULT 0,<br>
price DECIMAL(10,2) NOT NULL DEFAULT 0,<br>
salesvalue DECIMAL(10,2) NOT NULL DEFAULT 0,<br>
PRIMARY KEY (transactionid,itemnumber),<br>
CONSTRAINT fk_transactiondetails_goodsmaster FOREIGN KEY (itemnumber) REFERENCES goodsmaster (itemnumber)<br>
);</p>
<h2 id="通过外键来表达-1-对多的关系">通过外键来表达 1 对多的关系</h2>
<p>在上面的表的设计中，我们已经完成了用外键来表达 1 对多的关系。比如：在流水单头表中，我们分别把 cashierid、memberid 和 operatorid 定义成了外键：</p>
<p>CONSTRAINT fk_transactionhead_cashier FOREIGN KEY (cashierid) REFERENCES cashier (cashierid),<br>
CONSTRAINT fk_transactionhead_member FOREIGN KEY (memberid) REFERENCES member (memberid),<br>
CONSTRAINT fk_transactionhead_operator FOREIGN KEY (operatorid) REFERENCES operator (operatorid)</p>
<p>在流水单明细表中，我们把商品编号定义成了外键：</p>
<p>CONSTRAINT fk_transactiondetails_goodsmaster FOREIGN KEY (itemnumber) REFERENCES goodsmaster (itemnumber)</p>
<h2 id="把属性转换成表的字段">把属性转换成表的字段</h2>
<p>在刚刚的设计中，我们也完成了把属性都转换成了表的字段，比如把商品属性（包括条码、名称、规格、单位、价格）转换成了商品信息表中的字段：</p>
<p>mysql&gt; CREATE TABLE demo.goodsmaster<br>
-&gt; (<br>
-&gt; &ndash;我们给商品信息表添加一个与业务无关的字段“itemnumber”为主键，采用手动赋值的方式，原因是可能存在多个门店录入新品，导致冲突的情况<br>
-&gt; itemnumber INT PRIMARY KEY,<br>
-&gt; barcode TEXT,                &ndash; 条码属性<br>
-&gt; goodsname TEXT,              &ndash; 名称属性<br>
-&gt; specification TEXT,          &ndash; 规格属性<br>
-&gt; unit TEXT,                   &ndash; 单位属性<br>
-&gt; salesprice DECIMAL(10,2)     &ndash; 价格属性<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>这样，我们就完成了 ER 模型到 MySQL 数据表的转换。</p>
<p>到这里，我们通过创建超市项目业务流程的 ER 模型，再把 ER 模型转换成具体的数据表的过程，完成了利用 ER 模型设计超市项目数据库的工作。</p>
<p>其实，任何一个基于数据库的应用项目，都可以通过这种先建立 ER 模型，再转换成数据表的方式，完成数据库的设计工作。ER 模型是一种工具。创建 ER 模型不是目的，目的是把业务逻辑梳理清楚，设计出优秀的数据库。我建议你不是为了建模而建模，要利用创建 ER 模型的过程来整理思路，这样创建 ER 模型才有意义。</p>
<h1 id="总结">总结</h1>
<p>今天，我们学习了通过绘制 ER 模型图理清业务逻辑，以及怎么把 ER 模型转换成 MySQL 数据表，最终完成项目数据库设计。</p>
<p>这节课的知识点比较多，我用一张图来帮你回顾下重点。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/MySQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/966c2a4132b78c2eee95cb714871fb79.png" alt=""></p>
<p>最后，我还想再提醒你一下，ER 模型看起来比较麻烦，但是对我们把控项目整体非常重要。如果你只是开发一个小应用，或许简单设计几个表够用了，一旦要设计有一定规模的应用，在项目的初始阶段，建立完整的 ER 模型就非常关键了。开发应用项目的实质，其实就是建模。胸中有丘壑，才能下笔如有神。道理其实是一样的。</p>
<h1 id="思考题">思考题</h1>
<p>超市经营者每个月都要进行库房盘点，也就是在一个月的最后一天的营业结束之后，所有的员工一起把库房里的货品都数一遍，然后跟电脑上的库存比对，查看库存损耗。</p>
<p>我想请你思考一下，在这个业务模块中，涉及了哪些实体、属性和关系？另外，请你设计一下 ER 模型，通过它来整理一下数据库设计的思路。</p>
<p>欢迎在留言区写下你的思考和答案，我们一起交流讨论。如果你觉得今天的内容对你有所帮助，也欢迎你把它分享给你的朋友或同事，我们下节课见。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">MySQL必知必会</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E4%B8%8E%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90/23__cap%E7%90%86%E8%AE%BA%E8%BF%99%E9%A1%B6%E5%B8%BD%E5%AD%90%E6%88%91%E4%B8%8D%E6%83%B3%E8%A6%81/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">23__CAP理论：这顶帽子我不想要</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/23__future%E5%A6%82%E4%BD%95%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E6%9C%80%E4%BC%98%E7%9A%84%E7%83%A7%E6%B0%B4%E6%B3%A1%E8%8C%B6%E7%A8%8B%E5%BA%8F/">
            <span class="next-text nav-default">23__Future：如何用多线程实现最优的“烧水泡茶”程序？</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
