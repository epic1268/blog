<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>28__手把手带你设计一个完整的连锁超市信息系统数据库（下） - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是朱晓峰。
上节课，我们完成了项目的需求分析和业务流程的梳理，为设计数据库做好了准备工作，接下来我们就可以开始具体的设计了。所以，今天，我就带你来建库建表、创建外键约束、视图、存储过程和触发器，最后制定容灾和备份的策略，从而完成一个完整的连锁超市项目数据库的设计，帮助你提高设计高效可靠的数据库的能力。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/28__%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E8%BF%9E%E9%94%81%E8%B6%85%E5%B8%82%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/28__%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E8%BF%9E%E9%94%81%E8%B6%85%E5%B8%82%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="28__手把手带你设计一个完整的连锁超市信息系统数据库（下）">
  <meta property="og:description" content="你好，我是朱晓峰。
上节课，我们完成了项目的需求分析和业务流程的梳理，为设计数据库做好了准备工作，接下来我们就可以开始具体的设计了。所以，今天，我就带你来建库建表、创建外键约束、视图、存储过程和触发器，最后制定容灾和备份的策略，从而完成一个完整的连锁超市项目数据库的设计，帮助你提高设计高效可靠的数据库的能力。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="MySQL必知必会">

  <meta itemprop="name" content="28__手把手带你设计一个完整的连锁超市信息系统数据库（下）">
  <meta itemprop="description" content="你好，我是朱晓峰。
上节课，我们完成了项目的需求分析和业务流程的梳理，为设计数据库做好了准备工作，接下来我们就可以开始具体的设计了。所以，今天，我就带你来建库建表、创建外键约束、视图、存储过程和触发器，最后制定容灾和备份的策略，从而完成一个完整的连锁超市项目数据库的设计，帮助你提高设计高效可靠的数据库的能力。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="6942">
  <meta itemprop="keywords" content="MySQL必知必会">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="28__手把手带你设计一个完整的连锁超市信息系统数据库（下）">
  <meta name="twitter:description" content="你好，我是朱晓峰。
上节课，我们完成了项目的需求分析和业务流程的梳理，为设计数据库做好了准备工作，接下来我们就可以开始具体的设计了。所以，今天，我就带你来建库建表、创建外键约束、视图、存储过程和触发器，最后制定容灾和备份的策略，从而完成一个完整的连锁超市项目数据库的设计，帮助你提高设计高效可靠的数据库的能力。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">28__手把手带你设计一个完整的连锁超市信息系统数据库（下）</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 6942 字 </span>
          <span class="more-meta"> 预计阅读 14 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#如何创建数据库和数据表">如何创建数据库和数据表？</a>
          <ul>
            <li><a href="#如何创建索引">如何创建索引？</a></li>
            <li><a href="#如何创建视图">如何创建视图？</a></li>
            <li><a href="#如何创建存储过程">如何创建存储过程？</a></li>
            <li><a href="#如何创建触发器">如何创建触发器？</a></li>
          </ul>
        </li>
        <li><a href="#如何制定容灾和备份策略">如何制定容灾和备份策略？</a>
          <ul>
            <li><a href="#如何搭建主从服务器">如何搭建主从服务器？</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#-group-replication-related-">***** Group Replication Related *****</a></li>
    <li><a href="#specifies-the-base-name-to-use-for-binary-log-files-with-binary-logging">Specifies the base name to use for binary log files. With binary logging</a></li>
    <li><a href="#enabled-the-server-logs-all-statements-that-change-data-to-the-binary">enabled, the server logs all statements that change data to the binary</a></li>
    <li><a href="#log-which-is-used-for-backup-and-replication">log, which is used for backup and replication.</a></li>
    <li><a href="#-group-replication-related--1">***** Group Replication Related *****</a></li>
    <li><a href="#specifies-the-server-id-for-servers-that-are-used-in-a-replication-topology">Specifies the server ID. For servers that are used in a replication topology,</a></li>
    <li><a href="#you-must-specify-a-unique-server-id-for-each-replication-server-in-the">you must specify a unique server ID for each replication server, in the</a></li>
    <li><a href="#range-from-1-to-232--1-uniquemeans-that-each-id-must-be-different">range from 1 to 2^32 − 1. “Unique”means that each ID must be different</a></li>
    <li><a href="#from-every-other-id-in-use-by-any-other-source-or-replica">from every other ID in use by any other source or replica.</a></li>
    <li><a href="#-group-replication-related--2">***** Group Replication Related *****</a></li>
    <li><a href="#specifies-the-base-name-to-use-for-binary-log-files-with-binary-logging-1">Specifies the base name to use for binary log files. With binary logging</a></li>
    <li><a href="#enabled-the-server-logs-all-statements-that-change-data-to-the-binary-1">enabled, the server logs all statements that change data to the binary</a></li>
    <li><a href="#log-which-is-used-for-backup-and-replication-1">log, which is used for backup and replication.</a></li>
    <li><a href="#-group-replication-related--3">***** Group Replication Related *****</a></li>
    <li><a href="#specifies-the-server-id-for-servers-that-are-used-in-a-replication-topology-1">Specifies the server ID. For servers that are used in a replication topology,</a></li>
    <li><a href="#you-must-specify-a-unique-server-id-for-each-replication-server-in-the-1">you must specify a unique server ID for each replication server, in the</a></li>
    <li><a href="#range-from-1-to-232--1-uniquemeans-that-each-id-must-be-different-1">range from 1 to 2^32 − 1. “Unique”means that each ID must be different</a></li>
    <li><a href="#from-every-other-id-in-use-by-any-other-source-or-replica-1">from every other ID in use by any other source or replica.</a>
      <ul>
        <li>
          <ul>
            <li><a href="#如何制定数据备份策略">如何制定数据备份策略？</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
        <li><a href="#思考题">思考题</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是朱晓峰。</p>
<p>上节课，我们完成了项目的需求分析和业务流程的梳理，为设计数据库做好了准备工作，接下来我们就可以开始具体的设计了。所以，今天，我就带你来建库建表、创建外键约束、视图、存储过程和触发器，最后制定容灾和备份的策略，从而完成一个完整的连锁超市项目数据库的设计，帮助你提高设计高效可靠的数据库的能力。</p>
<p>首先，我们一起来创建数据库和数据表。</p>
<h2 id="如何创建数据库和数据表">如何创建数据库和数据表？</h2>
<p>经过上节课的分库分表操作，我们把数据库按照业务模块，拆分成了多个数据库。其中，盘点模块中的数据表分别被拆分到了营运数据库（operation）和库存数据库（inventory）中。</p>
<p>下面我们就按照上节课的分库策略，分别创建营运数据库和库存数据库：</p>
<p>mysql&gt; CREATE DATABASE operation;<br>
Query OK, 1 row affected (0.03 sec)</p>
<p>mysql&gt; CREATE DATABASE inventory;<br>
Query OK, 1 row affected (0.02 sec)</p>
<p>接下来，我们来分别创建下这两个数据库中的表。</p>
<p>商户表、门店表、员工表、商品常用信息表和商品不常用信息表从属于营运数据库，我们先把这 5 个表创建出来。</p>
<p>商户表（operation.enterprice）：</p>
<p>mysql&gt; CREATE TABLE operation.enterprice<br>
-&gt; (<br>
-&gt; groupnumber SMALLINT PRIMARY KEY,  &ndash; 组号<br>
-&gt; groupname VARCHAR(100) NOT NULL,   &ndash; 名称<br>
-&gt; address TEXT NOT NULL,             &ndash; 地址<br>
-&gt; phone VARCHAR(20) NOT NULL,        &ndash; 电话<br>
-&gt; contactor VARCHAR(50) NOT NULL     &ndash; 联系人<br>
-&gt; );<br>
Query OK, 0 rows affected (0.05 sec)</p>
<p>门店表（operation.branch）：</p>
<p>mysql&gt; CREATE TABLE operation.branch<br>
-&gt; (<br>
-&gt; branchid SMALLINT PRIMARY KEY,        &ndash; 门店编号<br>
-&gt; groupnumber SMALLINT NOT NULL,        &ndash; 组号<br>
-&gt; branchname VARCHAR(100) NOT NULL,     &ndash; 门店名称<br>
-&gt; address TEXT NOT NULL,                &ndash; 地址<br>
-&gt; phone VARCHAR(20) NOT NULL,           &ndash; 电话<br>
-&gt; branchtype VARCHAR(20) NOT NULL,      &ndash; 门店类别<br>
-&gt; CONSTRAINT fk_branch_enterprice FOREIGN KEY (groupnumber) REFERENCES operation.enterprice(groupnumber)  &ndash; 外键约束，组号是外键<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>员工表（operation.employee）：</p>
<p>mysql&gt; CREATE TABLE operation.employee<br>
-&gt; (<br>
-&gt; employeeid SMALLINT PRIMARY KEY,     &ndash; 员工编号<br>
-&gt; groupnumber SMALLINT NOT NULL,       &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,          &ndash; 门店编号<br>
-&gt; workno VARCHAR(20) NOT NULL,         &ndash; 工号<br>
-&gt; employeename VARCHAR(100) NOT NULL,  &ndash; 员工名称<br>
-&gt; pid VARCHAR(20) NOT NULL,            &ndash; 身份证<br>
-&gt; address VARCHAR(100) NOT NULL,       &ndash; 地址<br>
-&gt; phone VARCHAR(20) NOT NULL,          &ndash; 电话<br>
-&gt; employeeduty VARCHAR(20) NOT NULL,   &ndash; 职责<br>
-&gt; CONSTRAINT fk_employee_branch FOREIGN KEY (branchid) REFERENCES operation.branch(branchid)<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>商品常用信息表（operation.goods_o）：</p>
<p>mysql&gt; CREATE TABLE operation.goods_o<br>
-&gt; (<br>
-&gt; itemnumber MEDIUMINT PRIMARY KEY,   &ndash; 商品编号<br>
-&gt; groupnumber SMALLINT NOT NULL,      &ndash; 组号<br>
-&gt; barcode VARCHAR(50) NOT NULL,       &ndash; 条码<br>
-&gt; goodsname TEXT NOT NULL,            &ndash; 名称<br>
-&gt; salesprice DECIMAL(10,2) NOT NULL,  &ndash; 售价<br>
-&gt; PRIMARY KEY (groupnumber,itemnumber)&ndash; 主键<br>
-&gt; );<br>
Query OK, 0 rows affected (0.06 sec)</p>
<p>商品不常用信息表（operation.goods_f）：</p>
<p>mysql&gt; CREATE TABLE operation.goods_f<br>
-&gt; (<br>
-&gt; itemnumber MEDIUMINT PRIMARY KEY,       &ndash; 商品编号<br>
-&gt; groupnumber SMALLINT NOT NULL,          &ndash; 组号<br>
-&gt; specification TEXT NOT NULL,            &ndash; 规格<br>
-&gt; unit VARCHAR(20) NOT NULL,              &ndash; 单位<br>
-&gt; PRIMARY KEY (groupnumber,itemnumber)    &ndash; 主键<br>
-&gt; );<br>
Query OK, 0 rows affected (0.06 sec)</p>
<p>好了，现在我们来创建库存数据库中的表。仓库表、库存表、盘点单头表、盘点单明细表、盘点单头历史表和盘点单明细历史表，从属于库存数据库。</p>
<p>仓库表（inventory.stockmaster）：</p>
<p>mysql&gt; CREATE TABLE inventory.stockmaster<br>
-&gt; (<br>
-&gt; stockid SMALLINT PRIMARY KEY,     &ndash; 仓库编号<br>
-&gt; groupnumber SMALLINT NOT NULL,    &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,       &ndash; 门店编号<br>
-&gt; stockname VARCHAR(100) NOT NULL,  &ndash; 仓库名称<br>
-&gt; stockkind VARCHAR(20) NOT NULL,   &ndash; 仓库种类<br>
-&gt; CONSTRAINT fk_stock_branch FOREIGN KEY (branchid) REFERENCES operation.branch(branchid)           &ndash; 外键约束，门店编号是外键<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>库存表（inventory.inventory）：</p>
<p>mysql&gt; CREATE TABLE inventory.inventory<br>
-&gt; (<br>
-&gt; id INT PRIMARY KEY AUTO_INCREMENT,       &ndash; 库存编号<br>
-&gt; groupnumber SMALLINT NOT NULL,           &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,              &ndash; 门店编号<br>
-&gt; stockid SMALLINT NOT NULL,               &ndash; 仓库编号<br>
-&gt; itemnumber MEDIUMINT NOT NULL,           &ndash; 商品编号<br>
-&gt; itemquantity DECIMAL(10,3) NOT NULL      &ndash; 商品数量<br>
-&gt; );<br>
Query OK, 0 rows affected (0.06 sec)</p>
<p>盘点单头表（inventory.invcounthead）：</p>
<p>mysql&gt; CREATE TABLE inventory.invcounthead<br>
-&gt; (<br>
-&gt; listnumber INT PRIMARY KEY,              &ndash; 单号<br>
-&gt; groupnumber SMALLINT NOT NULL,           &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,              &ndash; 门店编号<br>
-&gt; stockid SMALLINT NOT NULL,               &ndash; 仓库编号<br>
-&gt; recorder SMALLINT NOT NULL,              &ndash; 录入人编号<br>
-&gt; recordingdate DATETIME NOT NULL          &ndash; 录入时间<br>
-&gt; );<br>
Query OK, 0 rows affected (0.07 sec)</p>
<p>盘点单明细表（inventorry.invcountdetails）：</p>
<p>mysql&gt; CREATE TABLE inventory.invcountdetails<br>
-&gt; (<br>
-&gt; id INT PRIMARY KEY AUTO_INCREMENT,   &ndash; 明细编号<br>
-&gt; listnumber INT NOT NULL,             &ndash; 单号<br>
-&gt; groupnumber SMALLINT NOT NULL,       &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,          &ndash; 门店编号<br>
-&gt; stockid SMALLINT NOT NULL,           &ndash; 仓库编号<br>
-&gt; itemnumber MEDIUMINT NOT NULL,       &ndash; 商品编号<br>
-&gt; accquant DECIMAL(10,3) NOT NULL,     &ndash; 结存数量<br>
-&gt; invquant DECIMAL(10,3) NOT NULL,     &ndash; 盘存数量<br>
-&gt; plquant DECIMAL(10,3) NOT NULL       &ndash; 盈亏数量<br>
-&gt; );</p>
<p>Query OK, 0 rows affected (0.07 sec)</p>
<p>盘点单头历史表（inventory.invcountheadhist）：</p>
<p>mysql&gt; CREATE TABLE inventory.invcountheadhist<br>
-&gt; (<br>
-&gt; listnumber INT PRIMARY KEY,       &ndash; 单号<br>
-&gt; groupnumber SMALLINT NOT NULL,    &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,       &ndash; 门店编号<br>
-&gt; stockid SMALLINT NOT NULL,        &ndash; 仓库编号<br>
-&gt; recorder SMALLINT NOT NULL,       &ndash; 录入人编号<br>
-&gt; recordingdate DATETIME NOT NULL,  &ndash; 录入时间<br>
-&gt; confirmer SMALLINT NOT NULL,      &ndash; 验收人编号<br>
-&gt; confirmationdate DATETIME NOT NULL &ndash; 验收时间<br>
-&gt; );<br>
Query OK, 0 rows affected (0.10 sec)</p>
<p>盘点单明细历史表（inventorry.invcountdetailshist）：</p>
<p>mysql&gt; CREATE TABLE inventory.invcountdetailshist<br>
-&gt; (<br>
-&gt; id INT PRIMARY KEY AUTO_INCREMENT,   &ndash; 明细编号<br>
-&gt; listnumber INT NOT NULL,             &ndash; 单号<br>
-&gt; groupnumber SMALLINT NOT NULL,       &ndash; 组号<br>
-&gt; branchid SMALLINT NOT NULL,          &ndash; 门店编号<br>
-&gt; stockid SMALLINT NOT NULL,           &ndash; 仓库编号<br>
-&gt; itemnumber MEDIUMINT NOT NULL,       &ndash; 商品编号<br>
-&gt; accquant DECIMAL(10,3) NOT NULL,     &ndash; 结存数量<br>
-&gt; invquant DECIMAL(10,3) NOT NULL,     &ndash; 盘存数量<br>
-&gt; plquant DECIMAL(10,3) NOT NULL       &ndash; 盈亏数量<br>
-&gt; );<br>
Query OK, 0 rows affected (1.62 sec)</p>
<p>至此，我们完成了创建数据库和数据表的工作。为了提高查询的速度，我们还要为数据表创建索引。下面我们就来实际操作一下。</p>
<h3 id="如何创建索引">如何创建索引？</h3>
<p>索引对提升数据查询的效率作用最大，没有之一。我们创建索引的策略是：</p>
<ol>
<li>所有的数据表都必须创建索引；</li>
<li>只要是有可能成为查询筛选条件的字段，都必须创建索引。</li>
</ol>
<p>这样做的原因是，当数据量特别大的时候，如果没有索引，一旦出现大并发，没有索引的表很可能会成为访问的瓶颈。而且这个问题十分隐蔽，不容易察觉，系统也不会报错，但是却会消耗大量的 CPU 资源，导致系统事实上的崩溃。</p>
<p>在之前的操作中，我们一共创建了 11 个数据表，下面我们就来一一为这些表创建索引。</p>
<p>商户表中的组号字段，常被用于筛选条件。我们用商户表的组号字段为商户表创建索引，代码如下所示：</p>
<p>mysql&gt; CREATE INDEX index_enterprice_groupname ON operation.enterprice (groupname);<br>
Query OK, 0 rows affected (0.06 sec)<br>
Records: 0 Duplicates: 0 Warnings: 0</p>
<p>门店表的组号字段也常被用作筛选条件，所以，我们用组号字段为门店表创建索引，代码如下所示：</p>
<p>mysql&gt; CREATE INDEX index_branch_groupnumber ON operation.branch (groupnumber);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>除了组号字段，门店名称字段也常用在查询的筛选条件中，下面我们就用门店名称字段为门店表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_branch_branchname ON operation.branch (branchname);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>门店类别字段也是用作筛选条件的字段之一，我们可以用门店类别字段为门店表创建索引，如下所示：</p>
<p>mysql&gt; CREATE INDEX index_branch_branchtype ON operation.branch (branchtype);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>在员工表中，组号、门店编号、身份证号、电话和职责字段常被用作查询的筛选条件，下面我们就分别用这几个字段为员工表创建索引。</p>
<p>第一步，用组号字段为员工表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_employee_groupnumer ON operation.employee (groupnumber);<br>
Query OK, 0 rows affected (0.06 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>第二步，用门店编号字段为员工表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_employee_branchid ON operation.employee (branchid);<br>
Query OK, 0 rows affected (0.07 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>第三步，用身份证字段为员工表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_employee_pid ON operation.employee (pid);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>第四步，用电话字段为员工表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_employee_phone ON operation.employee (phone);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>最后，我们用职责字段为员工表创建索引：</p>
<p>mysql&gt; CREATE INDEX index_employee_duty ON operation.employee (employeeduty);<br>
Query OK, 0 rows affected (0.09 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>对于商品常用信息表（operation.goods_o），我们发现，组号和售价字段常被用在查询筛选条件语句中，所以，我们分别用这两个字段为商品常用信息表创建索引。</p>
<p>首先，用组号字段为商品常用信息表创建索引，如下所示：</p>
<p>mysql&gt; CREATE INDEX index_goodso_groupnumber ON operation.goods_o (groupnumber);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后，用价格字段为商品常用信息表创建索引，如下所示：</p>
<p>mysql&gt; CREATE INDEX index_goodso_salesprice ON operation.goods_o (salesprice);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>对于商品不常用信息表，只有组号字段经常用在查询的筛选条件中，所以，我们只需要用组号字段为商品不常用信息表创建索引。代码如下：</p>
<p>mysql&gt; CREATE INDEX index_goodsf_groupnumber ON operation.goods_f (groupnumber);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>到这里，我们就完成了为营运数据库中的表创建索引的工作，下面我们来为库存数据库中的表创建索引。</p>
<p>首先是仓库表。这个表中经常被用做筛选条件的字段，是组号和门店编号字段。</p>
<p>我们先用组号字段为仓库表创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_stock_groupnumber ON inventory.stockmaster (groupnumber);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后我们用门店编号字段为仓库表创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_stock_branchid ON inventory.stockmaster (branchid);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>接下来，我们为库存表创建索引。库存表中常用于筛选的字段有组号、门店编号和商品编号字段。</p>
<p>我们先用组号字段来创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_inventory_groupnumber ON inventory.inventory (groupnumber);<br>
Query OK, 0 rows affected (0.11 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后，我们用门店编号字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_inventory_branchid ON inventory.inventory (branchid);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>最后用商品编号字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_inventory_itemnumber ON inventory.inventory (itemnumber);<br>
Query OK, 0 rows affected (0.07 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>盘点单头表也需要创建索引，常用的筛选字段是门店编号。那么，我们就用门店编号为盘点单头表创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcounthead_branchid ON inventory.invcounthead (branchid);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>盘点单头明细表中常用于筛选的字段有门店编号和商品编号，我们分别用这 2 个字段创建索引。</p>
<p>首先是用门店编号字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcountdetails_branchid ON inventory.invcountdetails (branchid);<br>
Query OK, 0 rows affected (0.08 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后是用商品编号字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcountdetails_itemnumber ON inventory.invcountdetails (itemnumber);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>盘点单头历史表数据量比较大，主要用于查询，常用的筛选字段有门店编号和验收时间。我们先用门店编号字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcounthaedhist_branchid ON inventory.invcountheadhist (branchid);<br>
Query OK, 0 rows affected (0.06 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后用验收时间字段创建索引，代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcounthaedhist_confirmationdate ON inventory.invcountheadhist (confirmationdate);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>盘点单明细历史表是整个盘点模块中数据量最大的表，主要用于查询，索引对提升查询效率来说非常重要。要是忘了创建索引，很可能成为整个系统的瓶颈。</p>
<p>这个表中用作筛选条件的字段主要有门店编号和商品编号，我们分别用它们创建索引。首先是门店编号字段，创建索引的代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcountdetailshist_branchid ON inventory.invcountdetailshist (branchid);<br>
Query OK, 0 rows affected (0.05 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>然后是商品编号字段，创建索引的代码如下：</p>
<p>mysql&gt; CREATE INDEX index_invcountdetailshist_itemnumber ON inventory.invcountdetailshist (itemnumber);<br>
Query OK, 0 rows affected (0.04 sec)<br>
Records: 0  Duplicates: 0  Warnings: 0</p>
<p>到这里，索引就全部创建完成了。</p>
<p>由于我们把盘点单拆分成了单头和明细两个表，在应用中，经常要用到单头和明细的全部信息，所以，为了使代码更加简洁，查询更加方便，我们要为这两个表创建视图。</p>
<h3 id="如何创建视图">如何创建视图？</h3>
<p>首先，我们为盘点单创建视图，代码如下：</p>
<p>mysql&gt; CREATE VIEW view_invcount<br>
-&gt; AS<br>
-&gt; SELECT a.*,b.itemnumber,b.accquant,b.invquant,b.plquant<br>
-&gt; FROM inventory.invcounthead AS a<br>
-&gt; JOIN<br>
-&gt; inventory.invcountdetails AS b<br>
-&gt; ON (a.listnumber=b.listnumber);<br>
Query OK, 0 rows affected (0.04 sec)</p>
<p>然后，我们为盘点单历史表创建视图，代码如下：</p>
<p>mysql&gt; CREATE VIEW view_invcounthist<br>
-&gt; AS<br>
-&gt; SELECT a.*,b.itemnumber,b.accquant,b.invquant,b.plquant<br>
-&gt; FROM inventory.invcountheadhist AS a<br>
-&gt; JOIN inventory.invcountdetailshist AS b<br>
-&gt; ON (a.listnumber=b.listnumber);<br>
Query OK, 0 rows affected (0.02 sec)</p>
<h3 id="如何创建存储过程">如何创建存储过程？</h3>
<p>在整个盘点模块中，有一个核心的计算模块，就是盘点单验收模块。这个计算模块，每次盘点结束都会被调用。为了提升执行效率，让代码更加模块化，使代码的可读性更好，我们可以把盘点表验收这个模块的数据处理逻辑，用存储过程的方式保存在服务器上，以方便应用程序进行调用。</p>
<p>下面我具体介绍存储过程的入口参数和数据处理逻辑。</p>
<p>存储过程的入口参数是单号和验收人的员工编号。存储过程的数据处理逻辑是：先用盈亏数量调整库存，计算方式是新库存 = 老库存 + 盈亏数量；然后把盘点单数据移到盘点单历史中去。</p>
<ol>
<li>把盘点单明细表中的数据插入到盘点单明细历史表中；</li>
<li>把盘点单头表中的数据，插入到盘点单头历史表中；</li>
<li>删除盘点单明细表中的数据；</li>
<li>删除盘点单头表中的数据。</li>
</ol>
<p>按照这个参数定义和计算逻辑，我们就可以用下面的代码来创建存储过程了：</p>
<p>CREATE DEFINER=<code>root</code>@<code>localhost</code> PROCEDURE <code>invcountconfirm</code>(mylistnumber INT,myconfirmer SMALLINT)<br>
BEGIN<br>
DECLARE done INT DEFAULT FALSE;<br>
DECLARE mybranchid INT;<br>
DECLARE myitemnumber INT;<br>
DECLARE myplquant DECIMAL(10,3);<br>
DECLARE cursor_invcount CURSOR FOR<br>
SELECT branchid,itemnumber,plquant<br>
FROM inventory.invcountdetails<br>
WHERE listnumber = mylistnumber;<br>
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;<br>
DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK;</p>
<p>START TRANSACTION;        <br>
OPEN cursor_invcount; &ndash; 打开游标<br>
FETCH cursor_invcount INTO mybranchid,myitemnumber,myplquant; &ndash; 读入第一条记录<br>
REPEAT<br>
UPDATE inventory.inventory<br>
SET itemquantity = itemquantity + myplquant    &ndash; 更新库存<br>
WHERE itemnumber = myitemnumber<br>
AND branchid = mybranchid;<br>
FETCH cursor_invcount INTO mybranchid,myitemnumber,myplquant; &ndash; 读入下一条记录<br>
UNTIL done END REPEAT;</p>
<p>CLOSE cursor_invcount;</p>
<p>INSERT INTO inventory.invcountdetailshist<br>
(listnumber,groupnumber,branchid,stockid,itemnumber,accquant,invquant,plquant)<br>
SELECT listnumber,groupnumber,branchid,stockid,itemnumber,accquant,invquant,plquant<br>
FROM inventory.invcountdetails<br>
WHERE listnumber=mylistnumber;  &ndash; 把这一单的盘点单明细插入历史表</p>
<p>INSERT INTO inventory.invcountheadhist <br>
(listnumber,groupnumber,branchid,stockid,recorder,recordingdate,confirmer,confirmationdate)<br>
SELECT listnumber,groupnumber,branchid,stockid,recorder,recordingdate,myconfirmer,now()<br>
FROM inventory.invcounthead<br>
WHERE listnumber=mylistnumber;  &ndash; 把这一单的盘点单头插入历史<br>
DELETE FROM inventory.invcountdetails WHERE listnumber = mylistnumber; &ndash; 删除这一单的盘点单明细表数据<br>
DELETE FROM inventory.invcounthead WHERE listnumber = mylistnumber; &ndash; 删除这一单的盘点单头表数据<br>
COMMIT;<br>
END</p>
<p>具体的操作我都标注在代码里面了，你可以看一下。</p>
<h3 id="如何创建触发器">如何创建触发器？</h3>
<p>创建完了存储过程，我们已经完成了一大半，但是别急，还有一步工作没有做，就是创建触发器。</p>
<p>由于我们根据分库分表的策略，把商品信息表拆分成了商品常用信息表和商品不常用信息表，这样就很容易产生数据不一致的情况。为了确保商品常用信息表和商品不常用信息表中的数据保持一致，我们可以创建触发器，保证这 2 个表中删除其中一个表的一条记录的操作，自动触发删除另外一个表中对应的记录的操作。这样一来，就防止了一个表中的记录在另外一个表中不存在的情况，也就确保了数据的一致性。</p>
<p>创建触发器的代码如下所示：</p>
<p>DELIMITER //<br>
CREATE TRIGGER operation.del_goodso BEFORE DELETE  &ndash; 在删除前触发<br>
ON operation.goods_o<br>
FOR EACH ROW                              &ndash; 表示每删除一条记录，触发一次<br>
BEGIN                                     &ndash; 开始程序体<br>
DELETE FROM operation.goods_f<br>
WHERE groupnumber=OLD.groupnumber<br>
AND itemnumber=OLD.itemnumber;<br>
END<br>
//<br>
DELIMITER ;</p>
<p>DELIMITER //<br>
CREATE TRIGGER operation.del_goodsf BEFORE DELETE  &ndash; 在删除前触发<br>
ON operation.goods_f<br>
FOR EACH ROW                              &ndash; 表示每删除一条记录，触发一次<br>
BEGIN                                     &ndash; 开始程序体<br>
DELETE FROM operation.goods_o<br>
WHERE groupnumber=OLD.groupnumber<br>
AND itemnumber=OLD.itemnumber;<br>
END<br>
//<br>
DELIMITER ;</p>
<p>到这儿呢，数据库数据表以及相关的索引、存储过程和触发器就都创建完了。可以说，我们已经完成了数据库的设计。</p>
<p>但是，在实际工作中，如果你只进行到这一步就打住了，那就还不能算是一个优秀的开发者。因为你考虑问题还不够全面。一个合格的系统设计者，不但要准确把握客户的需求，预见项目实施的前景，还要准备好对任何可能意外的应对方案。实际做项目时，不是纸上谈兵，什么情况都可能发生，我们需要未雨绸缪。所以，下面我们就来设计下项目的容灾和备份策略。</p>
<h2 id="如何制定容灾和备份策略">如何制定容灾和备份策略？</h2>
<p>为了防止灾害出现，我设置了主从架构。为了方便你理解，我采用的是一主一从的架构，你也可以搭建一主多从的架构，原理都是一样的。</p>
<p>主从架构的核心是，从服务器实时自动同步主服务器的数据，一旦主服务器宕机，可以切换到从服务器继续使用。这样就可以把灾害损失降到最低。</p>
<p>下面我就和你一起，搭建一下主从服务器。</p>
<h3 id="如何搭建主从服务器">如何搭建主从服务器？</h3>
<p>第一步，确保从服务器可以访问主服务器（在同一网段），例如，可以把主服务器的 IP 地址设置为：</p>
<p>主服务器 IP：192.168.1.100</p>
<p>需要注意的是，主服务器入口方向的 3306 号端口需要打开，否则从服务器无法访问主服务器的 MySQL 服务器。</p>
<p>同时，我们把从服务器的 IP 地址设置为：</p>
<p>从服务器 IP：192.168.1.110</p>
<p>第二步，修改主从服务器的系统配置文件 my.ini，使主从服务器有不同的 ID 编号，并且指定需要同步的数据库。</p>
<p>在主服务器的配置文件中，我们把主服务器的编号修改为：server-id = 1。</p>
<h1 id="-group-replication-related-">***** Group Replication Related *****</h1>
<h1 id="specifies-the-base-name-to-use-for-binary-log-files-with-binary-logging">Specifies the base name to use for binary log files. With binary logging</h1>
<h1 id="enabled-the-server-logs-all-statements-that-change-data-to-the-binary">enabled, the server logs all statements that change data to the binary</h1>
<h1 id="log-which-is-used-for-backup-and-replication">log, which is used for backup and replication.</h1>
<p>log-bin=mysql-bin          &ndash; 二进制日志名称<br>
binlog-do-db = operation   &ndash; 需要同步的数据库：营运数据库<br>
binlog-do-db = inventory   &ndash; 需要同步的数据库：库存数据库</p>
<h1 id="-group-replication-related--1">***** Group Replication Related *****</h1>
<h1 id="specifies-the-server-id-for-servers-that-are-used-in-a-replication-topology">Specifies the server ID. For servers that are used in a replication topology,</h1>
<h1 id="you-must-specify-a-unique-server-id-for-each-replication-server-in-the">you must specify a unique server ID for each replication server, in the</h1>
<h1 id="range-from-1-to-232--1-uniquemeans-that-each-id-must-be-different">range from 1 to 2^32 − 1. “Unique”means that each ID must be different</h1>
<h1 id="from-every-other-id-in-use-by-any-other-source-or-replica">from every other ID in use by any other source or replica.</h1>
<p>server-id=1          &ndash; 主服务器的 ID 设为 1</p>
<p>然后，我们来修改从服务器的配置文件 my.ini，把从服务器的编号设置为 server-id = 2。</p>
<h1 id="-group-replication-related--2">***** Group Replication Related *****</h1>
<h1 id="specifies-the-base-name-to-use-for-binary-log-files-with-binary-logging-1">Specifies the base name to use for binary log files. With binary logging</h1>
<h1 id="enabled-the-server-logs-all-statements-that-change-data-to-the-binary-1">enabled, the server logs all statements that change data to the binary</h1>
<h1 id="log-which-is-used-for-backup-and-replication-1">log, which is used for backup and replication.</h1>
<p>log-bin=mysql-bin              &ndash; 二进制日志名称<br>
replicate_do_db = operation    &ndash; 需要同步过来的数据库：营运数据库<br>
replicate_do_db = inventory    &ndash; 需要同步过来的数据库：库存数据库</p>
<h1 id="-group-replication-related--3">***** Group Replication Related *****</h1>
<h1 id="specifies-the-server-id-for-servers-that-are-used-in-a-replication-topology-1">Specifies the server ID. For servers that are used in a replication topology,</h1>
<h1 id="you-must-specify-a-unique-server-id-for-each-replication-server-in-the-1">you must specify a unique server ID for each replication server, in the</h1>
<h1 id="range-from-1-to-232--1-uniquemeans-that-each-id-must-be-different-1">range from 1 to 2^32 − 1. “Unique”means that each ID must be different</h1>
<h1 id="from-every-other-id-in-use-by-any-other-source-or-replica-1">from every other ID in use by any other source or replica.</h1>
<p>server-id=2                       &ndash; 从服务器的编号为 2</p>
<p>第三步，在主从服务器上都保存配置文件，然后分别重启主从服务器上的 MySQL 服务器。</p>
<p>第四步，为了使从服务器可以访问主服务器，在主服务器上创建数据同步用户，并赋予所有权限。这样，从服务器就可以实时读取主服务器的数据了。</p>
<p>mysql&gt; CREATE USER &lsquo;myreplica&rsquo;@&rsquo;%&rsquo; IDENTIFIED BY &lsquo;mysql&rsquo;;<br>
Query OK, 0 rows affected (0.02 sec)</p>
<p>mysql&gt; GRANT ALL ON <em>.</em> TO &lsquo;myreplica&rsquo;@&rsquo;%&rsquo;;<br>
Query OK, 0 rows affected (0.99 sec)</p>
<p>第五步，在从服务器上启动数据同步，开始从主服务器中同步数据。</p>
<p>mysql&gt;change master to master_host=&lsquo;192.168.1.100&rsquo;,master_port=3306,master_user=&lsquo;myreplica&rsquo;,master_password=&lsquo;mysql’,master_log_file=&lsquo;mysql-bin.000001&rsquo;,master_log_pos=535;<br>
Query OK, 0 rows affected (0.02 sec)</p>
<p>启动同步的时候，你需要注意的是，必须指明主服务器上二进制日志中的位置 master_log_pos。也就是说，你准备从主服务器的二进制日志的哪个位置开始同步数据。你可以通过在主服务器上，用 SQL 语句“SHOW BINLOG EVENTS IN 二进制日志名”获取这个值。下面的代码可以启动同步：</p>
<p>mysql&gt;start slave;<br>
Query OK, 0 rows affected (0.02 sec)</p>
<h3 id="如何制定数据备份策略">如何制定数据备份策略？</h3>
<p>设置了主从服务器，也不是万无一失。</p>
<p>我曾经就遇到过这样一件事：我们把主从服务器搭在了某大厂几台不同的云服务器上，自以为没问题了，没想到大厂也有失手的时候，居然整个地区全部宕机，导致我们的主从服务器同时无法使用，近千家商户无法开展业务，损失惨重。</p>
<p>所以，无论系统的架构多么可靠，我们也不能大意。备份仍然是必不可少的步骤。我们可以在应用层面调用类似下面的命令进行备份：</p>
<p>H:&gt;mysqldump -u root -p &ndash;databases<br>
inventory operation &gt; H:\backup\Monday\mybackup.sql</p>
<p>我在项目中设定的策略是，每天晚上 12:00 做一个自动备份，循环备份 7 天，创建 7 个文件夹，从 Monday 到 Sunday，每个文件夹中保存对应的备份文件，新的覆盖旧的。</p>
<p>这个逻辑也很简单，你很容易理解，我就不多解释了，你不要忘了做这一步工作就可以了。</p>
<h2 id="总结">总结</h2>
<p>今天这节课，我给你详细讲解了建库建表、创建索引、存储过程、触发器，以及容灾和备份策略。有几点你需要格外重视一下。</p>
<p>索引是提升查询执行速度的关键，创建的原则是：所有的数据表都要创建索引；有可能作为筛选条件的字段，都要用来创建索引。</p>
<p>另外，容灾和备份是数据库系统设计中必不可少的部分。因为在现实生活中，什么情况都可能发生，我们无法预见，但是可以尽量避免。在设计阶段的未雨绸缪，可以帮助我们减少很多损失。</p>
<p>最后我要提醒你的是，MySQL 的相关知识实践性非常强，决不能停留在纸面上。我在课中演示的的代码，都是在实际环境中运行过的，你课下一定要跟着实际操作一下。毕竟，学习知识最好的办法，就是在解决实际问题中学习。</p>
<h2 id="思考题">思考题</h2>
<p>在今天的课程中，我演示了搭建主从服务器的过程。其中，在第四步，我专门创建了一个用来同步数据的账号“myreplica”。我想请你思考一下，我为什么要这样做？直接用“root”账号不行吗？</p>
<p>欢迎在留言区写下你的思考和答案，我们一起交流讨论。如果你觉得今天的内容对你有所帮助，也欢迎你把它分享给你的朋友或同事，我们下节课见。</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">MySQL必知必会</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E8%AE%B8%E5%BC%8F%E4%BC%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AF%BE/28__%E5%AE%9E%E6%88%98%E4%B8%89%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%94%BB%E5%9B%BE%E7%A8%8B%E5%BA%8F/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">28__实战（三）：怎么设计一个“画图”程序？</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/go%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%8336%E8%AE%B2/28__%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8Fsync.cond_%E4%B8%8B/">
            <span class="next-text nav-default">28__条件变量sync.Cond_（下）</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
