<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>用户故事__莫名：相信坚持的力量，终会厚积薄发 - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是莫名同学，坐标杭州。
我已经工作六年多了，曾经参与过对象存储、大数据等产品的开发。最近两年，我开始接触容器云平台系统开发与性能优化方向的工作。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%AE%B9%E5%99%A8%E5%AE%9E%E6%88%98%E9%AB%98%E6%89%8B%E8%AF%BE/%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B__%E8%8E%AB%E5%90%8D%E7%9B%B8%E4%BF%A1%E5%9D%9A%E6%8C%81%E7%9A%84%E5%8A%9B%E9%87%8F%E7%BB%88%E4%BC%9A%E5%8E%9A%E7%A7%AF%E8%96%84%E5%8F%91/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%AE%B9%E5%99%A8%E5%AE%9E%E6%88%98%E9%AB%98%E6%89%8B%E8%AF%BE/%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B__%E8%8E%AB%E5%90%8D%E7%9B%B8%E4%BF%A1%E5%9D%9A%E6%8C%81%E7%9A%84%E5%8A%9B%E9%87%8F%E7%BB%88%E4%BC%9A%E5%8E%9A%E7%A7%AF%E8%96%84%E5%8F%91/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="用户故事__莫名：相信坚持的力量，终会厚积薄发">
  <meta property="og:description" content="你好，我是莫名同学，坐标杭州。
我已经工作六年多了，曾经参与过对象存储、大数据等产品的开发。最近两年，我开始接触容器云平台系统开发与性能优化方向的工作。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="容器实战高手课">

  <meta itemprop="name" content="用户故事__莫名：相信坚持的力量，终会厚积薄发">
  <meta itemprop="description" content="你好，我是莫名同学，坐标杭州。
我已经工作六年多了，曾经参与过对象存储、大数据等产品的开发。最近两年，我开始接触容器云平台系统开发与性能优化方向的工作。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3547">
  <meta itemprop="keywords" content="容器实战高手课">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="用户故事__莫名：相信坚持的力量，终会厚积薄发">
  <meta name="twitter:description" content="你好，我是莫名同学，坐标杭州。
我已经工作六年多了，曾经参与过对象存储、大数据等产品的开发。最近两年，我开始接触容器云平台系统开发与性能优化方向的工作。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">用户故事__莫名：相信坚持的力量，终会厚积薄发</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3547 字 </span>
          <span class="more-meta"> 预计阅读 8 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#我为什么要学习专栏">我为什么要学习专栏？</a></li>
        <li><a href="#我是怎么学习专栏的">我是怎么学习专栏的</a>
          <ul>
            <li><a href="#1-坚持学习用好碎片时间">1. 坚持学习，用好碎片时间</a></li>
            <li><a href="#2-知行合一善于思考总结">2. 知行合一，善于思考总结</a></li>
            <li><a href="#3-敢于怀疑拒绝教条主义">3. 敢于怀疑，拒绝教条主义</a></li>
          </ul>
        </li>
        <li><a href="#专栏中最有收获的文章是哪几篇">专栏中最有收获的文章是哪几篇？</a></li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是莫名同学，坐标杭州。</p>
<p>我已经工作六年多了，曾经参与过对象存储、大数据等产品的开发。最近两年，我开始接触容器云平台系统开发与性能优化方向的工作。</p>
<p>最初是偶然的一次机会，我关注了 eBay 技术荟公众号，认真拜读过作者的 eBay 云计算网事系列文章，受益匪浅，从中汲取了不少排查网络疑难杂症的新思路。但意犹未尽，一直期待有机会看到作者更多的分享。</p>
<p>后来，又看到极客时间**《容器实战高手课》**的课程预告，作者正是程远老师，而且课程内容也和我现在做的工作不谋而合。我满怀期待地翻了一遍开篇词，激起了不少共鸣，于是毫不犹豫地购买了该专栏。</p>
<p>我比较赞同作者“一个态度，两个步骤”的方法论。可以说，近年来我也是这个方法论的忠实践行者。正如作者所言，**容器的大多数问题，最终都可以映射到 Linux 操作系统相应模块上。**因此，想要在容器方面技高一筹，意味着需要苦练内功，深入了解隐藏在容器背后的 Linux 操作系统知识原理。</p>
<p>记得我刚参加工作的前几年，我没有直接接触过容器技术，对 Linux 了解也不多，仅仅停留在使用层面，遇到问题经常一头雾水。</p>
<p>庆幸的是，从 2017 年末起，我开始沉下心来学习 Linux 相关技术，从基础知识到内核源码，一步一步地向前进。这个过程中，也逐渐养成了遇到问题刨根问底的思维习惯，而这种态度，也正是这个专栏里一直倡导的。</p>
<p>2019 年初，我开始真正接触容器技术，凭借平时积累了比较扎实的 Linux 知识功底，遇到的多数容器问题都能够迎刃而解，“两个步骤”在平时的系统性能分析与优化工作中得以体现。</p>
<h2 id="我为什么要学习专栏">我为什么要学习专栏？</h2>
<p>选择学习专栏的主要原因有两个，一方面是完善知识体系，另一方面是拓宽自己的技术思路。</p>
<p>经过前期了解，我认为作者技术经验丰富。他经历了 Kubernetes 容器云平台在 eBay 的具体落地过程，解决过大大小小的各类问题，是货真价实的容器实战高手。在学习专栏之前，我自己简单整理过一套容器知识结构体系。不过相比之下，作者列出的容器知识结构体系更加完备。</p>
<p>所以，我期待借鉴作者的思路重新审视自己的理解，查漏补缺、温故知新，并在专栏更新过程中通过留言和作者进一步交流心得体会。相信经过系统的学习，我也能更好地建立自己的知识架构。</p>
<p>另外，既然这门课是实战课，自然少不了动手实战，我期待可以在案例中，借鉴老师解决问题的思路。</p>
<p>作者在 eBay 云计算网事系列文章中曾提过，Kubernetes 容器云平台在大规模应用场景下的偶发性问题十分棘手，如果手忙脚乱地进行各种尝试，可能会事倍功半、越理越乱。事实的确如此，在复杂的 Linux 环境下，传统的性能分析工具应对这些偶发性问题，已经略显捉襟见肘了。</p>
<p>过去一年里，我也曾使用 perf、ftrace、BCC/bpftrace 等 Linux 性能分析工具解决过网络抖动、存储写入延迟等偶发性问题。但是仍然担心自己的思路存在局限性，所以很期待作者专题加餐的分享，看看这些工具在容器网络不稳定的真实案例中要怎么综合运用，拓宽自己定位、解决类似问题的思路。</p>
<h2 id="我是怎么学习专栏的">我是怎么学习专栏的</h2>
<p>我应该是订阅比较早的同学了，现在想想，能够坚持学完整个专栏，而且在更新期间跟老师做了积极互动，主要有这样三个方法。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/%E5%AE%B9%E5%99%A8%E5%AE%9E%E6%88%98%E9%AB%98%E6%89%8B%E8%AF%BE/815c3c26090cefda8657797a9f15dccc.png" alt=""></p>
<h3 id="1-坚持学习用好碎片时间">1. 坚持学习，用好碎片时间</h3>
<p>专栏的首刷，我基本上是利用碎片化的时间完成的。每周一、三、五专栏更新时，我会在早上通勤路上先把内容过一遍，从整体上把握文章思路。</p>
<p>由于碎片时间很难保持较高专注度，我倾向于选择轻松一些的阅读方式，不刻意做过多的深度思考，但是会把自己比较赞同或疑惑的知识点先标记下来，以便后续重点学习。</p>
<p>专栏内容结构简练、清晰，一共二十多篇，其实我觉得坚持下来并不难。专栏更新过程中，我利用工作闲暇时，针对最有收获的几篇文章反复刷了若干次，结合文章示例动手实践，并翻阅相关的 Linux、Docker 源码，将首刷时留下的疑点逐一击破。</p>
<p>两个月下来，这样的学习让我受益匪浅，进一步拓宽了自己的容器知识结构体系，也学到了分析常见容器性能问题的新思路。</p>
<p><strong>我相信，当一个人开始把坚持学习当作一种习惯，并且善于合理利用碎片时间提升自我的时候，他已经走在超越大多数人的道路上。</strong></p>
<h3 id="2-知行合一善于思考总结">2. 知行合一，善于思考总结</h3>
<p>每个专栏作者几乎都会反复强调：学习专栏时，请动手实践文章中提到的示例以及课后思考题。所以，学习中思考与实践的重要性不言而喻。</p>
<p>数学家华罗庚说过，他的学习方法很简单，就是“读书要从薄到厚，再从厚到薄”。其实专栏的学习也是同样的道理。在我看来，专栏每篇文章都浓缩着作者历经磨砺后的思考与总结，有些很难一次性消化，所以需要我们在不断实践与思考中领悟。</p>
<p>我觉得，专栏起到的是一个<strong>领航</strong>的作用，想要相关的知识点我们可以根据自己的需要继续做功课，这样才能不断精进。遇到有疑问的地方，我会通过官方文档、源码等方式深挖这些知识点背后原理，希望可以由点及面，直达问题本质。</p>
<p>有了这样的问题导向，我才会进行更多深度思考，在研究、解决问题的过程中，也加深了自己对知识的理解。下面举几个我曾经思考并想办法弄清楚的问题：</p>
<ol>
<li>什么是容器绑定挂载？容器创建过程中涉及哪些挂载行为和传播方式？</li>
<li>为什么说虚拟网络设备 veth 的行为像一根网线？</li>
<li>如何使用 strace 追踪容器创建的大致过程？</li>
<li>拥有独立 Network Namespace 的容器如何反过来操控宿主机的防火墙、路由表等？</li>
<li>为什么 Pid Namespace 可以使得容器的 init 进程的 PID 总是为 1？</li>
<li>&hellip;</li>
</ol>
<h3 id="3-敢于怀疑拒绝教条主义">3. 敢于怀疑，拒绝教条主义</h3>
<p>延续刚才说的知行合一。其实我们学习的时候，对有疑问的内容拒绝教条主义，这也很重要，我举个例子吧。</p>
<p>第 12 讲学习容器 Quota 技术的时候，文章里用到的例子是 xfs quota。但我认为，目前容器 quota 技术存在以下局限性：容器通常采用 overlay 存储驱动，仅支持在宿主文件系统 xfs 上开启 quota 功能，这意味着 overlay over ext4 不支持 project quota 功能。</p>
<p>虽然 ext4 自身支持 project quota 功能（Linux4.5 版本之后）。但是，overlay over ext4 却不支持 project quota 功能。</p>
<p>经过我的尝试，采用 overlay over ext4 启动容器，会报以下错误：</p>
<p>Docker:Error response from daemon: &ndash;storage-opt is supported only for overlay over xfs with &lsquo;pquota&rsquo; mount option.</p>
<p>官方文档里也有提到：For the overlay2 storage driver, the size option is only available if the backing fs is xfs and mounted with the pquota mount option（大意是 overlay 存储驱动仅支持基于 xfs 开启 project quota 功能）。</p>
<h2 id="专栏中最有收获的文章是哪几篇">专栏中最有收获的文章是哪几篇？</h2>
<p>首先是第 2 讲，我印象最深的是这篇文章最后的总结了，提到容器里 1 号进程对信号处理的两个要点：</p>
<p>1. 在容器中，1 号进程永远不会响应 SIGKILL 和 SIGSTOP 这两个特权信号；</p>
<p>2. 对于其他的信号，如果用户自己注册了 handler，1 号进程可以响应。</p>
<p>其中，要点 2 打破了我的固有认知。我原先一直认为在容器中 1 号进程无法被杀死，而这一讲结合相关内核源码与若干示例充分证明了这一要点，思路清晰，令人受益良多。</p>
<p>在第 9 讲学习 Memory Cgroup 的时候，课程里提到，每个容器的 Memory Cgroup 在统计每个控制组的内存使用时包含了两部分，RSS 和 Page Cache。</p>
<p>不过我认为，Momory Cgroup 除了包括 RSS 和 Page Cache，还包括了对内核内存的限制，作者给出的例子情况比较简单，基本没有使用 slab，倘若在容器中打开海量小文件，内核内存 inode、dentry 等会被计算在内。</p>
<p>内存使用量计算公式（memory.kmem.usage_in_bytes 表示该 memcg 内核内存使用量）：</p>
<p>memory.usage_in_bytes = memory.stat[rss] + memory.stat[cache] + memory.kmem.usage_in_bytes</p>
<p>另外，Memory Cgroup OOM 不是真正依据内存使用量 memory.usage_in_bytes，而是依据 working set（使用量减去非活跃 file-backed 内存），working set 计算公式是：</p>
<p>working_set=memory.usage_in_bytes-total_inactive_file。</p>
<p>接下来要说说第 14 讲，文章首先抛出一个引人关注的现象：应用程序从虚拟机迁移到容器并施加 Memory Cgroup 限制时，文件写入出现较大的延时波动。</p>
<p>我印象最深的是，这一讲通过程序复现、理论分析、工具追踪等一系列手段，最终得出一个令我深有同感的结论：在对容器做 Memory Cgroup 限制内存大小的时候，不仅要考虑容器中进程实际使用的内存量，还要考虑容器中程序 I/O 的量，合理预留足够的内存作为 Buffered I/O 的 Page Cache。</p>
<p>其实学习容器技术没不久，我就已经了解到，容器网络延迟相比宿主机高出 10% 左右，但并未深入思考过网络延迟变高的具体原因。</p>
<p>而专栏第 17 讲内容讲网络延时的时候，从 veth driver 的内核源码入手，合理解释了容器网络性能损失的来龙去脉，感觉收获很大，可以说是透过现象挖到了本质。受到这一讲的启发，对排查网络延迟问题，我又多了新的思路。</p>
<h2 id="总结">总结</h2>
<p>在这个专栏学习结束后，我回过头来看，很高兴已经达到当初选择学习专栏的目的。</p>
<p>阅读过程整体比较顺畅，尤其觉得作者列出的 Linux 源码恰到好处，产生不少共鸣，因为在探究容器问题过程中，我也曾经阅读过这些代码。</p>
<p>感谢极客时间为我们提供了如此优秀的学习平台，也感谢作者为我们带来了非常精彩的容器实战课程。希望订阅这门课程的同学，也能有所收获，把学到的知识用到工作里。</p>
<p><strong>我觉得，无论是学习容器，还是学习其他技术知识，就好像升级打怪一样，苦练基本功，手感和意识才会逐渐提升。最后，希望我们都能成为容器高手，让我们相信坚持的力量，终会厚积薄发！</strong></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%AE%B9%E5%99%A8%E5%AE%9E%E6%88%98%E9%AB%98%E6%89%8B%E8%AF%BE/">容器实战高手课</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%9330%E8%AE%B2/%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B__%E6%9D%8E%E5%85%86%E9%BE%99%E5%8D%9A%E8%A7%82%E8%80%8C%E7%BA%A6%E5%8F%96%E5%8E%9A%E7%A7%AF%E8%80%8C%E8%96%84%E5%8F%91/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">用户故事__李兆龙：博观而约取，厚积而薄发</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF/%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B__%E9%82%A3%E4%BA%9B%E4%BD%A0%E4%B8%8E%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF%E7%9A%84%E4%B8%8D%E8%A7%A3%E4%B9%8B%E7%BC%98/">
            <span class="next-text nav-default">用户故事__那些你与“重学前端”的不解之缘</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
