<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>开篇词__Spark性能调优，你该掌握这些“套路” - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="你好，我是吴磊，欢迎和我一起探索 Spark 应用的性能优化。
2020 年 6 月，Spark 正式发布了新版本，从 2.4 直接跨越到了 3.0。这次大版本升级的亮点就在于性能优化，它添加了诸如自适应查询执行（AQE）、动态分区剪裁（DPP）、扩展的 Join Hints 等新特性。
" /><meta name="keywords" content="技术文档, docs, 极客时间" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/%E5%BC%80%E7%AF%87%E8%AF%8D__spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%BD%A0%E8%AF%A5%E6%8E%8C%E6%8F%A1%E8%BF%99%E4%BA%9B%E5%A5%97%E8%B7%AF/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/%E5%BC%80%E7%AF%87%E8%AF%8D__spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%BD%A0%E8%AF%A5%E6%8E%8C%E6%8F%A1%E8%BF%99%E4%BA%9B%E5%A5%97%E8%B7%AF/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="开篇词__Spark性能调优，你该掌握这些“套路”">
  <meta property="og:description" content="你好，我是吴磊，欢迎和我一起探索 Spark 应用的性能优化。
2020 年 6 月，Spark 正式发布了新版本，从 2.4 直接跨越到了 3.0。这次大版本升级的亮点就在于性能优化，它添加了诸如自适应查询执行（AQE）、动态分区剪裁（DPP）、扩展的 Join Hints 等新特性。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="Spark性能调优实战">

  <meta itemprop="name" content="开篇词__Spark性能调优，你该掌握这些“套路”">
  <meta itemprop="description" content="你好，我是吴磊，欢迎和我一起探索 Spark 应用的性能优化。
2020 年 6 月，Spark 正式发布了新版本，从 2.4 直接跨越到了 3.0。这次大版本升级的亮点就在于性能优化，它添加了诸如自适应查询执行（AQE）、动态分区剪裁（DPP）、扩展的 Join Hints 等新特性。">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="3391">
  <meta itemprop="keywords" content="Spark性能调优实战">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="开篇词__Spark性能调优，你该掌握这些“套路”">
  <meta name="twitter:description" content="你好，我是吴磊，欢迎和我一起探索 Spark 应用的性能优化。
2020 年 6 月，Spark 正式发布了新版本，从 2.4 直接跨越到了 3.0。这次大版本升级的亮点就在于性能优化，它添加了诸如自适应查询执行（AQE）、动态分区剪裁（DPP）、扩展的 Join Hints 等新特性。">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">开篇词__Spark性能调优，你该掌握这些“套路”</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            </div>
          <span class="more-meta"> 约 3391 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#精通-spark你需要一把叫做性能调优的万能钥匙">精通 Spark，你需要一把叫做“性能调优”的万能钥匙</a></li>
        <li><a href="#为什么性能调优不能照葫芦画瓢">为什么性能调优不能“照葫芦画瓢”？</a></li>
        <li><a href="#学得快也要学得好">学得快，也要学得好</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>你好，我是吴磊，欢迎和我一起探索 Spark 应用的性能优化。</p>
<p>2020 年 6 月，Spark 正式发布了新版本，从 2.4 直接跨越到了 3.0。这次大版本升级的亮点就在于性能优化，它添加了诸如自适应查询执行（AQE）、动态分区剪裁（DPP）、扩展的 Join Hints 等新特性。</p>
<p>其实，在 3.0 版本发布之前，Spark 就已然成为了分布式数据处理技术的事实标准。在数据科学与机器学习魔力象限中，Gartner 更是连续 3 年（2018~2020）将 Databricks（Spark 云原生商业版本）提名为 Market Leader。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/de1cf039fc9227830683308d689177b9.png" alt=""></p>
<p>自然而然地，<strong>Spark 也成为了各大头部互联网公司的标配，在海量数据处理上，扮演着不可或缺的关键角色</strong>。比如，字节跳动基于 Spark 构建的数据仓库去服务几乎所有的产品线，包括抖音、今日头条、西瓜视频、火山视频等。再比如，百度基于 Spark 推出 BigSQL，为海量用户提供次秒级的即席查询。</p>
<p>可以预见的是，<strong>这次版本升级带来的新特性，会让 Spark 在未来 5 到 10 年继续雄霸大数据生态圈。</strong></p>
<p>而说到我和 Spark 的缘分，可以追溯到 2014 年。一次偶然的机会，我参与到了 Spark 的调研。深入研究之后，我对 Spark 高效的执行性能深深着迷，这也让我未来的职业发展都和 Spark 紧紧地绑在了一起。就这样，我从数据分析、数据挖掘领域，转移到了现在的商业智能和机器学习领域，一直不停地尝试探索数据中蕴含的核心价值。</p>
<p>目前，我在 FreeWheel 带领团队负责机器学习的应用与落地。我们所有已落地和正在启动的项目，都在使用 Spark 进行数据探索、数据处理、数据分析、特征工程和样本工程。除此之外，我们还会经常基于 Spark 在海量数据上进行模型训练和模型推理。</p>
<p>如果你也和我一样，正沿着数据规划自己的职业路径，那么精通 Spark 也必定是你的职业目标之一。</p>
<h2 id="精通-spark你需要一把叫做性能调优的万能钥匙">精通 Spark，你需要一把叫做“性能调优”的万能钥匙</h2>
<p>目前，Spark 有海量批处理、实时流计算、图计算、数据分析和机器学习这 5 大应用场景，不论你打算朝哪个方向深入，性能调优都是你职业进阶必须要跨越的一步。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/06c5e4278847348cf0beb4e76efec5dd.png" alt=""></p>
<p>为什么这么说呢？原因很简单，<strong>对于这 5 大场景来说，提升执行性能是刚需</strong>。</p>
<p>图计算和机器学习往往需要上百次迭代才能收敛，如果没有性能保障，这类作业不可能完成计算。流计算和数据分析对于响应实时性的要求非常高，没有高效的执行性能，不可能做到在亚秒级完成处理。</p>
<p>相比其他场景，批处理对于执行效率的要求是最低的，但是，在日增数据量以 TB、甚至 PB 为单位计数的当下，想要在小时级别完成海量数据处理，不做性能调优简直是天方夜谭。</p>
<p>因此，我认为这 5 大场景就像是 5 扇门，每扇门背后都别有洞天，而<strong>性能调优就像是一把“万能钥匙”</strong>。有了这把钥匙在手，你才能如入无人之境，去探索更广阔的世界。</p>
<h2 id="为什么性能调优不能照葫芦画瓢">为什么性能调优不能“照葫芦画瓢”？</h2>
<p>其实，我身边很多开发人员也都意识到了这一点，他们会去网上搜集一些教程进行学习。但是，目前关于 Spark 性能调优的资料，大都不是很系统，或者只是在讲一些常规的调优技巧和方法。而对于一些大神分享的调优手段，我们往往“照葫芦画瓢”做出来的东西，也总是达不到预期的效果，比如：</p>
<ol>
<li>明明都是内存计算，为什么我用了 RDD/DataFrame Cache，性能反而更差了？</li>
<li>网上吹得神乎其神的调优手段，为啥到了我这就不好使呢？</li>
<li>并行度设置得也不低，为啥我的 CPU 利用率还是上不去？</li>
<li>节点内存几乎全都划给 Spark 用了，为啥我的应用还是 OOM？</li>
</ol>
<p>这些问题看似简单，但真不是一两句话就能说得清的。<strong>这需要我们深入 Spark 的核心原理，不断去尝试每一个 API、算子，设置不同的配置参数，最终找出最佳的排列组合。</strong></p>
<p>那么问题来了，这该怎么做呢？接下来，我就和你分享一下，我是怎么学习性能调优的。</p>
<p>刚刚接触 Spark 那会儿，我觉得它的开发效率是真高啊！MapReduce 上千行代码才能实现的业务功能，Spark 几十行代码就搞定了！</p>
<p>后来，随着客户要求的不断提高，以及我个人的“较真行为”，为了让应用能跑得更快，我几乎把所有的 RDD API 查了个遍，仔细研究每一个算子的含义和运行原理，汇总不同算子的适用场景，总结哪些算子会引入 Shuffle，对比同类功能算子的差异与优劣势，比如 map 和 mapPartitions，再比如 groupByKey、reduceByKey 和 aggregateByKey。</p>
<p>除此之外，Spark 官网的 Configuration 页面我也查阅了无数次，汇总与性能有关的配置项，不停地做对比实验，比较不同参数配置下的执行性能。遇到与认知不符的实验结果，就再回去反复咀嚼 Spark 的核心原理，从 RDD 和调度系统，到内存管理和存储系统，再到内存计算和 Shuffle，如此往复，乐此不疲。</p>
<p>虽然失败的次数非常多，但成倍的性能提升带来的惊喜让我久久不能忘怀。后来，我就把我的经验分享给身边的同事，在帮助他们进行调优的过程中，我也有意识地把我接触到的案例整理了起来，**从点到线、从线到面，**我逐渐摸清了性能调优的脉络，最终总结出一套关于性能调优的方法论，也因此建立起了以性能为导向的开发习惯。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/6c97d92cab707a4bca5e9b3140b6ce31.png" alt=""></p>
<p>**遵循这套方法论，开发者可以按图索骥地去开展性能调优工作，做到有的放矢、事半功倍。**我希望在这个专栏里把它分享给你。</p>
<h2 id="学得快也要学得好">学得快，也要学得好</h2>
<p>结合方法论，我把专栏划分为了 3 个部分：原理篇、性能篇和实战篇。</p>
<p>原理篇：聚焦 Spark 底层原理，打通性能调优的任督二脉</p>
<p>Spark 的原理非常多，但我会聚焦于那些与性能调优息息相关的核心概念，包括 <strong>RDD、DAG、调度系统、存储系统和内存管理</strong>。我会力求用最贴切的故事和类比、最少的篇幅，让你在最短的时间内掌握这 5 大概念的核心原理，为后续的性能调优打下坚实的基础。</p>
<p>性能篇：实际案例驱动，多角度解读，全方位解析性能调优技巧</p>
<p>我们刚才说了，Spark 的应用场景非常多，主要分为海量批处理、实时流计算、图计算、数据分析和机器学习这 5 个。但在所有的子框架里，Spark 对 Spark SQL 的倾斜和倚重也是有目共睹，所以性能篇我主要分两部分来讲。</p>
<p>**一部分是讲解性能调优的通用技巧，包括应用开发的基本原则、配置项的设置、Shuffle 的优化，以及资源利用率的提升。**首先，我会从常见的例子入手，教你怎么在不改变代码逻辑的情况下快速提升执行能。其次，我会带你去归纳与执行效率相关的配置项。接着，针对 Shuffle、数据关联这些典型场景，我们一起去分析有效的应对策略。最后，我们再从硬件视角出发，带你探讨如何最大化资源利用率，在整体上提升 Spark 的执行性能。</p>
<p>虽然，不同应用场景的开发 API 和运行原理都有所不同，但是性能调优的本质和方法论是一样的。因此，这类技巧不限定应用场景，适用于所有 Spark 子框架。</p>
<p><strong>另一部分我会专注于数据分析领域，借助如 Tungsten、AQE 这样的 Spark 内置优化项和数据关联这样的典型场景，来和你聊聊 Spark SQL 中的调优方法和技巧。</strong></p>
<p>首先，我会带你深入挖掘 Tungsten、Catalyst 优化器和 Spark 3.0 发布的诸多新特性，充分利用 Spark 已有的优化机制，让性能调优站到一个更高的起点上。接着，我会借助数据分析的典型场景案例，如数据清洗、数据关联、数据转换等等，带你 case-by-case 地去归纳调优的思路与方法。</p>
<p>值得一提的是，随着所有子框架的开发 API 陆续迁移到 DataFrame，我们在每个子框架之上开发的应用，都将受益于 Spark SQL 的性能提升。换句话说，尽管这部分调优技巧围绕数据分析领域展开，但其中的思路和方法，也同样适用于其他子框架。</p>
<p>实战篇：打造属于自己的分布式应用</p>
<p>在实战篇，为了帮助你实践我们的方法论和调优技巧。我会以 2011~2019 的《北京市汽油车摇号》数据为例，<strong>手把手教你打造一个分布式应用，带你从不同角度洞察汽油车摇号的趋势和走向</strong>。我相信，通过这个实战案例，你对性能调优技巧和思路的把控肯定会有一个“质的飞跃”。</p>
<p>除此之外，我还会不定期地针对一些热点话题进行加餐：比如和 Flink、Presto 相比，Spark 有哪些优势；再比如 Spark 的一些新特性，以及业界对于 Spark 的新探索。这也能帮助我们更好地面对变化，把握先机。</p>
<p><img src="https://raw.githubusercontent.com/epic1268/images/master/Spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/1e4ebf8685f6807181a43a6edca4b58c.png" alt=""></p>
<p>最后我想说，我一直希望把学习变成一件有趣又轻松的事情，所以在这个专栏里，我会用一个个小故事和实例，来帮助你理解 Spark 的核心原理，引导你建立以性能为导向的开发思维，以及从不同视角汇总性能调优的方法和技巧，<strong>让你像读小说一样去弄懂 Spark</strong>。</p>
<p>我也期望，你能像小说里的主人公一样，利用“调优技巧和方法论”这本武功秘籍，一路过五关、斩六将，打败现实中层出不穷的开发问题，在职业发展中更上一层楼。</p>
<p>最后，欢迎你在这里畅所欲言，提出你的困惑和疑问，也欢迎多多给我留言，你们的鼓励是我的动力。让我们一起拿起性能调优这把万能钥匙，去开启全新的 Spark 职业生涯吧！</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/">Spark性能调优实战</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/openresty%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/%E5%BC%80%E7%AF%87%E8%AF%8D__openresty%E4%B8%BA%E4%BD%A0%E6%89%93%E5%BC%80%E9%AB%98%E6%80%A7%E8%83%BD%E5%BC%80%E5%8F%91%E7%9A%84%E5%A4%A7%E9%97%A8/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">开篇词__OpenResty，为你打开高性能开发的大门</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%81%8B%E7%88%B1%E5%BF%85%E4%BF%AE%E8%AF%BE/%E5%BC%80%E7%AF%87%E8%AF%8D__%E7%88%B1%E4%B8%8E%E8%A2%AB%E7%88%B1%E6%98%AF%E4%BA%BA%E4%B8%80%E7%94%9F%E6%9C%80%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%83%BD%E5%8A%9B/">
            <span class="next-text nav-default">开篇词__爱与被爱，是人一生最值得学习的能力</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
